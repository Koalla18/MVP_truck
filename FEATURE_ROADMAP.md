# 🚀 RoutoX Feature Roadmap

## Обзор планируемых функций

### Phase 2: Умное управление флотом

| # | Фича | Страница | Приоритет | Статус |
|---|------|----------|-----------|--------|
| 1 | 💰 Рентабельность рейсов | `trips.html` | Высокий | 📋 Планируется |
| 2 | 📊 Dashboard KPI | `owner.html` / `index.html` | Высокий | 📋 Планируется |
| 3 | 🔔 Умные уведомления | `notifications.html` | Высокий | ✅ Создано |
| 4 | 📱 PWA для водителей | `driver.html` | Средний | 📋 Планируется |
| 5 | ⚖️ Контроль РТО | `driver.html` | Высокий | 📋 Планируется |
| 6 | 🛡️ GPS/ГЛОНАСС | `index.html` | Высокий | 📋 Планируется |
| 7 | 📄 Электронные путевые | `documents.html` | Средний | 📋 Планируется |
| 8 | 💳 Топливные карты | `fuel.html` | Средний | 📋 Планируется |
| 9 | 📦 Биржа грузов ATI | `marketplace.html` | Низкий | 📋 Планируется |
| 10 | 👥 CRM клиенты | `crm.html` | Средний | ✅ Создано |
| 11 | 🤖 AI Помощник | Везде | **Критический** | ✅ Создано |

---

## 1. 💰 Расчёт рентабельности рейсов

### Расположение
- **Страница:** `trips.html` → новая вкладка "Экономика"
- **Роли:** owner, admin

### Функционал
```
┌─────────────────────────────────────────────────────────────┐
│  ДОХОДЫ                          │  РАСХОДЫ                 │
├─────────────────────────────────────────────────────────────┤
│  • Ставка за рейс                │  • Топливо (факт)        │
│  • Дополнительные услуги         │  • Платные дороги        │
│  • Штрафы клиента за простой     │  • ЗП водителя           │
│                                  │  • Амортизация ТС        │
│                                  │  • Страховка (пропорц.)  │
└─────────────────────────────────────────────────────────────┘
                    │
                    ▼
            ЧИСТАЯ ПРИБЫЛЬ
          (маржа в % и руб.)
```

### Формулы
```javascript
// Рентабельность рейса
const revenue = tripRate + extraServices + clientPenalties;
const fuel = distance * fuelConsumption * fuelPrice;
const tollRoads = calculateTollRoads(route);
const driverSalary = (tripDuration / monthlyHours) * driverMonthlyRate;
const depreciation = (tripDistance / yearlyMileage) * vehicleDepreciation;
const insurance = dailyInsuranceRate * tripDays;

const expenses = fuel + tollRoads + driverSalary + depreciation + insurance;
const profit = revenue - expenses;
const margin = (profit / revenue) * 100;
```

### UI компоненты
- Калькулятор рентабельности (модальное окно)
- Графики прибыльности по направлениям
- Сравнение план/факт
- Топ прибыльных/убыточных маршрутов

---

## 2. 📊 Dashboard KPI

### Расположение
- **Страница:** `owner.html` (главный дашборд владельца)
- **Роли:** owner, admin

### Метрики
```
┌─────────────────────────────────────────────────────────────┐
│  💵 ФИНАНСЫ           │  🚛 ФЛОТ              │  ⏱️ ВРЕМЯ   │
├─────────────────────────────────────────────────────────────┤
│  Выручка месяц        │  Активных ТС          │  % опозданий │
│  Выручка неделя       │  На ремонте           │  Среднее     │
│  Прибыль              │  Свободных            │  время рейса │
│  Дебиторка            │  Коэф. использования  │  Простой     │
└─────────────────────────────────────────────────────────────┘
```

### Визуализация
- Графики (Chart.js / ApexCharts)
- Сравнение с прошлым периодом
- Прогноз на месяц (ML)
- Алерты при отклонениях

---

## 3. 🔔 Умные уведомления (✅ СОЗДАНО)

### Файл: `notifications.html`

### Типы уведомлений
| Тип | Триггер | Время до события |
|-----|---------|-----------------|
| ОСАГО/КАСКО | Истечение полиса | 14/7/3/1 день |
| ТО | Пробег до ТО | 2000/1000/500 км |
| РТО | Лимит вождения | 1ч/30мин/15мин |
| Топливо | Аномальный расход | Мгновенно |
| GPS | Потеря сигнала | 5 мин |

### Каналы доставки
- Push в браузере
- Email
- Telegram бот
- SMS (опционально)

---

## 4. 📱 PWA для водителей

### Расположение
- **Страница:** `driver.html` (оптимизация) + `manifest.json`
- **Роли:** driver

### Функции
```
┌─────────────────────────────────────────────────────────────┐
│  📍 РЕЙСЫ              │  📷 ДОКУМЕНТЫ         │  💬 ЧАТ     │
├─────────────────────────────────────────────────────────────┤
│  Текущий маршрут       │  Фото ТТН             │  Диспетчер  │
│  Навигация             │  Фото груза           │  Экстренная │
│  Точки загрузки        │  Подпись клиента      │  связь      │
│  Статус доставки       │  Акт приёма           │             │
└─────────────────────────────────────────────────────────────┘
```

### Технические требования
- `manifest.json` для установки
- `service-worker.js` для офлайн
- Camera API для фото
- Geolocation для трекинга
- Push Notifications

---

## 5. ⚖️ Контроль режима труда-отдыха (РТО)

### Расположение
- **Страница:** `driver.html` → вкладка "РТО"
- **Роли:** driver, admin, owner

### Лимиты (Приказ Минтранса №424)
```
┌─────────────────────────────────────────────────────────────┐
│  ЕЖЕДНЕВНО            │  ЕЖЕНЕДЕЛЬНО          │  ОТДЫХ      │
├─────────────────────────────────────────────────────────────┤
│  Вождение: 9ч (10ч*)  │  Вождение: 56ч        │  Суточный:  │
│  Рабочее: 10ч         │  За 2 недели: 90ч     │  мин. 11ч   │
│  Перерыв: 45мин/4.5ч  │                       │  Недельный: │
│                       │                       │  мин. 45ч   │
└─────────────────────────────────────────────────────────────┘
* 10ч допускается 2 раза в неделю
```

### UI
- Таймер текущей смены
- Прогресс-бар до лимита
- История за неделю/месяц
- Уведомления о приближении к лимиту

---

## 6. 🛡️ GPS/ГЛОНАСС интеграция

### Расположение
- **Страница:** `index.html` (карта) + `telemetry.html`
- **Роли:** admin, owner

### Функции
```
┌─────────────────────────────────────────────────────────────┐
│  📍 ТРЕКИНГ           │  ⛽ ТОПЛИВО            │  🚨 АЛЕРТЫ  │
├─────────────────────────────────────────────────────────────┤
│  Real-time позиция    │  Уровень в баке       │  Слив       │
│  История маршрутов    │  Расход на 100км      │  Заправка   │
│  Скорость             │  Заправки (где/когда) │  Остановка  │
│  Геозоны              │  Сливы (детекция)     │  вне зоны   │
└─────────────────────────────────────────────────────────────┘
```

### Интеграции
- Wialon
- ГЛОНАСС-Софт
- Omnicomm
- Teltonika

### Backend API
```python
# WebSocket для real-time
@router.websocket("/ws/telemetry/{vehicle_id}")
async def telemetry_stream(websocket, vehicle_id):
    while True:
        data = await get_vehicle_telemetry(vehicle_id)
        await websocket.send_json(data)
        await asyncio.sleep(5)
```

---

## 7. 📄 Электронные путевые листы

### Расположение
- **Страница:** `documents.html` → раздел "Путевые листы"
- **Роли:** driver, admin

### Автозаполнение
```
┌─────────────────────────────────────────────────────────────┐
│  ИЗ СИСТЕМЫ           │  ОТ ВОДИТЕЛЯ          │  АВТОМАТИКА │
├─────────────────────────────────────────────────────────────┤
│  Данные ТС            │  Показания одометра   │  Время      │
│  Данные водителя      │  Мед. осмотр          │  выезда/    │
│  Маршрут              │  Тех. осмотр          │  возврата   │
│  Заказчик             │  Подпись              │  Пробег     │
└─────────────────────────────────────────────────────────────┘
```

### Экспорт
- PDF (стандартная форма)
- XML для 1С
- API для ЭДО систем

---

## 8. 💳 Топливные карты

### Расположение
- **Страница:** `fuel.html` → вкладка "Карты"
- **Роли:** admin, owner

### Интеграции
```
┌─────────────────────────────────────────────────────────────┐
│  СЕТИ АЗС                                                   │
├─────────────────────────────────────────────────────────────┤
│  • Газпромнефть       • Лукойл               • Роснефть    │
│  • Татнефть           • Башнефть             • ЕКА         │
│  • Е100               • PPR                  • DKV         │
└─────────────────────────────────────────────────────────────┘
```

### Функции
- Автоматический импорт транзакций
- Сверка с GPS-данными
- Детекция аномалий (заправка вне маршрута)
- Лимиты на карты

---

## 9. 📦 Биржа грузов ATI.su

### Расположение
- **Страница:** `marketplace.html` (новая)
- **Роли:** admin, owner

### Функции
```
┌─────────────────────────────────────────────────────────────┐
│  ПОИСК ГРУЗОВ         │  МОИ ЗАЯВКИ           │  РЕЙТИНГ    │
├─────────────────────────────────────────────────────────────┤
│  По направлению       │  Активные             │  ATI рейтинг│
│  По весу/объёму       │  Выигранные           │  История    │
│  По ставке            │  Отклонённые          │  Отзывы     │
│  По дате              │  История              │             │
└─────────────────────────────────────────────────────────────┘
```

### Интеграция ATI API
```javascript
// Поиск грузов
async function searchLoads(filters) {
  const response = await fetch('https://api.ati.su/v1/loads/search', {
    headers: { 'Authorization': `Bearer ${ATI_TOKEN}` },
    body: JSON.stringify(filters)
  });
  return response.json();
}
```

---

## 10. 👥 CRM для клиентов (✅ СОЗДАНО)

### Файл: `crm.html`

### Статусы клиентов
- 🟢 Активный — регулярные заказы
- 🟡 Переговоры — в процессе
- 🟣 Потенциальный — лид
- ⚫ Неактивный — нет заказов > 3 мес.

### Функции
- Карточки клиентов
- История заказов
- Контакты и заметки
- Аналитика по клиенту
- Автоматические напоминания

---

## 11. 🤖 AI Помощник (✅ СОЗДАНО)

### Файл: `assets/js/routox-ai.js`

### Возможности по ролям

#### Владелец (owner)
```
• "Какая прибыль за этот месяц?"
• "Какие рейсы самые прибыльные?"
• "Где можно сократить расходы?"
• "Прогноз выручки на следующий месяц"
```

#### Администратор (admin)
```
• "Какие водители свободны сегодня?"
• "Спланируй оптимальный маршрут"
• "У кого заканчивается ОСАГО?"
• "Сформируй путевой лист"
```

#### Водитель (driver)
```
• "Где ближайшая дешёвая заправка?"
• "Сколько мне осталось до отдыха?"
• "Какой мой следующий рейс?"
• "Есть ли пробки на маршруте?"
```

### Архитектура
```
┌─────────────────────────────────────────────────────────────┐
│                      FRONTEND                               │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  Floating Widget (routox-ai.js)                      │  │
│  │  • Чат интерфейс                                     │  │
│  │  • Голосовой ввод                                    │  │
│  │  • Контекстные подсказки                             │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                      BACKEND                                │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  /api/v1/ai/chat                                     │  │
│  │  • RAG (данные компании)                             │  │
│  │  • Function calling (действия)                       │  │
│  │  • Context management                                │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                      LLM                                    │
│  • OpenAI GPT-4 (облако)                                   │
│  • или YandexGPT (Россия)                                  │
│  • или LLaMA 3 (self-hosted)                               │
└─────────────────────────────────────────────────────────────┘
```

---

## Порядок реализации

### Sprint 1 (2 недели)
1. ✅ AI Помощник (базовый)
2. ✅ CRM клиенты
3. ✅ Умные уведомления
4. 🔄 Dashboard KPI

### Sprint 2 (2 недели)
5. Рентабельность рейсов
6. Контроль РТО
7. GPS/ГЛОНАСС интеграция

### Sprint 3 (2 недели)
8. Электронные путевые листы
9. Топливные карты

### Sprint 4 (2 недели)
10. PWA для водителей
11. Биржа грузов ATI

---

## Технический стек

### Frontend
- Vanilla JS + Tailwind CSS
- Chart.js для графиков
- Leaflet/Mapbox для карт
- PWA (Service Worker, Manifest)

### Backend
- FastAPI (Python)
- PostgreSQL
- Redis (кэш, очереди)
- WebSocket (real-time)

### AI
- OpenAI API / YandexGPT / LLaMA
- LangChain для RAG
- Function calling для действий

### Интеграции
- ATI.su API
- Wialon/ГЛОНАСС-Софт API
- Топливные API (Газпромнефть и др.)
- 1С через XML/JSON

---

*Документ создан: Январь 2026*
*Версия: 1.0*
