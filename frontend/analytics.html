<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoutoX — Аналитика и отчёты</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script src="https://kit.fontawesome.com/a2e0e9e5a9.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="./assets/css/routox-unified.css">
  <style>
    /* Page-specific overrides only */
    .glass-card { 
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 14px;
      transition: all 0.3s ease;
    }

    [data-theme="dark"] .glass-card {
      background: linear-gradient(135deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.01) 100%);
    }

    .glass-card:hover {
      border-color: rgba(59, 130, 246, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }

    .nav-pill {
      padding: 10px 18px;
      border-radius: 12px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .nav-pill:hover {
      background: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
    }

    .nav-pill.active {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
    }

    .icon-btn {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      position: relative;
    }

    .icon-btn:hover {
      background: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.3);
    }

    .text-muted { color: var(--text-secondary); }

    .theme-toggle-track {
      width: 50px;
      height: 26px;
      background: var(--border-color);
      border-radius: 13px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s;
    }

    [data-theme="dark"] .theme-toggle-track { background: #3b82f6; }

    .theme-toggle-thumb {
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 2px;
      transition: all 0.3s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    [data-theme="dark"] .theme-toggle-thumb { left: 26px; }

    .stat-card {
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #10b981, #8b5cf6);
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .stat-card:hover::before { transform: scaleX(1); }

    .stat-icon {
      animation: iconFloat 4s ease-in-out infinite;
    }

    @keyframes iconFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .gradient-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.15;
      animation: orbFloat 8s ease-in-out infinite;
    }

    [data-theme="dark"] .gradient-orb { opacity: 0.3; }

    @keyframes orbFloat {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(20px, -20px) scale(1.1); }
    }

    .kpi-value {
      background: linear-gradient(135deg, #3b82f6, #10b981);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .trend-up { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .trend-down { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

    .progress-ring { transform: rotate(-90deg); }
    .progress-ring-circle { transition: stroke-dashoffset 0.5s ease; }

    .report-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .report-card:hover {
      transform: translateX(8px);
      border-left-color: #3b82f6;
    }

    .tab-btn {
      padding: 10px 20px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
      color: var(--text-secondary);
    }

    .tab-btn:hover { color: var(--text-primary); }
    .tab-btn.active {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
    }

    .custom-scroll::-webkit-scrollbar { width: 6px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }

    .heatmap-cell {
      transition: all 0.2s ease;
      border-radius: 4px;
    }

    .heatmap-cell:hover {
      transform: scale(1.2);
      z-index: 10;
    }

    .comparison-bar {
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
    }

    .comparison-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .progress-bar {
      height: 8px;
      background: var(--border-color);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .tab-btn {
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all 0.2s ease;
      background: transparent;
      border: none;
      cursor: pointer;
    }

    .tab-btn:hover {
      background: rgba(59, 130, 246, 0.1);
      color: var(--text-primary);
    }

    .tab-btn.active {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .role-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .role-badge.admin { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
    .role-badge.owner { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; border: 1px solid rgba(139, 92, 246, 0.3); }
    .role-badge.dispatcher { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="glass-panel mx-4 mt-4 px-6 py-4 flex items-center justify-between sticky top-4 z-30">
    <div class="flex items-center gap-6">
      <a href="./index.html" class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center font-bold text-lg text-white">R</div>
        <div>
          <div class="font-semibold">RoutoX</div>
          <div class="text-xs text-muted">Fleet Management</div>
        </div>
      </a>
      <nav id="mainNav" class="flex items-center gap-1 ml-8">
        <!-- Навигация заполняется динамически -->
      </nav>
    </div>
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2 glass-card px-3 py-2">
        <i class="fa-solid fa-calendar text-muted text-sm"></i>
        <select id="dateRange" class="bg-transparent text-sm focus:outline-none">
          <option value="7">Последние 7 дней</option>
          <option value="30" selected>Последние 30 дней</option>
          <option value="90">Последние 3 месяца</option>
          <option value="365">Этот год</option>
        </select>
      </div>
      <span class="role-badge" id="roleBadge">
        <i class="fa-solid fa-user-gear" id="roleIcon"></i>
        <span id="roleText">Загрузка...</span>
      </span>
      <a href="./notifications.html" class="icon-btn relative" title="Уведомления">
        <i class="fa-solid fa-bell text-muted"></i>
        <span class="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-red-500 text-white text-xs flex items-center justify-center font-bold">2</span>
      </a>
      <button class="icon-btn" title="Настройки" onclick="openSettingsModal()">
        <i class="fa-solid fa-gear text-muted"></i>
      </button>
      <div class="theme-toggle-track" onclick="toggleTheme()">
        <div class="theme-toggle-thumb"></div>
      </div>
      <button class="icon-btn" title="Экспорт в PDF" onclick="exportReport()">
        <i class="fa-solid fa-file-export text-muted"></i>
      </button>
      <button class="icon-btn" title="Выход" onclick="logout()"><i class="fa-solid fa-right-from-bracket text-muted"></i></button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="p-4 space-y-4">
    <!-- KPI Stats Row -->
    <div class="grid grid-cols-6 gap-4">
      <div class="glass-panel stat-card p-5 relative overflow-hidden">
        <div class="gradient-orb w-32 h-32 bg-blue-500 -top-16 -right-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center stat-icon">
              <i class="fa-solid fa-ruble-sign text-blue-500 text-xl"></i>
            </div>
            <span class="text-xs px-2 py-1 rounded-lg trend-up flex items-center gap-1">
              <i class="fa-solid fa-arrow-up text-xs"></i>+12.5%
            </span>
          </div>
          <div class="text-2xl font-bold kpi-value">₽ 8.4M</div>
          <div class="text-sm text-muted">Выручка</div>
        </div>
      </div>

      <div class="glass-panel stat-card p-5 relative overflow-hidden">
        <div class="gradient-orb w-32 h-32 bg-emerald-500 -top-16 -right-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500/20 to-green-500/20 flex items-center justify-center stat-icon">
              <i class="fa-solid fa-arrow-trend-up text-emerald-500 text-xl"></i>
            </div>
            <span class="text-xs px-2 py-1 rounded-lg trend-up flex items-center gap-1">
              <i class="fa-solid fa-arrow-up text-xs"></i>+8.3%
            </span>
          </div>
          <div class="text-2xl font-bold kpi-value">₽ 2.5M</div>
          <div class="text-sm text-muted">Прибыль</div>
        </div>
      </div>

      <div class="glass-panel stat-card p-5 relative overflow-hidden">
        <div class="gradient-orb w-32 h-32 bg-purple-500 -top-16 -right-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center stat-icon">
              <i class="fa-solid fa-route text-purple-500 text-xl"></i>
            </div>
            <span class="text-xs px-2 py-1 rounded-lg trend-up flex items-center gap-1">
              <i class="fa-solid fa-arrow-up text-xs"></i>+15.2%
            </span>
          </div>
          <div class="text-2xl font-bold kpi-value">342</div>
          <div class="text-sm text-muted">Рейсов</div>
        </div>
      </div>

      <div class="glass-panel stat-card p-5 relative overflow-hidden">
        <div class="gradient-orb w-32 h-32 bg-amber-500 -top-16 -right-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center stat-icon">
              <i class="fa-solid fa-clock text-amber-500 text-xl"></i>
            </div>
            <span class="text-xs px-2 py-1 rounded-lg trend-down flex items-center gap-1">
              <i class="fa-solid fa-arrow-down text-xs"></i>-2.1%
            </span>
          </div>
          <div class="text-2xl font-bold kpi-value">94.2%</div>
          <div class="text-sm text-muted">Вовремя</div>
        </div>
      </div>

      <div class="glass-panel stat-card p-5 relative overflow-hidden">
        <div class="gradient-orb w-32 h-32 bg-cyan-500 -top-16 -right-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center stat-icon">
              <i class="fa-solid fa-road text-cyan-500 text-xl"></i>
            </div>
            <span class="text-xs px-2 py-1 rounded-lg trend-up flex items-center gap-1">
              <i class="fa-solid fa-arrow-up text-xs"></i>+18.4%
            </span>
          </div>
          <div class="text-2xl font-bold kpi-value">128K км</div>
          <div class="text-sm text-muted">Пробег</div>
        </div>
      </div>

      <div class="glass-panel stat-card p-5 relative overflow-hidden">
        <div class="gradient-orb w-32 h-32 bg-rose-500 -top-16 -right-16"></div>
        <div class="relative z-10">
          <div class="flex items-center justify-between mb-3">
            <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-rose-500/20 to-pink-500/20 flex items-center justify-center stat-icon">
              <i class="fa-solid fa-truck text-rose-500 text-xl"></i>
            </div>
            <span class="text-xs px-2 py-1 rounded-lg trend-up flex items-center gap-1">
              <i class="fa-solid fa-arrow-up text-xs"></i>+5.2%
            </span>
          </div>
          <div class="text-2xl font-bold kpi-value">87%</div>
          <div class="text-sm text-muted">Утилизация</div>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="glass-panel p-2 flex items-center gap-2">
      <button class="tab-btn active" data-tab="overview">
        <i class="fa-solid fa-chart-pie mr-2"></i>Обзор
      </button>
      <button class="tab-btn" data-tab="finance">
        <i class="fa-solid fa-coins mr-2"></i>Финансы
      </button>
      <button class="tab-btn" data-tab="fleet">
        <i class="fa-solid fa-truck mr-2"></i>Флот
      </button>
      <button class="tab-btn" data-tab="drivers">
        <i class="fa-solid fa-id-card mr-2"></i>Водители
      </button>
      <button class="tab-btn" data-tab="routes">
        <i class="fa-solid fa-map-marked-alt mr-2"></i>Маршруты
      </button>
      <button class="tab-btn" data-tab="reports">
        <i class="fa-solid fa-file-lines mr-2"></i>Отчёты
      </button>
    </div>

    <!-- Tab Content: Overview -->
    <div id="tab-overview" class="tab-content active">
      <div class="grid grid-cols-12 gap-4">
        <!-- Revenue Chart -->
        <div class="col-span-8 glass-panel p-5">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="font-semibold text-lg">Выручка и расходы</h3>
              <p class="text-sm text-muted">Динамика за последние 12 месяцев</p>
            </div>
            <div class="flex items-center gap-4">
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-blue-500"></span>
                <span class="text-sm text-muted">Выручка</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-red-400"></span>
                <span class="text-sm text-muted">Расходы</span>
              </div>
              <div class="flex items-center gap-2">
                <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
                <span class="text-sm text-muted">Прибыль</span>
              </div>
            </div>
          </div>
          <canvas id="revenueChart" height="120"></canvas>
        </div>

        <!-- Fleet KPI Ring -->
        <div class="col-span-4 glass-panel p-5">
          <h3 class="font-semibold text-lg mb-4">Эффективность флота</h3>
          <div class="flex justify-center mb-4">
            <div class="relative">
              <svg class="progress-ring" width="160" height="160">
                <defs>
                  <linearGradient id="ringGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#3b82f6"/>
                    <stop offset="100%" stop-color="#10b981"/>
                  </linearGradient>
                </defs>
                <circle cx="80" cy="80" r="70" fill="none" stroke="currentColor" stroke-width="14" style="color: var(--border-color);"/>
                <circle class="progress-ring-circle" cx="80" cy="80" r="70" fill="none" stroke="url(#ringGradient)" stroke-width="14" stroke-linecap="round" stroke-dasharray="439.82" stroke-dashoffset="57.18"/>
              </svg>
              <div class="absolute inset-0 flex items-center justify-center flex-col">
                <div class="text-3xl font-bold">87%</div>
                <div class="text-sm text-muted">KPI</div>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-3">
            <div class="glass-card p-3 text-center">
              <div class="text-lg font-bold text-emerald-500">92%</div>
              <div class="text-xs text-muted">Исправность</div>
            </div>
            <div class="glass-card p-3 text-center">
              <div class="text-lg font-bold text-blue-500">85%</div>
              <div class="text-xs text-muted">Загрузка</div>
            </div>
            <div class="glass-card p-3 text-center">
              <div class="text-lg font-bold text-purple-500">78%</div>
              <div class="text-xs text-muted">Топливо</div>
            </div>
            <div class="glass-card p-3 text-center">
              <div class="text-lg font-bold text-amber-500">94%</div>
              <div class="text-xs text-muted">Время</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Second Row -->
      <div class="grid grid-cols-12 gap-4 mt-4">
        <!-- Trips by Status -->
        <div class="col-span-3 glass-panel p-5">
          <h3 class="font-semibold text-lg mb-4">Статусы рейсов</h3>
          <canvas id="tripStatusChart" height="180"></canvas>
        </div>

        <!-- Heatmap: Orders by Day/Hour -->
        <div class="col-span-5 glass-panel p-5">
          <h3 class="font-semibold text-lg mb-4">Активность по дням и часам</h3>
          <div id="heatmapContainer" class="overflow-x-auto">
            <div class="flex gap-1 mb-2 ml-8">
              <span class="text-xs text-muted w-6 text-center">0</span>
              <span class="text-xs text-muted w-6 text-center">3</span>
              <span class="text-xs text-muted w-6 text-center">6</span>
              <span class="text-xs text-muted w-6 text-center">9</span>
              <span class="text-xs text-muted w-6 text-center">12</span>
              <span class="text-xs text-muted w-6 text-center">15</span>
              <span class="text-xs text-muted w-6 text-center">18</span>
              <span class="text-xs text-muted w-6 text-center">21</span>
            </div>
            <div id="heatmap" class="space-y-1"></div>
          </div>
        </div>

        <!-- Top Drivers -->
        <div class="col-span-4 glass-panel p-5">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-lg">Топ водители</h3>
            <a href="./staff.html" class="text-sm text-blue-500 hover:underline">Все →</a>
          </div>
          <div class="space-y-3 custom-scroll max-h-64 overflow-y-auto">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-amber-500 to-amber-600 flex items-center justify-center font-bold text-xs text-white">1</div>
              <div class="flex-1">
                <div class="font-medium text-sm">Иванов Пётр</div>
                <div class="text-xs text-muted">42 рейса • 12.4K км</div>
              </div>
              <div class="text-sm font-bold text-emerald-500">98.5%</div>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-slate-400 to-slate-500 flex items-center justify-center font-bold text-xs text-white">2</div>
              <div class="flex-1">
                <div class="font-medium text-sm">Смирнов Алексей</div>
                <div class="text-xs text-muted">38 рейсов • 11.2K км</div>
              </div>
              <div class="text-sm font-bold text-emerald-500">97.2%</div>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-amber-700 to-amber-800 flex items-center justify-center font-bold text-xs text-white">3</div>
              <div class="flex-1">
                <div class="font-medium text-sm">Козлов Дмитрий</div>
                <div class="text-xs text-muted">35 рейсов • 10.8K км</div>
              </div>
              <div class="text-sm font-bold text-emerald-500">96.8%</div>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-slate-300 flex items-center justify-center font-bold text-xs text-slate-700">4</div>
              <div class="flex-1">
                <div class="font-medium text-sm">Новиков Кирилл</div>
                <div class="text-xs text-muted">32 рейса • 9.6K км</div>
              </div>
              <div class="text-sm font-bold text-blue-500">95.4%</div>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-slate-300 flex items-center justify-center font-bold text-xs text-slate-700">5</div>
              <div class="flex-1">
                <div class="font-medium text-sm">Морозов Андрей</div>
                <div class="text-xs text-muted">30 рейсов • 9.2K км</div>
              </div>
              <div class="text-sm font-bold text-blue-500">94.1%</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Third Row -->
      <div class="grid grid-cols-12 gap-4 mt-4">
        <!-- Fuel Efficiency -->
        <div class="col-span-6 glass-panel p-5">
          <h3 class="font-semibold text-lg mb-4">Эффективность топлива по ТС</h3>
          <canvas id="fuelEfficiencyChart" height="100"></canvas>
        </div>

        <!-- Vehicle Comparison -->
        <div class="col-span-3 glass-panel p-5">
          <h3 class="font-semibold text-lg mb-4">Сравнение ТС</h3>
          <div class="space-y-4">
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm">TR-001</span>
                <span class="text-sm font-medium text-emerald-500">95%</span>
              </div>
              <div class="comparison-bar" style="background: var(--border-color);">
                <div class="comparison-fill bg-gradient-to-r from-emerald-500 to-emerald-400" style="width: 95%"></div>
              </div>
            </div>
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm">TR-007</span>
                <span class="text-sm font-medium text-blue-500">87%</span>
              </div>
              <div class="comparison-bar" style="background: var(--border-color);">
                <div class="comparison-fill bg-gradient-to-r from-blue-500 to-blue-400" style="width: 87%"></div>
              </div>
            </div>
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm">TR-023</span>
                <span class="text-sm font-medium text-amber-500">72%</span>
              </div>
              <div class="comparison-bar" style="background: var(--border-color);">
                <div class="comparison-fill bg-gradient-to-r from-amber-500 to-amber-400" style="width: 72%"></div>
              </div>
            </div>
            <div>
              <div class="flex items-center justify-between mb-1">
                <span class="text-sm">TR-045</span>
                <span class="text-sm font-medium text-red-500">58%</span>
              </div>
              <div class="comparison-bar" style="background: var(--border-color);">
                <div class="comparison-fill bg-gradient-to-r from-red-500 to-red-400" style="width: 58%"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Reports -->
        <div class="col-span-3 glass-panel p-5">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold text-lg">Отчёты</h3>
            <button class="text-sm text-blue-500 hover:underline">Создать →</button>
          </div>
          <div class="space-y-2">
            <div class="report-card glass-card p-3 border-l-4 border-l-blue-500">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-file-pdf text-red-500"></i>
                <div class="flex-1">
                  <div class="font-medium text-sm">Финансовый</div>
                  <div class="text-xs text-muted">Январь 2024</div>
                </div>
                <i class="fa-solid fa-download text-muted text-sm"></i>
              </div>
            </div>
            <div class="report-card glass-card p-3 border-l-4 border-l-emerald-500">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-file-excel text-emerald-500"></i>
                <div class="flex-1">
                  <div class="font-medium text-sm">Топливо</div>
                  <div class="text-xs text-muted">Январь 2024</div>
                </div>
                <i class="fa-solid fa-download text-muted text-sm"></i>
              </div>
            </div>
            <div class="report-card glass-card p-3 border-l-4 border-l-purple-500">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-file-lines text-purple-500"></i>
                <div class="flex-1">
                  <div class="font-medium text-sm">Эффективность</div>
                  <div class="text-xs text-muted">Январь 2024</div>
                </div>
                <i class="fa-solid fa-download text-muted text-sm"></i>
              </div>
            </div>
            <div class="report-card glass-card p-3 border-l-4 border-l-amber-500">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-file-contract text-amber-500"></i>
                <div class="flex-1">
                  <div class="font-medium text-sm">Водители</div>
                  <div class="text-xs text-muted">Январь 2024</div>
                </div>
                <i class="fa-solid fa-download text-muted text-sm"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fourth Row: Events -->
      <div class="grid grid-cols-12 gap-4 mt-4">
        <div class="col-span-8 glass-panel p-5">
          <h3 class="font-semibold text-lg mb-4">Последние события</h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="space-y-3">
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
                  <i class="fa-solid fa-check text-emerald-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm">Рейс #R-2024-342 завершён</div>
                  <div class="text-xs text-muted">TR-001 • Москва → СПб • 5 мин назад</div>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                  <i class="fa-solid fa-gas-pump text-blue-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm">Заправка TR-023</div>
                  <div class="text-xs text-muted">380 л • ₽22,382 • 15 мин назад</div>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0">
                  <i class="fa-solid fa-triangle-exclamation text-amber-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm">Предупреждение о скорости</div>
                  <div class="text-xs text-muted">TR-012 • 95 км/ч в зоне 60 • 32 мин назад</div>
                </div>
              </div>
            </div>
            <div class="space-y-3">
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                  <i class="fa-solid fa-wrench text-purple-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm">ТО завершено</div>
                  <div class="text-xs text-muted">TR-007 • Замена масла • 1 час назад</div>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center flex-shrink-0">
                  <i class="fa-solid fa-file-signature text-cyan-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm">eTTН подписана</div>
                  <div class="text-xs text-muted">#2024-001254 • Все подписи • 2 часа назад</div>
                </div>
              </div>
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 rounded-xl bg-rose-500/20 flex items-center justify-center flex-shrink-0">
                  <i class="fa-solid fa-user-plus text-rose-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm">Новый водитель</div>
                  <div class="text-xs text-muted">Сергей Петров • 3 часа назад</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Costs Breakdown -->
        <div class="col-span-4 glass-panel p-5">
          <h3 class="font-semibold text-lg mb-4">Структура расходов</h3>
          <canvas id="costsChart" height="160"></canvas>
          <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full bg-amber-500"></span>
              <span class="text-muted">Топливо — 42%</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full bg-blue-500"></span>
              <span class="text-muted">ФОТ — 28%</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full bg-emerald-500"></span>
              <span class="text-muted">ТО — 15%</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-3 h-3 rounded-full bg-purple-500"></span>
              <span class="text-muted">Прочее — 15%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Finance -->
    <div id="tab-finance" class="tab-content">
      <div class="grid grid-cols-12 gap-4">
        <!-- Monthly Revenue Breakdown -->
        <div class="col-span-8 glass-panel p-5">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="font-semibold text-lg">Финансовый анализ</h3>
              <p class="text-sm text-muted">Детальная разбивка доходов и расходов</p>
            </div>
          </div>
          <canvas id="financeChart" height="200"></canvas>
        </div>
        
        <!-- Financial KPIs -->
        <div class="col-span-4 space-y-4">
          <div class="glass-panel p-5">
            <h4 class="font-medium mb-4">Ключевые показатели</h4>
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-muted">Средняя выручка за рейс</span>
                <span class="font-semibold">₽ 24,560</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Себестоимость км</span>
                <span class="font-semibold">₽ 48.20</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Маржинальность</span>
                <span class="font-semibold text-emerald-500">29.8%</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">ROI по флоту</span>
                <span class="font-semibold text-emerald-500">18.5%</span>
              </div>
            </div>
          </div>
          
          <div class="glass-panel p-5">
            <h4 class="font-medium mb-4">Прогноз на месяц</h4>
            <div class="text-3xl font-bold kpi-value mb-2">₽ 9.2M</div>
            <div class="text-sm text-muted mb-4">Ожидаемая выручка</div>
            <div class="progress-bar">
              <div class="progress-fill bg-gradient-to-r from-blue-500 to-emerald-500" style="width: 78%"></div>
            </div>
            <div class="text-xs text-muted mt-2">78% от целевого показателя</div>
          </div>
        </div>
        
        <!-- Expense Categories -->
        <div class="col-span-6 glass-panel p-5">
          <h3 class="font-semibold mb-4">Расходы по категориям</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-gas-pump text-amber-500"></i>
                </div>
                <div>
                  <div class="font-medium">Топливо</div>
                  <div class="text-sm text-muted">42% от общих расходов</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">₽ 2.48M</div>
                <div class="text-xs text-red-400">+5.2% к пред. месяцу</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-users text-blue-500"></i>
                </div>
                <div>
                  <div class="font-medium">ФОТ</div>
                  <div class="text-sm text-muted">28% от общих расходов</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">₽ 1.65M</div>
                <div class="text-xs text-emerald-400">-1.8% к пред. месяцу</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-wrench text-emerald-500"></i>
                </div>
                <div>
                  <div class="font-medium">Техобслуживание</div>
                  <div class="text-sm text-muted">15% от общих расходов</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">₽ 885K</div>
                <div class="text-xs text-emerald-400">-3.1% к пред. месяцу</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Revenue Sources -->
        <div class="col-span-6 glass-panel p-5">
          <h3 class="font-semibold mb-4">Источники выручки</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-building text-purple-500"></i>
                </div>
                <div>
                  <div class="font-medium">Корпоративные клиенты</div>
                  <div class="text-sm text-muted">65% выручки</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">₽ 5.46M</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-store text-cyan-500"></i>
                </div>
                <div>
                  <div class="font-medium">Розничные заказы</div>
                  <div class="text-sm text-muted">25% выручки</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">₽ 2.10M</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-rose-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-handshake text-rose-500"></i>
                </div>
                <div>
                  <div class="font-medium">Партнёрские перевозки</div>
                  <div class="text-sm text-muted">10% выручки</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">₽ 840K</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Tab Content: Fleet -->
    <div id="tab-fleet" class="tab-content">
      <div class="grid grid-cols-12 gap-4">
        <!-- Fleet Utilization -->
        <div class="col-span-8 glass-panel p-5">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="font-semibold text-lg">Использование флота</h3>
              <p class="text-sm text-muted">Статистика по транспортным средствам</p>
            </div>
          </div>
          <canvas id="fleetUtilChart" height="200"></canvas>
        </div>
        
        <!-- Fleet Summary -->
        <div class="col-span-4 space-y-4">
          <div class="glass-panel p-5">
            <h4 class="font-medium mb-4">Состояние флота</h4>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                  <span>В рейсе</span>
                </div>
                <span class="font-semibold">45 ТС</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full bg-blue-500"></span>
                  <span>На базе</span>
                </div>
                <span class="font-semibold">12 ТС</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full bg-amber-500"></span>
                  <span>На ТО</span>
                </div>
                <span class="font-semibold">5 ТС</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full bg-red-500"></span>
                  <span>Ремонт</span>
                </div>
                <span class="font-semibold">2 ТС</span>
              </div>
            </div>
          </div>
          
          <div class="glass-panel p-5">
            <h4 class="font-medium mb-4">Средний пробег</h4>
            <div class="text-3xl font-bold kpi-value mb-2">2,048 км</div>
            <div class="text-sm text-muted">в день на единицу</div>
          </div>
        </div>
        
        <!-- Top Vehicles -->
        <div class="col-span-12 glass-panel p-5">
          <h3 class="font-semibold mb-4">Топ транспортных средств по эффективности</h3>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="text-left text-muted text-sm border-b border-[var(--border-color)]">
                  <th class="pb-3">ТС</th>
                  <th class="pb-3">Водитель</th>
                  <th class="pb-3">Рейсов</th>
                  <th class="pb-3">Пробег</th>
                  <th class="pb-3">Расход топлива</th>
                  <th class="pb-3">Эффективность</th>
                </tr>
              </thead>
              <tbody class="text-sm" id="fleetTable">
                <tr class="border-b border-[var(--border-color)]">
                  <td class="py-3 font-medium">TR-001 • Volvo FH</td>
                  <td class="py-3 text-muted">Иванов А.С.</td>
                  <td class="py-3">28</td>
                  <td class="py-3">12,450 км</td>
                  <td class="py-3">28.5 л/100км</td>
                  <td class="py-3"><span class="px-2 py-1 rounded-full bg-emerald-500/15 text-emerald-500 text-xs">98%</span></td>
                </tr>
                <tr class="border-b border-[var(--border-color)]">
                  <td class="py-3 font-medium">TR-007 • MAN TGX</td>
                  <td class="py-3 text-muted">Петров Б.В.</td>
                  <td class="py-3">25</td>
                  <td class="py-3">11,200 км</td>
                  <td class="py-3">31.2 л/100км</td>
                  <td class="py-3"><span class="px-2 py-1 rounded-full bg-emerald-500/15 text-emerald-500 text-xs">95%</span></td>
                </tr>
                <tr class="border-b border-[var(--border-color)]">
                  <td class="py-3 font-medium">TR-012 • Scania R</td>
                  <td class="py-3 text-muted">Сидоров В.Г.</td>
                  <td class="py-3">24</td>
                  <td class="py-3">10,800 км</td>
                  <td class="py-3">32.1 л/100км</td>
                  <td class="py-3"><span class="px-2 py-1 rounded-full bg-blue-500/15 text-blue-500 text-xs">92%</span></td>
                </tr>
                <tr class="border-b border-[var(--border-color)]">
                  <td class="py-3 font-medium">TR-023 • DAF XF</td>
                  <td class="py-3 text-muted">Козлов Д.Е.</td>
                  <td class="py-3">22</td>
                  <td class="py-3">9,850 км</td>
                  <td class="py-3">29.8 л/100км</td>
                  <td class="py-3"><span class="px-2 py-1 rounded-full bg-blue-500/15 text-blue-500 text-xs">90%</span></td>
                </tr>
                <tr>
                  <td class="py-3 font-medium">TR-034 • Mercedes Actros</td>
                  <td class="py-3 text-muted">Новиков Е.Ж.</td>
                  <td class="py-3">21</td>
                  <td class="py-3">9,200 км</td>
                  <td class="py-3">30.5 л/100км</td>
                  <td class="py-3"><span class="px-2 py-1 rounded-full bg-amber-500/15 text-amber-500 text-xs">87%</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Tab Content: Drivers -->
    <div id="tab-drivers" class="tab-content">
      <div class="grid grid-cols-12 gap-4">
        <!-- Driver Performance -->
        <div class="col-span-8 glass-panel p-5">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="font-semibold text-lg">Рейтинг водителей</h3>
              <p class="text-sm text-muted">По показателям эффективности и безопасности</p>
            </div>
          </div>
          <canvas id="driverPerformanceChart" height="200"></canvas>
        </div>
        
        <!-- Driver Stats -->
        <div class="col-span-4 space-y-4">
          <div class="glass-panel p-5">
            <h4 class="font-medium mb-4">Общая статистика</h4>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-muted">Всего водителей</span>
                <span class="font-semibold">64</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">В рейсе</span>
                <span class="font-semibold text-emerald-500">45</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Отдых</span>
                <span class="font-semibold text-blue-500">15</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Отпуск/больничный</span>
                <span class="font-semibold text-amber-500">4</span>
              </div>
            </div>
          </div>
          
          <div class="glass-panel p-5">
            <h4 class="font-medium mb-4">Безопасность</h4>
            <div class="text-3xl font-bold kpi-value mb-2">98.5%</div>
            <div class="text-sm text-muted mb-4">Рейтинг безопасности</div>
            <div class="text-xs text-emerald-500 flex items-center gap-1">
              <i class="fa-solid fa-arrow-up"></i>
              +2.1% к прошлому месяцу
            </div>
          </div>
        </div>
        
        <!-- Top Drivers List -->
        <div class="col-span-12 glass-panel p-5">
          <h3 class="font-semibold mb-4">Лучшие водители месяца</h3>
          <div class="grid grid-cols-4 gap-4">
            <div class="glass-card p-4 text-center relative overflow-hidden">
              <div class="absolute top-2 right-2 w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center text-white font-bold">1</div>
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-emerald-500 mx-auto mb-3 flex items-center justify-center text-white text-xl font-bold">ИА</div>
              <div class="font-medium">Иванов Алексей</div>
              <div class="text-sm text-muted mb-2">28 рейсов</div>
              <div class="text-emerald-500 font-semibold">98% эффективность</div>
            </div>
            <div class="glass-card p-4 text-center relative overflow-hidden">
              <div class="absolute top-2 right-2 w-8 h-8 rounded-full bg-slate-400 flex items-center justify-center text-white font-bold">2</div>
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 mx-auto mb-3 flex items-center justify-center text-white text-xl font-bold">ПС</div>
              <div class="font-medium">Петров Сергей</div>
              <div class="text-sm text-muted mb-2">25 рейсов</div>
              <div class="text-emerald-500 font-semibold">96% эффективность</div>
            </div>
            <div class="glass-card p-4 text-center relative overflow-hidden">
              <div class="absolute top-2 right-2 w-8 h-8 rounded-full bg-amber-700 flex items-center justify-center text-white font-bold">3</div>
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-cyan-500 to-blue-500 mx-auto mb-3 flex items-center justify-center text-white text-xl font-bold">СМ</div>
              <div class="font-medium">Сидоров Михаил</div>
              <div class="text-sm text-muted mb-2">24 рейса</div>
              <div class="text-emerald-500 font-semibold">95% эффективность</div>
            </div>
            <div class="glass-card p-4 text-center relative overflow-hidden">
              <div class="absolute top-2 right-2 w-8 h-8 rounded-full bg-slate-600 flex items-center justify-center text-white font-bold">4</div>
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 mx-auto mb-3 flex items-center justify-center text-white text-xl font-bold">КД</div>
              <div class="font-medium">Козлов Дмитрий</div>
              <div class="text-sm text-muted mb-2">22 рейса</div>
              <div class="text-blue-500 font-semibold">92% эффективность</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Tab Content: Routes -->
    <div id="tab-routes" class="tab-content">
      <div class="grid grid-cols-12 gap-4">
        <!-- Route Map Placeholder -->
        <div class="col-span-8 glass-panel p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="font-semibold text-lg">Популярные маршруты</h3>
              <p class="text-sm text-muted">Анализ маршрутов за период</p>
            </div>
          </div>
          <div class="h-80 rounded-xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 flex items-center justify-center relative overflow-hidden">
            <div class="absolute inset-0 opacity-20">
              <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
                <defs>
                  <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" stroke-width="0.5"/>
                  </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#grid)"/>
              </svg>
            </div>
            <div class="text-center z-10">
              <i class="fa-solid fa-map-location-dot text-4xl text-blue-500 mb-3"></i>
              <div class="text-muted">Интерактивная карта маршрутов</div>
              <div class="text-sm text-muted mt-1">Открыть в разделе <a href="./geozones.html" class="text-blue-500 hover:underline">Геозоны</a></div>
            </div>
          </div>
        </div>
        
        <!-- Route Stats -->
        <div class="col-span-4 space-y-4">
          <div class="glass-panel p-5">
            <h4 class="font-medium mb-4">Статистика маршрутов</h4>
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-muted">Всего маршрутов</span>
                <span class="font-semibold">156</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Активных</span>
                <span class="font-semibold text-emerald-500">28</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Средняя длина</span>
                <span class="font-semibold">824 км</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Ср. время в пути</span>
                <span class="font-semibold">14.5 ч</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Top Routes -->
        <div class="col-span-12 glass-panel p-5">
          <h3 class="font-semibold mb-4">Самые востребованные маршруты</h3>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-4 glass-card rounded-xl">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center font-bold text-blue-500">1</div>
                <div>
                  <div class="font-medium">Москва → Санкт-Петербург</div>
                  <div class="text-sm text-muted">710 км • ~9 часов</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">48 рейсов</div>
                <div class="text-sm text-muted">14% от общего</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-4 glass-card rounded-xl">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center font-bold text-emerald-500">2</div>
                <div>
                  <div class="font-medium">Москва → Казань</div>
                  <div class="text-sm text-muted">820 км • ~11 часов</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">35 рейсов</div>
                <div class="text-sm text-muted">10% от общего</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-4 glass-card rounded-xl">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center font-bold text-purple-500">3</div>
                <div>
                  <div class="font-medium">Москва → Нижний Новгород</div>
                  <div class="text-sm text-muted">420 км • ~5.5 часов</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">32 рейса</div>
                <div class="text-sm text-muted">9% от общего</div>
              </div>
            </div>
            <div class="flex items-center justify-between p-4 glass-card rounded-xl">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center font-bold text-amber-500">4</div>
                <div>
                  <div class="font-medium">Санкт-Петербург → Екатеринбург</div>
                  <div class="text-sm text-muted">2,150 км • ~26 часов</div>
                </div>
              </div>
              <div class="text-right">
                <div class="font-semibold">28 рейсов</div>
                <div class="text-sm text-muted">8% от общего</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Tab Content: Reports -->
    <div id="tab-reports" class="tab-content">
      <div class="grid grid-cols-12 gap-4">
        <!-- Report Generator -->
        <div class="col-span-8 glass-panel p-5">
          <div class="flex items-center justify-between mb-6">
            <div>
              <h3 class="font-semibold text-lg">Генератор отчётов</h3>
              <p class="text-sm text-muted">Создание и экспорт отчётов</p>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-4 mb-6">
            <div>
              <label class="text-sm text-muted mb-2 block">Тип отчёта</label>
              <select class="w-full px-4 py-3 rounded-xl bg-[var(--bg-secondary)] border border-[var(--border-color)] focus:border-blue-500 focus:outline-none">
                <option>Финансовый отчёт</option>
                <option>Отчёт по флоту</option>
                <option>Отчёт по водителям</option>
                <option>Отчёт по маршрутам</option>
                <option>Сводный отчёт</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-muted mb-2 block">Период</label>
              <select class="w-full px-4 py-3 rounded-xl bg-[var(--bg-secondary)] border border-[var(--border-color)] focus:border-blue-500 focus:outline-none">
                <option>Последняя неделя</option>
                <option selected>Последний месяц</option>
                <option>Последний квартал</option>
                <option>Последний год</option>
                <option>Произвольный период</option>
              </select>
            </div>
          </div>
          
          <div class="flex gap-3">
            <button class="btn-primary flex items-center gap-2" onclick="exportReport()">
              <i class="fa-solid fa-file-pdf"></i>
              Экспорт в PDF
            </button>
            <button class="px-4 py-2 rounded-xl border border-[var(--border-color)] hover:bg-[var(--bg-secondary)] transition-colors flex items-center gap-2">
              <i class="fa-solid fa-file-excel"></i>
              Экспорт в Excel
            </button>
            <button class="px-4 py-2 rounded-xl border border-[var(--border-color)] hover:bg-[var(--bg-secondary)] transition-colors flex items-center gap-2">
              <i class="fa-solid fa-envelope"></i>
              Отправить на email
            </button>
          </div>
        </div>
        
        <!-- Scheduled Reports -->
        <div class="col-span-4 glass-panel p-5">
          <h4 class="font-medium mb-4">Автоматические отчёты</h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-calendar-check text-emerald-500"></i>
                <div>
                  <div class="font-medium text-sm">Еженедельный</div>
                  <div class="text-xs text-muted">Пн, 09:00</div>
                </div>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" checked class="sr-only peer">
                <div class="w-9 h-5 bg-slate-600 peer-checked:bg-emerald-500 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all"></div>
              </label>
            </div>
            <div class="flex items-center justify-between p-3 glass-card rounded-xl">
              <div class="flex items-center gap-3">
                <i class="fa-solid fa-calendar-days text-blue-500"></i>
                <div>
                  <div class="font-medium text-sm">Ежемесячный</div>
                  <div class="text-xs text-muted">1-е число, 10:00</div>
                </div>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" checked class="sr-only peer">
                <div class="w-9 h-5 bg-slate-600 peer-checked:bg-emerald-500 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all"></div>
              </label>
            </div>
          </div>
        </div>
        
        <!-- Recent Reports -->
        <div class="col-span-12 glass-panel p-5">
          <h3 class="font-semibold mb-4">Последние отчёты</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between p-3 rounded-xl hover:bg-[var(--bg-secondary)] transition-colors cursor-pointer">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-file-pdf text-red-500"></i>
                </div>
                <div>
                  <div class="font-medium">Финансовый отчёт — Декабрь 2025</div>
                  <div class="text-sm text-muted">Создан: 01.01.2026, 10:15</div>
                </div>
              </div>
              <button class="text-blue-500 hover:text-blue-400"><i class="fa-solid fa-download"></i></button>
            </div>
            <div class="flex items-center justify-between p-3 rounded-xl hover:bg-[var(--bg-secondary)] transition-colors cursor-pointer">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-file-excel text-emerald-500"></i>
                </div>
                <div>
                  <div class="font-medium">Отчёт по флоту — Q4 2025</div>
                  <div class="text-sm text-muted">Создан: 28.12.2025, 14:30</div>
                </div>
              </div>
              <button class="text-blue-500 hover:text-blue-400"><i class="fa-solid fa-download"></i></button>
            </div>
            <div class="flex items-center justify-between p-3 rounded-xl hover:bg-[var(--bg-secondary)] transition-colors cursor-pointer">
              <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center">
                  <i class="fa-solid fa-file-pdf text-red-500"></i>
                </div>
                <div>
                  <div class="font-medium">Сводный отчёт — Ноябрь 2025</div>
                  <div class="text-sm text-muted">Создан: 01.12.2025, 09:00</div>
                </div>
              </div>
              <button class="text-blue-500 hover:text-blue-400"><i class="fa-solid fa-download"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Theme management
    const savedTheme = localStorage.getItem('routoxTheme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('routoxTheme', next);
      updateChartColors();
      renderHeatmap();
    }

    function getChartColors() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      return {
        gridColor: isDark ? 'rgba(71, 85, 105, 0.2)' : 'rgba(226, 232, 240, 0.8)',
        textColor: isDark ? '#94a3b8' : '#64748b',
        tooltipBg: isDark ? 'rgba(17, 24, 39, 0.95)' : 'rgba(255, 255, 255, 0.95)',
        tooltipText: isDark ? '#fff' : '#1e293b'
      };
    }

    function updateChartColors() {
      const colors = getChartColors();
      const allCharts = [revenueChart, tripStatusChart, fuelChart, costsChart];
      if (financeChart) allCharts.push(financeChart);
      if (fleetUtilChart) allCharts.push(fleetUtilChart);
      if (driverPerformanceChart) allCharts.push(driverPerformanceChart);
      
      allCharts.forEach(chart => {
        if (!chart) return;
        if (chart.options.scales?.x) {
          chart.options.scales.x.grid.color = colors.gridColor;
          chart.options.scales.x.ticks.color = colors.textColor;
        }
        if (chart.options.scales?.y) {
          chart.options.scales.y.grid.color = colors.gridColor;
          chart.options.scales.y.ticks.color = colors.textColor;
        }
        if (chart.options.scales?.r) {
          chart.options.scales.r.angleLines.color = colors.gridColor;
          chart.options.scales.r.grid.color = colors.gridColor;
          chart.options.scales.r.pointLabels.color = colors.textColor;
        }
        if (chart.options.plugins?.legend?.labels) {
          chart.options.plugins.legend.labels.color = colors.textColor;
        }
        chart.update();
      });
    }

    const colors = getChartColors();

    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    const revenueChart = new Chart(revenueCtx, {
      type: 'line',
      data: {
        labels: ['Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек', 'Янв'],
        datasets: [{
          label: 'Выручка',
          data: [5.2, 5.8, 6.1, 5.9, 6.5, 7.2, 7.8, 7.5, 7.9, 8.1, 7.8, 8.4],
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 4,
          pointBackgroundColor: '#3b82f6',
          pointBorderColor: '#fff',
          pointBorderWidth: 2
        }, {
          label: 'Расходы',
          data: [3.8, 4.1, 4.3, 4.2, 4.6, 5.0, 5.4, 5.2, 5.5, 5.7, 5.5, 5.9],
          borderColor: '#f87171',
          backgroundColor: 'rgba(248, 113, 113, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 4,
          pointBackgroundColor: '#f87171',
          pointBorderColor: '#fff',
          pointBorderWidth: 2
        }, {
          label: 'Прибыль',
          data: [1.4, 1.7, 1.8, 1.7, 1.9, 2.2, 2.4, 2.3, 2.4, 2.4, 2.3, 2.5],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 4,
          pointBackgroundColor: '#10b981',
          pointBorderColor: '#fff',
          pointBorderWidth: 2
        }]
      },
      options: {
        responsive: true,
        interaction: { intersect: false, mode: 'index' },
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: { label: (ctx) => `${ctx.dataset.label}: ₽${ctx.raw}M` } }
        },
        scales: {
          x: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor } },
          y: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor, callback: (val) => `₽${val}M` } }
        }
      }
    });

    // Trip Status Chart
    const tripStatusCtx = document.getElementById('tripStatusChart').getContext('2d');
    const tripStatusChart = new Chart(tripStatusCtx, {
      type: 'doughnut',
      data: {
        labels: ['Завершены', 'В пути', 'Запланированы', 'Отменены'],
        datasets: [{ data: [342, 28, 45, 12], backgroundColor: ['#10b981', '#3b82f6', '#f59e0b', '#ef4444'], borderWidth: 0, hoverOffset: 10 }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'bottom', labels: { color: colors.textColor, usePointStyle: true, padding: 10 } } },
        cutout: '60%'
      }
    });

    // Fuel Efficiency Chart
    const fuelCtx = document.getElementById('fuelEfficiencyChart').getContext('2d');
    const fuelChart = new Chart(fuelCtx, {
      type: 'bar',
      data: {
        labels: ['TR-001', 'TR-007', 'TR-012', 'TR-023', 'TR-034', 'TR-045'],
        datasets: [{
          label: 'Факт',
          data: [28.5, 31.2, 35.8, 29.4, 32.1, 38.5],
          backgroundColor: 'rgba(59, 130, 246, 0.8)',
          borderRadius: 8
        }, {
          label: 'Норма',
          data: [30, 30, 32, 30, 32, 32],
          backgroundColor: 'rgba(16, 185, 129, 0.3)',
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: colors.textColor, usePointStyle: true } } },
        scales: {
          x: { grid: { display: false }, ticks: { color: colors.textColor } },
          y: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor, callback: (val) => `${val} л/100км` } }
        }
      }
    });

    // Costs Chart
    const costsCtx = document.getElementById('costsChart').getContext('2d');
    const costsChart = new Chart(costsCtx, {
      type: 'doughnut',
      data: {
        labels: ['Топливо', 'ФОТ', 'ТО', 'Прочее'],
        datasets: [{ data: [42, 28, 15, 15], backgroundColor: ['#f59e0b', '#3b82f6', '#10b981', '#8b5cf6'], borderWidth: 0, hoverOffset: 10 }]
      },
      options: { responsive: true, plugins: { legend: { display: false } }, cutout: '70%' }
    });

    // Finance Chart (for Finance tab)
    let financeChart = null;
    function initFinanceChart() {
      if (financeChart) return;
      const ctx = document.getElementById('financeChart');
      if (!ctx) return;
      financeChart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'],
          datasets: [{
            label: 'Доходы',
            data: [5.2, 5.8, 6.1, 5.9, 6.5, 7.2, 7.8, 7.5, 7.9, 8.1, 7.8, 8.4],
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderRadius: 6
          }, {
            label: 'Расходы',
            data: [3.8, 4.1, 4.3, 4.2, 4.6, 5.0, 5.4, 5.2, 5.5, 5.7, 5.5, 5.9],
            backgroundColor: 'rgba(239, 68, 68, 0.8)',
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: colors.textColor } } },
          scales: {
            x: { grid: { display: false }, ticks: { color: colors.textColor } },
            y: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor, callback: (val) => `₽${val}M` } }
          }
        }
      });
    }

    // Fleet Utilization Chart (for Fleet tab)
    let fleetUtilChart = null;
    function initFleetChart() {
      if (fleetUtilChart) return;
      const ctx = document.getElementById('fleetUtilChart');
      if (!ctx) return;
      fleetUtilChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: ['1', '5', '10', '15', '20', '25', '30'],
          datasets: [{
            label: 'Утилизация флота',
            data: [82, 85, 88, 84, 87, 91, 87],
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            fill: true,
            tension: 0.4
          }, {
            label: 'Простои',
            data: [18, 15, 12, 16, 13, 9, 13],
            borderColor: '#f59e0b',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            fill: true,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: colors.textColor } } },
          scales: {
            x: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor } },
            y: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor, callback: (val) => `${val}%` }, max: 100 }
          }
        }
      });
    }

    // Driver Performance Chart (for Drivers tab)
    let driverPerformanceChart = null;
    function initDriverChart() {
      if (driverPerformanceChart) return;
      const ctx = document.getElementById('driverPerformanceChart');
      if (!ctx) return;
      driverPerformanceChart = new Chart(ctx.getContext('2d'), {
        type: 'radar',
        data: {
          labels: ['Эффективность', 'Безопасность', 'Пунктуальность', 'Экономия топлива', 'Рейтинг клиентов', 'Соблюдение РТО'],
          datasets: [{
            label: 'Средний показатель',
            data: [85, 92, 88, 78, 90, 95],
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            borderColor: '#3b82f6',
            pointBackgroundColor: '#3b82f6'
          }, {
            label: 'Лучший водитель',
            data: [98, 99, 96, 92, 98, 100],
            backgroundColor: 'rgba(16, 185, 129, 0.2)',
            borderColor: '#10b981',
            pointBackgroundColor: '#10b981'
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { labels: { color: colors.textColor } } },
          scales: {
            r: {
              angleLines: { color: colors.gridColor },
              grid: { color: colors.gridColor },
              pointLabels: { color: colors.textColor },
              ticks: { display: false }
            }
          }
        }
      });
    }

    // Heatmap
    function renderHeatmap() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      const container = document.getElementById('heatmap');
      const days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
      const hours = 8;
      
      // Sample activity data (0-10 scale)
      const data = [
        [2,1,0,3,5,7,8,6],
        [1,0,1,4,6,8,9,7],
        [0,1,2,5,7,9,8,5],
        [1,0,2,4,6,8,7,4],
        [2,1,3,5,7,9,8,6],
        [0,0,1,2,3,4,3,2],
        [0,0,0,1,2,2,1,1]
      ];

      container.innerHTML = days.map((day, dayIndex) => {
        const cells = data[dayIndex].map((value, hourIndex) => {
          const opacity = value / 10;
          const bgColor = isDark 
            ? `rgba(59, 130, 246, ${opacity})` 
            : `rgba(59, 130, 246, ${opacity * 0.8 + 0.1})`;
          return `<div class="heatmap-cell w-6 h-6" style="background: ${bgColor};" title="${day} ${hourIndex * 3}:00 - ${value * 10}%"></div>`;
        }).join('');
        return `<div class="flex items-center gap-1"><span class="text-xs text-muted w-6">${day}</span>${cells}</div>`;
      }).join('');
    }

    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        const tabId = `tab-${btn.dataset.tab}`;
        document.getElementById(tabId).classList.add('active');
        
        // Initialize charts when tab is opened
        if (btn.dataset.tab === 'finance') initFinanceChart();
        if (btn.dataset.tab === 'fleet') initFleetChart();
        if (btn.dataset.tab === 'drivers') initDriverChart();
      });
    });

    // Export report
    function exportReport() {
      alert('Отчёт будет экспортирован в PDF. В реальном приложении здесь откроется диалог выбора формата и параметров отчёта.');
    }

    // Date range change
    document.getElementById('dateRange').addEventListener('change', function() {
      // In real app, this would reload data for selected period
      console.log('Date range changed to:', this.value, 'days');
    });

    // Initial render
    renderHeatmap();

  </script>
  <script src="./assets/js/routa-core.js"></script>
  <script src="./assets/js/routox-unified.js"></script>
  <script src="./assets/js/routox-ai.js"></script>
  <script>
    // ========== ROUTA PLATFORM INITIALIZATION ==========
    (async function() {
      Routa.Theme.load();
      const user = await Routa.App.init({
        requireAuth: true,
        currentPage: 'analytics.html'
      });
      if (!user) return;
      console.log('Analytics page initialized for:', user.role, user.edition);
    })();
    
    function logout() { Routa.Auth.logout(); }
    function toggleTheme() { Routa.Theme.toggle(); }
  </script>
</body>
</html>
