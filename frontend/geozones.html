<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoutoX ‚Äî –ì–µ–æ–∑–æ–Ω—ã</title>
  <link rel="stylesheet" href="./assets/css/routox-unified.css">
  <link rel="stylesheet" href="./assets/css/page-transitions.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script src="https://kit.fontawesome.com/a2e0e9e5a9.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <style>
    #geozoneMap { border-radius: 16px; z-index: 1; }
    .leaflet-control-zoom { border: none !important; border-radius: 10px !important; overflow: hidden; }
    .leaflet-control-zoom a { background: var(--bg-secondary) !important; color: var(--text-primary) !important; border: 1px solid var(--border-color) !important; }
    .zone-type { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .zone-warehouse { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
    .zone-client { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .zone-restricted { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
    .zone-fuel { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
    .zone-rest { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
    .zone-customs { background: rgba(236, 72, 153, 0.15); color: #ec4899; }
    .zone-platon { background: rgba(20, 184, 166, 0.15); color: #14b8a6; }
    .zone-item { transition: all 0.2s ease; cursor: pointer; border-radius: 12px; border: 1px solid transparent; }
    .zone-item:hover { background: rgba(59, 130, 246, 0.08); transform: translateX(4px); }
    .zone-item.active { background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3); }
    .draw-tool { width: 48px; height: 48px; border-radius: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; cursor: pointer; color: var(--text-secondary); }
    .draw-tool:hover { background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3); color: #3b82f6; }
    .draw-tool.active { background: linear-gradient(135deg, #3b82f6, #2563eb); border-color: #3b82f6; color: white; }
    .event-row { transition: all 0.2s ease; border-radius: 12px; }
    .event-row:hover { background: rgba(59, 130, 246, 0.08); }
    .live-pulse { animation: pulse 2s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .stat-value { font-size: 28px; font-weight: 700; background: linear-gradient(135deg, #3b82f6, #10b981); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .modal-backdrop { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
    [data-theme="dark"] .modal-backdrop { background: rgba(0,0,0,0.8); }
    .role-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .role-badge.admin { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
    .role-badge.owner { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; border: 1px solid rgba(139, 92, 246, 0.3); }
    .role-badge.dispatcher { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
    .role-badge.logist { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }
    .nav-item-active {
        background: rgba(255, 255, 255, 0.9);
        color: #f59e0b !important;
        box-shadow: 0 2px 10px rgba(245, 158, 11, 0.15);
        font-weight: 600 !important;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="h-16 glass-panel flex items-center justify-between px-6 z-40 shrink-0 border-b border-white/50 sticky top-0 mx-4 mt-4 rounded-2xl">
    <div class="flex items-center gap-12">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white font-extrabold text-xl shadow-lg shadow-amber-500/20">
                R
            </div>
            <div class="flex flex-col">
                <span class="font-bold text-lg leading-none tracking-tight text-slate-800">RoutoX</span>
                <span class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mt-0.5">Logist Panel</span>
            </div>
        </div>
        <nav class="hidden lg:flex items-center gap-1 bg-slate-100/50 p-1 rounded-xl">
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="logist.html">–ó–∞–∫–∞–∑—ã</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="routes.html">–ú–∞—Ä—à—Ä—É—Ç—ã</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="trips.html">–†–µ–π—Å—ã</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="drivers-manage.html">–í–æ–¥–∏—Ç–µ–ª–∏</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="clients.html">–ö–ª–∏–µ–Ω—Ç—ã</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="warehouse.html">–°–∫–ª–∞–¥</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="loading-plan.html">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="delivery-stats.html">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
            <a class="px-3 py-1.5 rounded-lg text-sm font-semibold nav-item-active transition-all" href="geozones.html">–ì–µ–æ–∑–æ–Ω—ã</a>
        </nav>
    </div>
    <div class="flex items-center gap-5">
        <div class="px-3 py-1.5 bg-white/60 backdrop-blur-md border border-white/60 rounded-full flex items-center gap-2 shadow-sm">
            <span class="relative flex h-2.5 w-2.5">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
            </span>
            <span class="text-xs font-bold text-slate-700 tracking-tight">LIVE</span>
        </div>
        <div class="h-6 w-px bg-slate-200"></div>
        <span class="role-badge logist px-3 py-1.5 rounded-full text-xs font-semibold" style="background: rgba(245, 158, 11, 0.15); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3);">
            <i class="fa-solid fa-route"></i>
            <span>–õ–æ–≥–∏—Å—Ç</span>
        </span>
        <div class="flex items-center gap-3 pl-1 pr-1 py-1 bg-white/50 border border-white rounded-full shadow-sm hover:shadow-md transition-shadow cursor-pointer">
            <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden ring-2 ring-white">
                <img alt="User" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCTs9iN8pKS03W5I54u9FB4B-c8kh0-SvddoYiVdknvnn0XFQ_ScxzcOGMuvCw75ZDO7eej3OBFSUyW7YGzfIdw8bm2JVE2qYntX-6WFsuWZDXeCjqgvXyR-Lo9UnAE2bTQejiaicaZNqXTEEWzBEmoalZytqScbtdaXlk0i5laN5yjsqI3j457keHzESRrW4bLeWD2l5xuer1uZ4Zd_LMeP8p-XTEa4_wtLTcRyHGOncDuMQUJk788z8tvDII7r8UTdnahdzzaAtY"/>
            </div>
            <div class="pr-3 flex flex-col items-end leading-none">
                <p class="text-xs font-bold text-slate-800" id="userName">–õ–æ–≥–∏—Å—Ç</p>
                <p class="text-[9px] text-amber-600 font-semibold mt-0.5" id="userRole">Pro</p>
            </div>
        </div>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-700 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50 relative" title="–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" onclick="window.location.href='notifications.html'">
            <span class="material-symbols-outlined text-[20px]">notifications</span>
            <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full ring-2 ring-white"></span>
        </button>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-red-500 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50" title="–í—ã—Ö–æ–¥" onclick="logout()">
            <span class="material-symbols-outlined text-[20px]">logout</span>
        </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="p-4 grid grid-cols-12 gap-4" style="height: calc(100vh - 100px);">
    <!-- Left Panel - Zone List -->
    <aside class="col-span-3 space-y-4 overflow-hidden flex flex-col">
      <div class="glass-panel p-4">
        <button class="btn-primary w-full flex items-center justify-center gap-2" onclick="showCreateZoneModal()">
          <i class="fa-solid fa-plus"></i>–°–æ–∑–¥–∞—Ç—å –≥–µ–æ–∑–æ–Ω—É
        </button>
      </div>

      <div class="glass-panel p-4">
        <div class="text-xs text-muted uppercase tracking-wider mb-3">–¢–∏–ø—ã –∑–æ–Ω</div>
        <div class="flex flex-wrap gap-2">
          <button class="zone-type zone-warehouse" data-filter="warehouse">–°–∫–ª–∞–¥—ã</button>
          <button class="zone-type zone-client" data-filter="client">–ö–ª–∏–µ–Ω—Ç—ã</button>
          <button class="zone-type zone-fuel" data-filter="fuel">–ê–ó–°</button>
          <button class="zone-type zone-restricted" data-filter="restricted">–ó–∞–ø—Ä–µ—Ç</button>
          <button class="zone-type zone-rest" data-filter="rest">–û—Ç–¥—ã—Ö</button>
          <button class="zone-type zone-customs" data-filter="customs">–¢–∞–º–æ–∂–Ω—è</button>
          <button class="zone-type zone-platon" data-filter="platon">–ü–ª–∞—Ç–æ–Ω</button>
        </div>
      </div>

      <div class="glass-panel p-4 flex-1 overflow-hidden flex flex-col">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold">–ì–µ–æ–∑–æ–Ω—ã</h3>
          <span class="text-xs px-2 py-1 rounded-lg bg-slate-100 dark:bg-slate-800 text-muted" id="zoneCount">24 –∑–æ–Ω—ã</span>
        </div>
        <div class="relative mb-3">
          <input type="text" placeholder="–ü–æ–∏—Å–∫ –∑–æ–Ω..." class="input-field w-full rounded-xl px-4 py-2.5 pl-10 text-sm">
          <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-muted text-sm"></i>
        </div>
        <div class="space-y-2 overflow-y-auto custom-scroll flex-1" id="zoneList"></div>
      </div>
    </aside>

    <!-- Center Panel - Map -->
    <section class="col-span-6 glass-panel p-4 relative overflow-hidden">
      <div id="geozoneMap" class="absolute inset-4 rounded-2xl"></div>
      
      <div class="absolute top-8 left-8 z-10 flex flex-col gap-2">
        <div class="draw-tool" data-tool="circle" title="–ö—Ä—É–≥–æ–≤–∞—è –∑–æ–Ω–∞"><i class="fa-regular fa-circle"></i></div>
        <div class="draw-tool" data-tool="polygon" title="–ü–æ–ª–∏–≥–æ–Ω"><i class="fa-solid fa-draw-polygon"></i></div>
        <div class="draw-tool" data-tool="rectangle" title="–ü—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫"><i class="fa-regular fa-square"></i></div>
        <div class="draw-tool" data-tool="route" title="–ö–æ—Ä–∏–¥–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∞"><i class="fa-solid fa-road"></i></div>
      </div>

      <div class="absolute top-8 right-8 z-10 flex gap-2">
        <button class="icon-btn" title="–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¢–°"><i class="fa-solid fa-truck text-blue-500"></i></button>
        <button class="icon-btn" title="–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å"><i class="fa-solid fa-crosshairs text-muted"></i></button>
        <button class="icon-btn" title="–°–ª–æ–∏"><i class="fa-solid fa-layer-group text-muted"></i></button>
      </div>

      <div class="absolute bottom-8 left-8 right-8 z-10">
        <div class="glass-card p-4 flex items-center justify-between">
          <div class="flex items-center gap-8">
            <div class="text-center">
              <div class="stat-value">12</div>
              <div class="text-xs text-muted">–¢–° –≤ –∑–æ–Ω–∞—Ö</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-emerald-500">8</div>
              <div class="text-xs text-muted">–í—ä–µ–∑–¥–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-amber-500">3</div>
              <div class="text-xs text-muted">–ù–∞—Ä—É—à–µ–Ω–∏—è</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="text-xs text-muted">–û–±–Ω–æ–≤–ª–µ–Ω–æ:</span>
            <span class="text-xs font-medium" id="lastUpdate">—Ç–æ–ª—å–∫–æ —á—Ç–æ</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Right Panel - Zone Details & Events -->
    <aside class="col-span-3 space-y-4 overflow-hidden flex flex-col">
      <div class="glass-panel p-5" id="zoneDetails">
        <div class="flex items-center justify-between mb-4">
          <span class="text-xs text-muted uppercase tracking-wider">–í—ã–±—Ä–∞–Ω–Ω–∞—è –∑–æ–Ω–∞</span>
          <span class="zone-type zone-warehouse" id="zoneTypeBadge">–°–∫–ª–∞–¥</span>
        </div>

        <div class="flex justify-center mb-4">
          <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-500/20 to-emerald-500/20 border border-blue-500/30 flex items-center justify-center relative">
            <i class="fa-solid fa-warehouse text-3xl text-blue-500" id="zoneIcon"></i>
            <div class="absolute -bottom-2 -right-2 w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center text-xs font-bold text-white" id="zoneVehicleCount">3</div>
          </div>
        </div>

        <h3 class="text-lg font-bold text-center" id="zoneName">–°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞-–Æ–≥</h3>
        <p class="text-sm text-muted text-center mb-4" id="zoneAddress">–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°–∫–ª–∞–¥—Å–∫–∞—è, 15</p>

        <div class="space-y-3 text-sm">
          <div class="flex justify-between items-center">
            <span class="text-muted">–†–∞–¥–∏—É—Å</span>
            <span class="font-medium" id="zoneRadius">500 –º</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-muted">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
              <span class="text-emerald-500 text-sm">–ê–∫—Ç–∏–≤–Ω—ã</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-muted">–ê–≤—Ç–æ-eTT–ù</span>
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
              <span class="text-emerald-500 text-sm">–í–∫–ª—é—á–µ–Ω–æ</span>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-muted">–ú–∞–∫—Å. –ø—Ä–æ—Å—Ç–æ–π</span>
            <span class="font-medium">2 —á–∞—Å–∞</span>
          </div>
        </div>

        <div class="mt-5 pt-5 border-t border-current" style="border-color: var(--border-color);">
          <div class="text-xs text-muted mb-3">–¢–° –≤ –∑–æ–Ω–µ —Å–µ–π—á–∞—Å</div>
          <div class="space-y-2" id="vehiclesInZone">
            <div class="flex items-center gap-3 p-2 rounded-lg glass-card">
              <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center">
                <i class="fa-solid fa-truck text-blue-500 text-sm"></i>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium">TR-001</div>
                <div class="text-xs text-muted">–í –∑–æ–Ω–µ 45 –º–∏–Ω</div>
              </div>
              <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            </div>
            <div class="flex items-center gap-3 p-2 rounded-lg glass-card">
              <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center">
                <i class="fa-solid fa-truck text-blue-500 text-sm"></i>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium">TR-007</div>
                <div class="text-xs text-muted">–í –∑–æ–Ω–µ 12 –º–∏–Ω</div>
              </div>
              <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            </div>
            <div class="flex items-center gap-3 p-2 rounded-lg bg-amber-500/10 border border-amber-500/20">
              <div class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center">
                <i class="fa-solid fa-truck text-amber-500 text-sm"></i>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium">TR-023</div>
                <div class="text-xs text-amber-500">–ü—Ä–æ—Å—Ç–æ–π 2—á 15–º–∏–Ω!</div>
              </div>
              <span class="w-2 h-2 rounded-full bg-amber-500 live-pulse"></span>
            </div>
          </div>
        </div>

        <div class="flex gap-2 mt-5">
          <button class="flex-1 btn-primary text-sm flex items-center justify-center gap-2">
            <i class="fa-solid fa-pen"></i>–ò–∑–º–µ–Ω–∏—Ç—å
          </button>
          <button class="icon-btn"><i class="fa-solid fa-trash text-red-500"></i></button>
        </div>
      </div>

      <div class="glass-panel p-4 flex-1 overflow-hidden flex flex-col">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold">–°–æ–±—ã—Ç–∏—è</h3>
          <button class="text-xs text-blue-500 hover:underline">–í—Å–µ ‚Üí</button>
        </div>
        <div class="space-y-2 overflow-y-auto custom-scroll flex-1" id="eventsList">
          <div class="event-row flex items-start gap-3 p-3">
            <div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-arrow-right-to-bracket text-emerald-500 text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="text-sm">TR-001 –≤—ä–µ—Ö–∞–ª –≤ –∑–æ–Ω—É</div>
              <div class="text-xs text-muted">–°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞-–Æ–≥ ‚Ä¢ 2 –º–∏–Ω –Ω–∞–∑–∞–¥</div>
            </div>
          </div>
          <div class="event-row flex items-start gap-3 p-3">
            <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-arrow-right-from-bracket text-blue-500 text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="text-sm">TR-012 –ø–æ–∫–∏–Ω—É–ª –∑–æ–Ω—É</div>
              <div class="text-xs text-muted">–ö–ª–∏–µ–Ω—Ç "–°–µ–≤–µ—Ä–Ω–∞—è –ó–≤–µ–∑–¥–∞" ‚Ä¢ 15 –º–∏–Ω –Ω–∞–∑–∞–¥</div>
            </div>
          </div>
          <div class="event-row flex items-start gap-3 p-3 bg-amber-500/10 rounded-xl">
            <div class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-clock text-amber-500 text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="text-sm text-amber-600">–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ—è</div>
              <div class="text-xs text-muted">TR-023 ‚Ä¢ –°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞-–Æ–≥ ‚Ä¢ 30 –º–∏–Ω –Ω–∞–∑–∞–¥</div>
            </div>
          </div>
          <div class="event-row flex items-start gap-3 p-3 bg-red-500/10 rounded-xl">
            <div class="w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-ban text-red-500 text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="text-sm text-red-500">–í—ä–µ–∑–¥ –≤ –∑–∞–ø—Ä–µ—Ç–Ω—É—é –∑–æ–Ω—É</div>
              <div class="text-xs text-muted">TR-045 ‚Ä¢ –¶–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞ ‚Ä¢ 1 —á–∞—Å –Ω–∞–∑–∞–¥</div>
            </div>
          </div>
          <div class="event-row flex items-start gap-3 p-3">
            <div class="w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-file-signature text-cyan-500 text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="text-sm">eTT–ù —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</div>
              <div class="text-xs text-muted">TR-007 ‚Ä¢ –ö–ª–∏–µ–Ω—Ç "–¢—Ä–∞–Ω—Å–õ–æ–≥" ‚Ä¢ 2 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</div>
            </div>
          </div>
          <div class="event-row flex items-start gap-3 p-3">
            <div class="w-8 h-8 rounded-lg bg-purple-500/20 flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-bed text-purple-500 text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="text-sm">–ù–∞—á–∞–ª–æ –æ—Ç–¥—ã—Ö–∞ –≤–æ–¥–∏—Ç–µ–ª—è</div>
              <div class="text-xs text-muted">TR-034 ‚Ä¢ –ó–æ–Ω–∞ –æ—Ç–¥—ã—Ö–∞ –ú4 ‚Ä¢ 3 —á–∞—Å–∞ –Ω–∞–∑–∞–¥</div>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Create Zone Modal -->
  <div id="createZoneModal" class="fixed inset-0 modal-backdrop z-50 hidden items-center justify-center">
    <div class="glass-panel w-full max-w-lg mx-4 p-6 max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold">–°–æ–∑–¥–∞—Ç—å –≥–µ–æ–∑–æ–Ω—É</h2>
        <button onclick="closeCreateZoneModal()" class="icon-btn"><i class="fa-solid fa-xmark text-muted"></i></button>
      </div>
      <form class="space-y-4">
        <div>
          <label class="text-sm text-muted mb-2 block">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–æ–Ω—ã</label>
          <input type="text" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞-–Æ–≥" class="input-field w-full rounded-xl px-4 py-3">
        </div>
        <div>
          <label class="text-sm text-muted mb-2 block">–¢–∏–ø –∑–æ–Ω—ã</label>
          <select class="input-field w-full rounded-xl px-4 py-3">
            <option value="warehouse">üè≠ –°–∫–ª–∞–¥ / –¢–µ—Ä–º–∏–Ω–∞–ª</option>
            <option value="client">üè¢ –ö–ª–∏–µ–Ω—Ç</option>
            <option value="fuel">‚õΩ –ê–ó–° –ø–∞—Ä—Ç–Ω—ë—Ä–∞</option>
            <option value="restricted">üö´ –ó–∞–ø—Ä–µ—Ç–Ω–∞—è –∑–æ–Ω–∞</option>
            <option value="rest">üõèÔ∏è –ó–æ–Ω–∞ –æ—Ç–¥—ã—Ö–∞</option>
            <option value="customs">üõÉ –¢–∞–º–æ–∂–µ–Ω–Ω—ã–π –ø–æ—Å—Ç</option>
            <option value="platon">üõ£Ô∏è –ü–ª–∞—Ç–æ–Ω-–∑–æ–Ω–∞</option>
          </select>
        </div>
        <div>
          <label class="text-sm text-muted mb-2 block">–ê–¥—Ä–µ—Å</label>
          <input type="text" placeholder="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°–∫–ª–∞–¥—Å–∫–∞—è, 15" class="input-field w-full rounded-xl px-4 py-3">
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-muted mb-2 block">–®–∏—Ä–æ—Ç–∞</label>
            <input type="number" step="0.000001" placeholder="55.751244" class="input-field w-full rounded-xl px-4 py-3">
          </div>
          <div>
            <label class="text-sm text-muted mb-2 block">–î–æ–ª–≥–æ—Ç–∞</label>
            <input type="number" step="0.000001" placeholder="37.618423" class="input-field w-full rounded-xl px-4 py-3">
          </div>
        </div>
        <div>
          <label class="text-sm text-muted mb-2 block">–†–∞–¥–∏—É—Å (–º–µ—Ç—Ä—ã)</label>
          <input type="range" min="100" max="5000" value="500" class="w-full accent-blue-500" id="radiusSlider">
          <div class="flex justify-between text-xs text-muted mt-1">
            <span>100–º</span>
            <span id="radiusValue">500–º</span>
            <span>5–∫–º</span>
          </div>
        </div>
        <div class="glass-card p-4 space-y-3">
          <div class="text-sm font-medium mb-2">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</div>
          <label class="flex items-center justify-between gap-3">
            <span class="text-sm text-muted">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—ä–µ–∑–¥–µ/–≤—ã–µ–∑–¥–µ</span>
            <input type="checkbox" checked class="rounded accent-blue-500">
          </label>
          <label class="flex items-center justify-between gap-3">
            <span class="text-sm text-muted">–ê–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–µ eTT–ù</span>
            <input type="checkbox" class="rounded accent-blue-500">
          </label>
          <label class="flex items-center justify-between gap-3">
            <span class="text-sm text-muted">–ö–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–æ—Å—Ç–æ—è</span>
            <input type="checkbox" checked class="rounded accent-blue-500">
          </label>
          <div class="flex items-center justify-between gap-3">
            <span class="text-sm text-muted">–ú–∞–∫—Å. –≤—Ä–µ–º—è –ø—Ä–æ—Å—Ç–æ—è</span>
            <select class="input-field rounded-lg px-3 py-1 text-sm">
              <option>30 –º–∏–Ω—É—Ç</option>
              <option>1 —á–∞—Å</option>
              <option selected>2 —á–∞—Å–∞</option>
              <option>4 —á–∞—Å–∞</option>
            </select>
          </div>
        </div>
        <div class="glass-card p-4 space-y-3">
          <div class="text-sm font-medium mb-2">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</div>
          <label class="flex items-center justify-between gap-3">
            <span class="text-sm text-muted">–°–∏—Å—Ç–µ–º–∞ –ü–ª–∞—Ç–æ–Ω</span>
            <input type="checkbox" class="rounded accent-blue-500">
          </label>
          <label class="flex items-center justify-between gap-3">
            <span class="text-sm text-muted">–£—á—ë—Ç —Ä–µ–∂–∏–º–∞ —Ç—Ä—É–¥–∞/–æ—Ç–¥—ã—Ö–∞</span>
            <input type="checkbox" checked class="rounded accent-blue-500">
          </label>
        </div>
        <div class="flex gap-3 pt-4">
          <button type="submit" class="flex-1 btn-primary py-3 flex items-center justify-center gap-2">
            <i class="fa-solid fa-check"></i>–°–æ–∑–¥–∞—Ç—å –∑–æ–Ω—É
          </button>
          <button type="button" onclick="closeCreateZoneModal()" class="flex-1 glass-card py-3 hover:bg-slate-100">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Theme management
    const savedTheme = localStorage.getItem('routoxTheme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('routoxTheme', next);
      updateMapTiles();
    }

    // Initialize map
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const map = L.map('geozoneMap', { zoomControl: false }).setView([55.7558, 37.6173], 10);
    L.control.zoom({ position: 'bottomright' }).addTo(map);
    
    let tileLayer = L.tileLayer(
      isDark 
        ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
        : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
      { attribution: '¬© OpenStreetMap' }
    ).addTo(map);

    function updateMapTiles() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      tileLayer.setUrl(
        isDark 
          ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
          : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png'
      );
    }

    // Zone data
    const zones = [
      { id: 1, name: '–°–∫–ª–∞–¥ –ú–æ—Å–∫–≤–∞-–Æ–≥', type: 'warehouse', lat: 55.6200, lng: 37.7000, radius: 500, vehicles: 3, address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°–∫–ª–∞–¥—Å–∫–∞—è, 15' },
      { id: 2, name: '–ö–ª–∏–µ–Ω—Ç "–°–µ–≤–µ—Ä–Ω–∞—è –ó–≤–µ–∑–¥–∞"', type: 'client', lat: 55.8200, lng: 37.5000, radius: 300, vehicles: 1, address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°–µ–≤–µ—Ä–Ω–∞—è, 42' },
      { id: 3, name: '–ê–ó–° –õ—É–∫–æ–π–ª –ú4', type: 'fuel', lat: 55.5500, lng: 37.8500, radius: 200, vehicles: 0, address: '–¢—Ä–∞—Å—Å–∞ –ú4, 45 –∫–º' },
      { id: 4, name: '–¶–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞ (–∑–∞–ø—Ä–µ—Ç)', type: 'restricted', lat: 55.7558, lng: 37.6173, radius: 2000, vehicles: 0, address: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Ä–∞–π–æ–Ω' },
      { id: 5, name: '–ó–æ–Ω–∞ –æ—Ç–¥—ã—Ö–∞ –ú4 –∫–º 100', type: 'rest', lat: 55.4800, lng: 37.9200, radius: 400, vehicles: 2, address: '–¢—Ä–∞—Å—Å–∞ –ú4, 100 –∫–º' },
      { id: 6, name: '–¢–∞–º–æ–∂–Ω—è –ë—Ä—è–Ω—Å–∫', type: 'customs', lat: 53.2521, lng: 34.3717, radius: 1000, vehicles: 0, address: '–≥. –ë—Ä—è–Ω—Å–∫, –¢–∞–º–æ–∂–µ–Ω–Ω—ã–π –ø–æ—Å—Ç' },
      { id: 7, name: '–ü–ª–∞—Ç–æ–Ω-—É—á–∞—Å—Ç–æ–∫ –ú7', type: 'platon', lat: 55.7963, lng: 49.1088, radius: 5000, vehicles: 4, address: '–¢—Ä–∞—Å—Å–∞ –ú7, —É—á–∞—Å—Ç–æ–∫ 15' },
      { id: 8, name: '–¢–µ—Ä–º–∏–Ω–∞–ª –°–ü–±', type: 'warehouse', lat: 59.9343, lng: 30.3351, radius: 800, vehicles: 2, address: '–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ü—É–ª–∫–æ–≤–æ' },
    ];

    const zoneColors = { warehouse: '#3b82f6', client: '#10b981', fuel: '#f59e0b', restricted: '#ef4444', rest: '#8b5cf6', customs: '#ec4899', platon: '#14b8a6' };
    const zoneIcons = { warehouse: 'fa-warehouse', client: 'fa-building', fuel: 'fa-gas-pump', restricted: 'fa-ban', rest: 'fa-bed', customs: 'fa-passport', platon: 'fa-road' };
    const zoneTypeLabels = { warehouse: '–°–∫–ª–∞–¥', client: '–ö–ª–∏–µ–Ω—Ç', fuel: '–ê–ó–°', restricted: '–ó–∞–ø—Ä–µ—Ç', rest: '–û—Ç–¥—ã—Ö', customs: '–¢–∞–º–æ–∂–Ω—è', platon: '–ü–ª–∞—Ç–æ–Ω' };

    // Add zones to map
    zones.forEach(zone => {
      L.circle([zone.lat, zone.lng], { 
        radius: zone.radius, 
        color: zoneColors[zone.type], 
        fillColor: zoneColors[zone.type], 
        fillOpacity: 0.2, 
        weight: 2 
      }).addTo(map);
      
      L.marker([zone.lat, zone.lng], { 
        icon: L.divIcon({ 
          className: 'custom-marker', 
          html: `<div style="width:32px;height:32px;background:${zoneColors[zone.type]};border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;border:2px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.3);"><i class="fa-solid ${zoneIcons[zone.type]}" style="font-size:14px;"></i></div>`, 
          iconSize: [32, 32], 
          iconAnchor: [16, 16] 
        }) 
      }).addTo(map).bindPopup(`<b>${zone.name}</b><br>–¢–∏–ø: ${zoneTypeLabels[zone.type]}<br>–¢–° –≤ –∑–æ–Ω–µ: ${zone.vehicles}`);
    });

    // Render zone list
    function renderZoneList() {
      const list = document.getElementById('zoneList');
      document.getElementById('zoneCount').textContent = `${zones.length} –∑–æ–Ω`;
      
      list.innerHTML = zones.map((zone, i) => `
        <div class="zone-item ${i === 0 ? 'active' : ''} p-3 flex items-center gap-3" data-id="${zone.id}">
          <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: ${zoneColors[zone.type]}20;">
            <i class="fa-solid ${zoneIcons[zone.type]}" style="color: ${zoneColors[zone.type]};"></i>
          </div>
          <div class="flex-1 min-w-0">
            <div class="font-medium text-sm truncate">${zone.name}</div>
            <div class="flex items-center gap-2 mt-1">
              <span class="zone-type zone-${zone.type}">${zoneTypeLabels[zone.type]}</span>
              ${zone.vehicles > 0 ? `<span class="text-xs text-emerald-500">${zone.vehicles} –¢–°</span>` : ''}
            </div>
          </div>
        </div>
      `).join('');

      list.querySelectorAll('.zone-item').forEach(item => {
        item.addEventListener('click', () => {
          list.querySelectorAll('.zone-item').forEach(i => i.classList.remove('active'));
          item.classList.add('active');
          const zone = zones.find(z => z.id === parseInt(item.dataset.id));
          if (zone) {
            map.setView([zone.lat, zone.lng], 12);
            updateZoneDetails(zone);
          }
        });
      });
    }

    function updateZoneDetails(zone) {
      document.getElementById('zoneName').textContent = zone.name;
      document.getElementById('zoneAddress').textContent = zone.address;
      document.getElementById('zoneRadius').textContent = zone.radius >= 1000 ? `${zone.radius/1000} –∫–º` : `${zone.radius} –º`;
      document.getElementById('zoneTypeBadge').className = `zone-type zone-${zone.type}`;
      document.getElementById('zoneTypeBadge').textContent = zoneTypeLabels[zone.type];
      document.getElementById('zoneIcon').className = `fa-solid ${zoneIcons[zone.type]} text-3xl`;
      document.getElementById('zoneIcon').style.color = zoneColors[zone.type];
      document.getElementById('zoneVehicleCount').textContent = zone.vehicles;
    }

    document.querySelectorAll('.draw-tool').forEach(tool => {
      tool.addEventListener('click', () => {
        document.querySelectorAll('.draw-tool').forEach(t => t.classList.remove('active'));
        tool.classList.add('active');
        const toolType = tool.dataset.tool;
        startDrawing(toolType);
      });
    });

    // Drawing functionality
    let drawnItems = new L.FeatureGroup();
    map.addLayer(drawnItems);
    let currentDrawHandler = null;

    function startDrawing(type) {
      // Cancel any existing drawing
      if (currentDrawHandler) {
        currentDrawHandler.disable();
      }

      const drawOptions = {
        color: '#3b82f6',
        fillColor: '#3b82f6',
        fillOpacity: 0.2,
        weight: 2
      };

      switch(type) {
        case 'circle':
          currentDrawHandler = new L.Draw.Circle(map, { shapeOptions: drawOptions });
          break;
        case 'polygon':
          currentDrawHandler = new L.Draw.Polygon(map, { shapeOptions: drawOptions, allowIntersection: false });
          break;
        case 'rectangle':
          currentDrawHandler = new L.Draw.Rectangle(map, { shapeOptions: drawOptions });
          break;
        case 'route':
          currentDrawHandler = new L.Draw.Polyline(map, { shapeOptions: { ...drawOptions, weight: 6, opacity: 0.6 } });
          break;
      }

      if (currentDrawHandler) {
        currentDrawHandler.enable();
      }
    }

    // Handle created shapes
    map.on(L.Draw.Event.CREATED, function (event) {
      const layer = event.layer;
      drawnItems.addLayer(layer);
      
      // Get coordinates
      let coords;
      if (event.layerType === 'circle') {
        coords = layer.getLatLng();
        const radius = layer.getRadius();
        showCreateZoneModalWithData(coords.lat, coords.lng, Math.round(radius));
      } else if (event.layerType === 'polygon' || event.layerType === 'rectangle') {
        coords = layer.getBounds().getCenter();
        showCreateZoneModalWithData(coords.lat, coords.lng, 500);
      } else if (event.layerType === 'polyline') {
        coords = layer.getLatLngs()[0];
        showCreateZoneModalWithData(coords.lat, coords.lng, 1000);
      }
      
      // Reset tool buttons
      document.querySelectorAll('.draw-tool').forEach(t => t.classList.remove('active'));
      currentDrawHandler = null;
    });

    function showCreateZoneModalWithData(lat, lng, radius) {
      showCreateZoneModal();
      // Fill in coordinates
      const form = document.getElementById('createZoneModal').querySelector('form');
      const inputs = form.querySelectorAll('input[type="number"]');
      if (inputs[0]) inputs[0].value = lat.toFixed(6);
      if (inputs[1]) inputs[1].value = lng.toFixed(6);
      
      // Set radius
      const slider = document.getElementById('radiusSlider');
      if (slider && radius >= 100 && radius <= 5000) {
        slider.value = radius;
        document.getElementById('radiusValue').textContent = radius >= 1000 ? `${radius/1000}–∫–º` : `${radius}–º`;
      }
    }

    const radiusSlider = document.getElementById('radiusSlider');
    const radiusValue = document.getElementById('radiusValue');
    if (radiusSlider) {
      radiusSlider.addEventListener('input', () => {
        const val = radiusSlider.value;
        radiusValue.textContent = val >= 1000 ? `${val/1000}–∫–º` : `${val}–º`;
      });
    }

    function showCreateZoneModal() {
      document.getElementById('createZoneModal').classList.remove('hidden');
      document.getElementById('createZoneModal').classList.add('flex');
    }

    function closeCreateZoneModal() {
      document.getElementById('createZoneModal').classList.add('hidden');
      document.getElementById('createZoneModal').classList.remove('flex');
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeCreateZoneModal();
    });

    renderZoneList();
    updateZoneDetails(zones[0]);

  </script>
  <script src="./assets/js/routa-core.js"></script>
  <script src="./assets/js/routox-unified.js"></script>
  <script src="./assets/js/routox-ai.js"></script>
  <script>
    // Global theme toggle
    // ========== ROUTA PLATFORM INITIALIZATION ==========
    (async function() {
      Routa.Theme.load();
      const user = await Routa.App.init({
        requireAuth: true,
        currentPage: 'geozones.html'
      });
      if (!user) return;
      console.log('Geozones page initialized for:', user.role, user.edition);
    })();
    
    function logout() { Routa.Auth.logout(); }
    function toggleTheme() { Routa.Theme.toggle(); }
  </script>
  <script src="./assets/js/role-theme.js"></script>
  <script src="./assets/js/smooth-navigation.js"></script>
</body>
</html>
