<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoutoX — Топливо</title>
  <link rel="stylesheet" href="./assets/css/routox-unified.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script src="https://kit.fontawesome.com/a2e0e9e5a9.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .kpi-value {
      background: linear-gradient(135deg, #3b82f6, #10b981);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .progress-ring { transform: rotate(-90deg); }
    .progress-ring-circle { transition: stroke-dashoffset 0.5s ease; }
    .trans-row { transition: all 0.2s ease; border-radius: 8px; }
    .trans-row:hover { background: rgba(59, 130, 246, 0.08); }
    .role-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .role-badge.admin { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
    .role-badge.owner { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; border: 1px solid rgba(139, 92, 246, 0.3); }
    .role-badge.dispatcher { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
    .fuel-tab { flex: 1; padding: 12px 16px; border-radius: 12px; font-size: 14px; font-weight: 500; transition: all 0.2s ease; color: var(--text-secondary); background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .fuel-tab:hover { color: var(--text-primary); background: rgba(59, 130, 246, 0.08); }
    .fuel-tab.active { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
    .fuel-card { background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 1.5rem; transition: all 0.3s ease; }
    .fuel-card:hover { transform: translateY(-4px); border-color: rgba(59, 130, 246, 0.3); }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="h-16 glass-panel flex items-center justify-between px-6 z-40 shrink-0 border-b border-white/50 sticky top-0 mx-4 mt-4 rounded-2xl">
    <div class="flex items-center gap-12">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-extrabold text-xl shadow-lg shadow-blue-500/20">
                R
            </div>
            <div class="flex flex-col">
                <span class="font-bold text-lg leading-none tracking-tight text-slate-800">RoutoX</span>
                <span class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mt-0.5">Fleet OS</span>
            </div>
        </div>
        <nav class="hidden lg:flex items-center gap-1 bg-slate-100/50 p-1 rounded-xl">
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="fleet.html">Флот</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="trips.html">Рейсы</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="geozones.html">Геозоны</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-semibold nav-item-active transition-all" href="fuel.html">Топливо</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="maintenance.html">ТО</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="documents.html">Документы</a>
        </nav>
    </div>
    <div class="flex items-center gap-5">
        <div class="px-3 py-1.5 bg-white/60 backdrop-blur-md border border-white/60 rounded-full flex items-center gap-2 shadow-sm">
            <span class="relative flex h-2.5 w-2.5">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
            </span>
            <span class="text-xs font-bold text-slate-700 tracking-tight">LIVE</span>
        </div>
        <div class="h-6 w-px bg-slate-200"></div>
        <div class="flex items-center gap-3 pl-1 pr-1 py-1 bg-white/50 border border-white rounded-full shadow-sm hover:shadow-md transition-shadow cursor-pointer">
            <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden ring-2 ring-white">
                <img alt="User" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCTs9iN8pKS03W5I54u9FB4B-c8kh0-SvddoYiVdknvnn0XFQ_ScxzcOGMuvCw75ZDO7eej3OBFSUyW7YGzfIdw8bm2JVE2qYntX-6WFsuWZDXeCjqgvXyR-Lo9UnAE2bTQejiaicaZNqXTEEWzBEmoalZytqScbtdaXlk0i5laN5yjsqI3j457keHzESRrW4bLeWD2l5xuer1uZ4Zd_LMeP8p-XTEa4_wtLTcRyHGOncDuMQUJk788z8tvDII7r8UTdnahdzzaAtY"/>
            </div>
            <div class="pr-3 flex flex-col items-end leading-none">
                <p class="text-xs font-bold text-slate-800" id="userName">Диспетчер</p>
                <p class="text-[9px] text-blue-600 font-semibold mt-0.5" id="userRole">Pro</p>
            </div>
        </div>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-700 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50 relative" title="Уведомления" onclick="window.location.href='notifications.html'">
            <span class="material-symbols-outlined text-[20px]">notifications</span>
            <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full ring-2 ring-white"></span>
        </button>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-red-500 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50" title="Выход" onclick="logout()">
            <span class="material-symbols-outlined text-[20px]">logout</span>
        </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="p-4 space-y-4">
    <!-- Tabs -->
    <div class="glass-panel p-2 flex items-center gap-2 mb-4">
      <button class="fuel-tab active" data-tab="consumption" onclick="switchFuelTab('consumption')">
        <i class="fa-solid fa-chart-line mr-2"></i>
        Расход топлива
      </button>
      <button class="fuel-tab" data-tab="cards" onclick="switchFuelTab('cards')">
        <i class="fa-solid fa-credit-card mr-2"></i>
        Топливные карты
      </button>
      <button class="fuel-tab" data-tab="anomalies" onclick="switchFuelTab('anomalies')">
        <i class="fa-solid fa-triangle-exclamation mr-2"></i>
        Аномалии
      </button>
    </div>

    <!-- Consumption Tab Content -->
    <div id="consumptionTab">
      <!-- Stats Row -->
      <div class="grid grid-cols-5 gap-4 mb-4">
      <div class="glass-panel stat-card p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center">
            <i class="fa-solid fa-fire-flame-curved text-amber-500 text-xl"></i>
          </div>
          <span class="text-xs px-2 py-1 rounded-lg bg-emerald-500/15 text-emerald-500">-5.2%</span>
        </div>
        <div class="text-2xl font-bold kpi-value">₽ 2.4M</div>
        <div class="text-sm text-muted">Расходы за месяц</div>
      </div>

      <div class="glass-panel stat-card p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center">
            <i class="fa-solid fa-gas-pump text-blue-500 text-xl"></i>
          </div>
          <span class="text-xs px-2 py-1 rounded-lg bg-amber-500/15 text-amber-500">+2.1%</span>
        </div>
        <div class="text-2xl font-bold kpi-value">45,280 л</div>
        <div class="text-sm text-muted">Заправлено за месяц</div>
      </div>

      <div class="glass-panel stat-card p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500/20 to-green-500/20 flex items-center justify-center">
            <i class="fa-solid fa-gauge-high text-emerald-500 text-xl"></i>
          </div>
          <span class="text-xs px-2 py-1 rounded-lg bg-emerald-500/15 text-emerald-500">Норма</span>
        </div>
        <div class="text-2xl font-bold kpi-value">32.4 л/100км</div>
        <div class="text-sm text-muted">Средний расход</div>
      </div>

      <div class="glass-panel stat-card p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center">
            <i class="fa-solid fa-ruble-sign text-purple-500 text-xl"></i>
          </div>
          <span class="text-xs px-2 py-1 rounded-lg bg-red-500/15 text-red-500">+1.8%</span>
        </div>
        <div class="text-2xl font-bold kpi-value">₽ 58.90</div>
        <div class="text-sm text-muted">Средняя цена ДТ</div>
      </div>

      <div class="glass-panel stat-card p-5">
        <div class="flex items-center justify-between mb-3">
          <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-slate-500/20 to-slate-600/20 flex items-center justify-center">
            <i class="fa-solid fa-credit-card text-slate-500 text-xl"></i>
          </div>
        </div>
        <div class="text-2xl font-bold kpi-value">64</div>
        <div class="text-sm text-muted">Топливных карт</div>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-12 gap-4">
      <!-- Charts Section -->
      <section class="col-span-8 space-y-4">
        <!-- Fuel Consumption Chart -->
        <div class="glass-panel p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="font-semibold">Расход топлива</h3>
              <p class="text-sm text-muted">Динамика за последние 30 дней</p>
            </div>
            <div class="flex items-center gap-2">
              <button class="px-3 py-1.5 rounded-lg bg-blue-500/20 text-blue-500 text-sm font-medium">Дни</button>
              <button class="px-3 py-1.5 rounded-lg text-muted text-sm hover:bg-slate-100">Недели</button>
              <button class="px-3 py-1.5 rounded-lg text-muted text-sm hover:bg-slate-100">Месяцы</button>
            </div>
          </div>
          <canvas id="fuelChart" height="100"></canvas>
        </div>

        <!-- Cost Breakdown -->
        <div class="grid grid-cols-2 gap-4">
          <div class="glass-panel p-5">
            <h3 class="font-semibold mb-4">Расход по типам ТС</h3>
            <canvas id="vehicleTypeChart" height="150"></canvas>
          </div>

          <div class="glass-panel p-5">
            <h3 class="font-semibold mb-4">Топ маршруты по затратам</h3>
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <span class="text-sm text-muted w-24">Москва-СПб</span>
                <div class="flex-1 h-6 rounded-lg bg-slate-100 overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-blue-500 to-blue-400" style="width: 85%"></div>
                </div>
                <span class="text-sm font-semibold w-20 text-right">₽ 420K</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-sm text-muted w-24">Екб-Москва</span>
                <div class="flex-1 h-6 rounded-lg bg-slate-100 overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-emerald-500 to-emerald-400" style="width: 72%"></div>
                </div>
                <span class="text-sm font-semibold w-20 text-right">₽ 356K</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-sm text-muted w-24">Казань-Москва</span>
                <div class="flex-1 h-6 rounded-lg bg-slate-100 overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-purple-500 to-purple-400" style="width: 58%"></div>
                </div>
                <span class="text-sm font-semibold w-20 text-right">₽ 287K</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-sm text-muted w-24">Сочи-Москва</span>
                <div class="flex-1 h-6 rounded-lg bg-slate-100 overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-amber-500 to-amber-400" style="width: 45%"></div>
                </div>
                <span class="text-sm font-semibold w-20 text-right">₽ 223K</span>
              </div>
              <div class="flex items-center gap-3">
                <span class="text-sm text-muted w-24">Н.Новгород</span>
                <div class="flex-1 h-6 rounded-lg bg-slate-100 overflow-hidden">
                  <div class="h-full bg-gradient-to-r from-cyan-500 to-cyan-400" style="width: 32%"></div>
                </div>
                <span class="text-sm font-semibold w-20 text-right">₽ 158K</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Transactions -->
        <div class="glass-panel p-5">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold">Последние заправки</h3>
            <button class="text-sm text-blue-500 hover:underline">Все транзакции →</button>
          </div>
          
          <div class="overflow-hidden rounded-xl border" style="border-color: var(--border-color);">
            <table class="w-full">
              <thead>
                <tr style="background: var(--bg-card);">
                  <th class="text-left p-3 text-xs font-medium text-muted">Дата/Время</th>
                  <th class="text-left p-3 text-xs font-medium text-muted">ТС</th>
                  <th class="text-left p-3 text-xs font-medium text-muted">Водитель</th>
                  <th class="text-left p-3 text-xs font-medium text-muted">АЗС</th>
                  <th class="text-right p-3 text-xs font-medium text-muted">Литры</th>
                  <th class="text-right p-3 text-xs font-medium text-muted">Сумма</th>
                </tr>
              </thead>
              <tbody id="transactionsTable"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Right Panel -->
      <aside class="col-span-4 space-y-4">
        <!-- Fleet Fuel Status -->
        <div class="glass-panel p-5">
          <h3 class="font-semibold mb-4">Уровень топлива флота</h3>
          <div class="flex justify-center mb-6">
            <svg viewBox="0 0 200 200" width="160" height="160">
              <defs>
                <linearGradient id="fuelGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                  <stop offset="0%" stop-color="#f59e0b"/>
                  <stop offset="50%" stop-color="#10b981"/>
                  <stop offset="100%" stop-color="#3b82f6"/>
                </linearGradient>
              </defs>
              <circle cx="100" cy="100" r="90" fill="none" stroke="currentColor" stroke-width="20" style="color: var(--border-color);"/>
              <circle class="progress-ring-circle" cx="100" cy="100" r="90" fill="none" stroke="url(#fuelGradient)" stroke-width="20" stroke-linecap="round" stroke-dasharray="565.48" stroke-dashoffset="169.64" transform="rotate(-90 100 100)"/>
              <text x="100" y="95" text-anchor="middle" fill="currentColor" font-size="32" font-weight="bold">70%</text>
              <text x="100" y="120" text-anchor="middle" fill="currentColor" font-size="12" class="text-muted">Средний уровень</text>
            </svg>
          </div>
          <div class="grid grid-cols-3 gap-3 text-center">
            <div class="glass-card p-3">
              <div class="text-lg font-bold text-emerald-500">42</div>
              <div class="text-xs text-muted">Полный</div>
            </div>
            <div class="glass-card p-3">
              <div class="text-lg font-bold text-amber-500">18</div>
              <div class="text-xs text-muted">Средний</div>
            </div>
            <div class="glass-card p-3">
              <div class="text-lg font-bold text-red-500">4</div>
              <div class="text-xs text-muted">Низкий</div>
            </div>
          </div>
        </div>

        <!-- Alerts -->
        <div class="glass-panel p-5">
          <h3 class="font-semibold mb-4">Уведомления</h3>
          <div class="space-y-3 custom-scroll max-h-64 overflow-y-auto">
            <div class="flex items-start gap-3 p-3 rounded-xl bg-red-500/10 border border-red-500/20">
              <div class="w-8 h-8 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-triangle-exclamation text-red-500 text-sm"></i>
              </div>
              <div>
                <div class="text-sm font-medium">Критический уровень</div>
                <div class="text-xs text-muted">TR-045 • MAN TGX • 8%</div>
                <div class="text-xs text-red-500 mt-1">Требуется срочная заправка</div>
              </div>
            </div>
            <div class="flex items-start gap-3 p-3 rounded-xl bg-amber-500/10 border border-amber-500/20">
              <div class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-gas-pump text-amber-500 text-sm"></i>
              </div>
              <div>
                <div class="text-sm font-medium">Низкий уровень</div>
                <div class="text-xs text-muted">TR-023 • SCANIA • 22%</div>
                <div class="text-xs text-amber-500 mt-1">Рекомендуется заправка</div>
              </div>
            </div>
            <div class="flex items-start gap-3 p-3 rounded-xl bg-blue-500/10 border border-blue-500/20">
              <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                <i class="fa-solid fa-chart-line text-blue-500 text-sm"></i>
              </div>
              <div>
                <div class="text-sm font-medium">Повышенный расход</div>
                <div class="text-xs text-muted">TR-012 • VOLVO FH</div>
                <div class="text-xs text-blue-500 mt-1">+18% от нормы</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Fuel Cards -->
        <div class="glass-panel p-5">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-semibold">Топливные карты</h3>
            <button class="text-sm text-blue-500 hover:underline">Управление</button>
          </div>
          <div class="space-y-3">
            <div class="glass-card p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-5 rounded bg-gradient-to-r from-red-500 to-red-600"></div>
                  <span class="text-sm font-medium">Лукойл</span>
                </div>
                <span class="text-xs text-muted">**** 7842</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-muted">Баланс</span>
                <span class="text-sm font-semibold">₽ 145,320</span>
              </div>
            </div>
            <div class="glass-card p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-5 rounded bg-gradient-to-r from-green-500 to-green-600"></div>
                  <span class="text-sm font-medium">ГПН</span>
                </div>
                <span class="text-xs text-muted">**** 3156</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-muted">Баланс</span>
                <span class="text-sm font-semibold">₽ 89,750</span>
              </div>
            </div>
            <div class="glass-card p-4">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-5 rounded bg-gradient-to-r from-blue-500 to-blue-600"></div>
                  <span class="text-sm font-medium">Роснефть</span>
                </div>
                <span class="text-xs text-muted">**** 9023</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-muted">Баланс</span>
                <span class="text-sm font-semibold">₽ 234,100</span>
              </div>
            </div>
          </div>
        </div>
      </aside>
    </div>
    </div><!-- End consumptionTab -->

    <!-- Fuel Cards Tab -->
    <div id="cardsTab" style="display: none;">
      <div class="grid grid-cols-3 gap-6">
        <!-- Cards Grid -->
        <div class="col-span-2 space-y-4">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold">Топливные карты</h2>
            <button class="btn-primary" onclick="showAddCardModal()">
              <i class="fa-solid fa-plus mr-2"></i>
              Добавить карту
            </button>
          </div>
          
          <div class="grid grid-cols-2 gap-4" id="fuelCardsGrid">
            <!-- Card 1 - Лукойл -->
            <div class="fuel-card">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-10 rounded-lg bg-gradient-to-r from-red-500 to-red-600 flex items-center justify-center">
                  <span class="text-white font-bold text-sm">ЛУКОЙЛ</span>
                </div>
                <span class="px-2 py-1 rounded-lg bg-emerald-500/15 text-emerald-500 text-xs font-medium">Активна</span>
              </div>
              <div class="text-lg font-mono tracking-wider mb-1">**** **** **** 4521</div>
              <div class="text-sm text-muted mb-4">Volvo FH16 #1 • Иванов А.</div>
              <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                <div>
                  <div class="text-xs text-muted">Баланс</div>
                  <div class="text-xl font-bold text-emerald-500">₽ 145,320</div>
                </div>
                <div class="text-right">
                  <div class="text-xs text-muted">Лимит/мес</div>
                  <div class="text-lg font-semibold">₽ 200,000</div>
                </div>
              </div>
              <div class="flex gap-2 mt-4">
                <button class="flex-1 btn-secondary text-sm py-2">История</button>
                <button class="flex-1 btn-secondary text-sm py-2">Лимиты</button>
              </div>
            </div>

            <!-- Card 2 - ГПН -->
            <div class="fuel-card">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-10 rounded-lg bg-gradient-to-r from-green-500 to-green-600 flex items-center justify-center">
                  <span class="text-white font-bold text-sm">ГПН</span>
                </div>
                <span class="px-2 py-1 rounded-lg bg-emerald-500/15 text-emerald-500 text-xs font-medium">Активна</span>
              </div>
              <div class="text-lg font-mono tracking-wider mb-1">**** **** **** 3156</div>
              <div class="text-sm text-muted mb-4">MAN TGX #2 • Петров С.</div>
              <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                <div>
                  <div class="text-xs text-muted">Баланс</div>
                  <div class="text-xl font-bold text-emerald-500">₽ 89,750</div>
                </div>
                <div class="text-right">
                  <div class="text-xs text-muted">Лимит/мес</div>
                  <div class="text-lg font-semibold">₽ 150,000</div>
                </div>
              </div>
              <div class="flex gap-2 mt-4">
                <button class="flex-1 btn-secondary text-sm py-2">История</button>
                <button class="flex-1 btn-secondary text-sm py-2">Лимиты</button>
              </div>
            </div>

            <!-- Card 3 - Роснефть -->
            <div class="fuel-card">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center">
                  <span class="text-white font-bold text-xs">РОСНЕФТЬ</span>
                </div>
                <span class="px-2 py-1 rounded-lg bg-emerald-500/15 text-emerald-500 text-xs font-medium">Активна</span>
              </div>
              <div class="text-lg font-mono tracking-wider mb-1">**** **** **** 9023</div>
              <div class="text-sm text-muted mb-4">Scania R500 #3 • Сидоров М.</div>
              <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                <div>
                  <div class="text-xs text-muted">Баланс</div>
                  <div class="text-xl font-bold text-emerald-500">₽ 234,100</div>
                </div>
                <div class="text-right">
                  <div class="text-xs text-muted">Лимит/мес</div>
                  <div class="text-lg font-semibold">₽ 250,000</div>
                </div>
              </div>
              <div class="flex gap-2 mt-4">
                <button class="flex-1 btn-secondary text-sm py-2">История</button>
                <button class="flex-1 btn-secondary text-sm py-2">Лимиты</button>
              </div>
            </div>

            <!-- Card 4 - Blocked -->
            <div class="fuel-card opacity-60">
              <div class="flex items-start justify-between mb-4">
                <div class="w-14 h-10 rounded-lg bg-gradient-to-r from-amber-500 to-amber-600 flex items-center justify-center">
                  <span class="text-white font-bold text-sm">Е100</span>
                </div>
                <span class="px-2 py-1 rounded-lg bg-red-500/15 text-red-500 text-xs font-medium">Заблокирована</span>
              </div>
              <div class="text-lg font-mono tracking-wider mb-1">**** **** **** 7788</div>
              <div class="text-sm text-muted mb-4">Mercedes Actros #4</div>
              <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                <div>
                  <div class="text-xs text-muted">Баланс</div>
                  <div class="text-xl font-bold">₽ 0</div>
                </div>
                <div class="text-right">
                  <div class="text-xs text-muted">Причина</div>
                  <div class="text-sm text-red-500">Утеряна</div>
                </div>
              </div>
              <div class="flex gap-2 mt-4">
                <button class="flex-1 btn-primary text-sm py-2">Разблокировать</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Cards Summary -->
        <div class="space-y-4">
          <div class="glass-panel p-5">
            <h3 class="font-semibold mb-4">Сводка по картам</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between">
                <span class="text-muted">Всего карт</span>
                <span class="text-2xl font-bold">64</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Активных</span>
                <span class="text-xl font-semibold text-emerald-500">58</span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-muted">Заблокировано</span>
                <span class="text-xl font-semibold text-red-500">6</span>
              </div>
              <hr class="border-white/10">
              <div class="flex items-center justify-between">
                <span class="text-muted">Общий баланс</span>
                <span class="text-xl font-bold text-emerald-500">₽ 2.8M</span>
              </div>
            </div>
          </div>

          <div class="glass-panel p-5">
            <h3 class="font-semibold mb-4">Последние операции</h3>
            <div class="space-y-3">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-emerald-500/15 flex items-center justify-center">
                  <i class="fa-solid fa-gas-pump text-emerald-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm font-medium">Заправка 420л</div>
                  <div class="text-xs text-muted">TR-001 • Лукойл</div>
                </div>
                <span class="text-sm font-semibold">-₽24.7K</span>
              </div>
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-blue-500/15 flex items-center justify-center">
                  <i class="fa-solid fa-plus text-blue-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm font-medium">Пополнение</div>
                  <div class="text-xs text-muted">Карта *4521</div>
                </div>
                <span class="text-sm font-semibold text-emerald-500">+₽100K</span>
              </div>
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-xl bg-emerald-500/15 flex items-center justify-center">
                  <i class="fa-solid fa-gas-pump text-emerald-500"></i>
                </div>
                <div class="flex-1">
                  <div class="text-sm font-medium">Заправка 380л</div>
                  <div class="text-xs text-muted">TR-023 • ГПН</div>
                </div>
                <span class="text-sm font-semibold">-₽22.4K</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Anomalies Tab -->
    <div id="anomaliesTab" style="display: none;">
      <div class="glass-panel p-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-bold flex items-center gap-3">
            <i class="fa-solid fa-triangle-exclamation text-amber-500"></i>
            Аномалии расхода топлива
          </h2>
          <span class="px-3 py-1 rounded-full bg-amber-500/15 text-amber-500 text-sm font-medium">3 за неделю</span>
        </div>
        <div class="space-y-4">
          <div class="p-4 rounded-xl bg-red-500/10 border border-red-500/20 flex items-center gap-4">
            <div class="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center">
              <i class="fa-solid fa-droplet-slash text-red-500 text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="font-semibold">Подозрение на слив топлива</div>
              <div class="text-sm text-muted">TR-012 • Вчера в 23:45 • -85 литров за 5 минут</div>
            </div>
            <button class="btn-secondary">Расследовать</button>
          </div>
          <div class="p-4 rounded-xl bg-amber-500/10 border border-amber-500/20 flex items-center gap-4">
            <div class="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center">
              <i class="fa-solid fa-gauge-high text-amber-500 text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="font-semibold">Повышенный расход</div>
              <div class="text-sm text-muted">TR-007 • 15.01 • Расход 45л/100км (норма 32л)</div>
            </div>
            <button class="btn-secondary">Анализ</button>
          </div>
          <div class="p-4 rounded-xl bg-amber-500/10 border border-amber-500/20 flex items-center gap-4">
            <div class="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center">
              <i class="fa-solid fa-location-crosshairs text-amber-500 text-xl"></i>
            </div>
            <div class="flex-1">
              <div class="font-semibold">Заправка вне маршрута</div>
              <div class="text-sm text-muted">TR-034 • 14.01 • АЗС в 15км от маршрута</div>
            </div>
            <button class="btn-secondary">Подробнее</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Theme management
    const savedTheme = localStorage.getItem('routoxTheme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('routoxTheme', next);
      updateChartColors();
    }

    function getChartColors() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      return {
        gridColor: isDark ? 'rgba(71, 85, 105, 0.2)' : 'rgba(226, 232, 240, 0.8)',
        textColor: isDark ? '#94a3b8' : '#64748b'
      };
    }

    function updateChartColors() {
      const colors = getChartColors();
      [fuelChart, vehicleChart].forEach(chart => {
        if (chart.options.scales?.x) {
          chart.options.scales.x.grid.color = colors.gridColor;
          chart.options.scales.x.ticks.color = colors.textColor;
        }
        if (chart.options.scales?.y) {
          chart.options.scales.y.grid.color = colors.gridColor;
          chart.options.scales.y.ticks.color = colors.textColor;
        }
        if (chart.options.plugins?.legend?.labels) {
          chart.options.plugins.legend.labels.color = colors.textColor;
        }
        chart.update();
      });
    }

    const colors = getChartColors();

    // Fuel consumption chart
    const fuelCtx = document.getElementById('fuelChart').getContext('2d');
    const fuelChart = new Chart(fuelCtx, {
      type: 'line',
      data: {
        labels: Array.from({length: 30}, (_, i) => i + 1),
        datasets: [{
          label: 'Расход (л)',
          data: [1520, 1680, 1450, 1890, 1650, 1720, 1580, 1490, 1750, 1820, 1680, 1550, 1920, 1780, 1650, 1480, 1590, 1720, 1850, 1680, 1540, 1890, 1750, 1620, 1480, 1780, 1920, 1650, 1580, 1720],
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          pointHoverRadius: 6
        }, {
          label: 'Затраты (тыс. ₽)',
          data: [89, 99, 85, 111, 97, 101, 93, 88, 103, 107, 99, 91, 113, 105, 97, 87, 94, 101, 109, 99, 91, 111, 103, 95, 87, 105, 113, 97, 93, 101],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          fill: true,
          tension: 0.4,
          pointRadius: 0,
          pointHoverRadius: 6,
          yAxisID: 'y1'
        }]
      },
      options: {
        responsive: true,
        interaction: { intersect: false, mode: 'index' },
        plugins: { legend: { display: true, position: 'top', labels: { color: colors.textColor, usePointStyle: true } } },
        scales: {
          x: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor } },
          y: { grid: { color: colors.gridColor }, ticks: { color: colors.textColor } },
          y1: { position: 'right', grid: { display: false }, ticks: { color: '#10b981' } }
        }
      }
    });

    // Vehicle type chart
    const vehicleCtx = document.getElementById('vehicleTypeChart').getContext('2d');
    const vehicleChart = new Chart(vehicleCtx, {
      type: 'doughnut',
      data: {
        labels: ['Тягачи', 'Фургоны', 'Рефрижераторы', 'Самосвалы'],
        datasets: [{ data: [45, 25, 20, 10], backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'], borderWidth: 0, hoverOffset: 10 }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'right', labels: { color: colors.textColor, usePointStyle: true, padding: 15 } } },
        cutout: '65%'
      }
    });

    // Transactions data
    const transactions = [
      { date: '15.01 14:32', vehicle: 'TR-001 • MAN TGX', driver: 'Иванов П.', station: 'Лукойл, М4', liters: 420, amount: 24738 },
      { date: '15.01 11:15', vehicle: 'TR-023 • SCANIA R', driver: 'Петров А.', station: 'ГПН, Казань', liters: 380, amount: 22382 },
      { date: '15.01 09:45', vehicle: 'TR-007 • VOLVO FH', driver: 'Сидоров В.', station: 'Роснефть, М7', liters: 450, amount: 26505 },
      { date: '14.01 18:20', vehicle: 'TR-012 • FREIGHTLINER', driver: 'Козлов Д.', station: 'Лукойл, СПб', liters: 395, amount: 23266 },
      { date: '14.01 15:50', vehicle: 'TR-034 • MAN TGS', driver: 'Новиков К.', station: 'ГПН, Н.Новгород', liters: 410, amount: 24149 },
    ];

    const tbody = document.getElementById('transactionsTable');
    tbody.innerHTML = transactions.map(t => `
      <tr class="trans-row" style="border-bottom: 1px solid var(--border-color);">
        <td class="p-3 text-sm">${t.date}</td>
        <td class="p-3 text-sm">${t.vehicle}</td>
        <td class="p-3 text-sm text-muted">${t.driver}</td>
        <td class="p-3 text-sm text-muted">${t.station}</td>
        <td class="p-3 text-sm text-right font-medium">${t.liters} л</td>
        <td class="p-3 text-sm text-right font-semibold text-emerald-500">₽ ${t.amount.toLocaleString()}</td>
      </tr>
    `).join('');

    // Tab switching
    function switchFuelTab(tab) {
      document.querySelectorAll('.fuel-tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
      
      document.getElementById('consumptionTab').style.display = tab === 'consumption' ? 'block' : 'none';
      document.getElementById('cardsTab').style.display = tab === 'cards' ? 'block' : 'none';
      document.getElementById('anomaliesTab').style.display = tab === 'anomalies' ? 'block' : 'none';
    }

    function showAddCardModal() {
      alert('Форма добавления топливной карты');
    }

  </script>
  <script src="./assets/js/routa-core.js"></script>
  <script src="./assets/js/routox-unified.js"></script>
  <script src="./assets/js/routox-ai.js"></script>
  <script>
    // ========== ROUTA PLATFORM INITIALIZATION ==========
    (async function() {
      Routa.Theme.load();
      const user = await Routa.App.init({
        requireAuth: true,
        currentPage: 'fuel.html'
      });
      if (!user) return;
      console.log('Fuel page initialized for:', user.role, user.edition);
    })();
    
    function logout() { Routa.Auth.logout(); }
    function toggleTheme() { Routa.Theme.toggle(); }
  </script>
</body>
</html>
