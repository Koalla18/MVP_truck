<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>RoutoX — Флот</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="./assets/css/page-transitions.css">
<script>
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#007AFF", 
                    "secondary": "#34C759",
                    "bg-page": "#F2F6FA",
                    "surface": "#ffffff",
                    "text-main": "#1D1D1F",
                    "text-muted": "#86868B",
                    "glass-border": "rgba(255, 255, 255, 0.4)",
                },
                fontFamily: {
                    "sans": ["Inter", "sans-serif"],
                },
                boxShadow: {
                    'soft': '0 8px 30px rgba(0,0,0,0.04)',
                    'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    'card': '0 2px 10px rgba(0,0,0,0.03), 0 10px 30px rgba(0,0,0,0.04)',
                    'glow': '0 0 15px rgba(0, 122, 255, 0.3)',
                    'aurora': '0 0 20px rgba(52, 199, 89, 0.4), 0 0 40px rgba(0, 122, 255, 0.2)',
                },
                backdropBlur: {
                    'xs': '2px',
                }
            },
        },
    }
</script>
<style>
    body {
        font-family: "Inter", sans-serif;
        background-color: #F5F5F7;
        background-image: 
            radial-gradient(at 0% 0%, hsla(210,100%,96%,1) 0, transparent 50%), 
            radial-gradient(at 100% 0%, hsla(220,100%,96%,1) 0, transparent 50%), 
            radial-gradient(at 100% 100%, hsla(200,100%,96%,1) 0, transparent 50%);
    }
    .glass-panel {
        background: rgba(255, 255, 255, 0.65);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
    }
    .glass-card {
        background: rgba(255, 255, 255, 0.75);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .glass-card:hover {
        background: rgba(255, 255, 255, 0.85);
        box-shadow: 0 10px 30px rgba(0,0,0,0.06);
    }
    .nav-item-active {
        background: rgba(255, 255, 255, 0.9);
        color: #007AFF;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .map-container {
        position: relative;
        overflow: hidden;
    }
    .map-container::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(to bottom, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 20%);
        pointer-events: none;
    }
    .progress-gradient-blue { background: linear-gradient(90deg, #5AC8FA 0%, #007AFF 100%); }
    .progress-gradient-green { background: linear-gradient(90deg, #34C759 0%, #30B0C7 100%); }
    .progress-gradient-teal { background: linear-gradient(90deg, #30B0C7 0%, #5856D6 100%); }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }
    .truck-glow {
        filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.4));
    }
    .btn-gradient {
        background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
        color: white;
        transition: all 0.3s ease;
    }
    .btn-gradient:hover {
        background: linear-gradient(135deg, #0056b3 0%, #4240a8 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0, 122, 255, 0.4);
    }
</style>
</head>
<body class="h-screen w-full flex flex-col overflow-hidden text-text-main selection:bg-blue-100">

<!-- Header -->
<header class="h-16 glass-panel flex items-center justify-between px-6 z-40 shrink-0 border-b border-white/50 sticky top-0">
    <div class="flex items-center gap-12">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-extrabold text-xl shadow-lg shadow-blue-500/20">
                R
            </div>
            <div class="flex flex-col">
                <span class="font-bold text-lg leading-none tracking-tight text-slate-800">RoutoX</span>
                <span class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mt-0.5">Fleet OS</span>
            </div>
        </div>
        <nav class="hidden lg:flex items-center gap-1 bg-slate-100/50 p-1 rounded-xl">
            <a class="px-4 py-1.5 rounded-lg text-sm font-semibold nav-item-active transition-all" href="fleet.html">Флот</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="trips.html">Рейсы</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="geozones.html">Геозоны</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="fuel.html">Топливо</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="maintenance.html">ТО</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="documents.html">Документы</a>
        </nav>
    </div>
    <div class="flex items-center gap-5">
        <div class="px-3 py-1.5 bg-white/60 backdrop-blur-md border border-white/60 rounded-full flex items-center gap-2 shadow-sm">
            <span class="relative flex h-2.5 w-2.5">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
            </span>
            <span class="text-xs font-bold text-slate-700 tracking-tight">LIVE</span>
        </div>
        <div class="h-6 w-px bg-slate-200"></div>
        <div class="flex items-center gap-3 pl-1 pr-1 py-1 bg-white/50 border border-white rounded-full shadow-sm hover:shadow-md transition-shadow cursor-pointer" id="userMenuBtn">
            <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden ring-2 ring-white">
                <img alt="User" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCTs9iN8pKS03W5I54u9FB4B-c8kh0-SvddoYiVdknvnn0XFQ_ScxzcOGMuvCw75ZDO7eej3OBFSUyW7YGzfIdw8bm2JVE2qYntX-6WFsuWZDXeCjqgvXyR-Lo9UnAE2bTQejiaicaZNqXTEEWzBEmoalZytqScbtdaXlk0i5laN5yjsqI3j457keHzESRrW4bLeWD2l5xuer1uZ4Zd_LMeP8p-XTEa4_wtLTcRyHGOncDuMQUJk788z8tvDII7r8UTdnahdzzaAtY"/>
            </div>
            <div class="pr-3 flex flex-col items-end leading-none">
                <p class="text-xs font-bold text-slate-800" id="userName">Диспетчер</p>
                <p class="text-[9px] text-blue-600 font-semibold mt-0.5" id="userRole">Pro</p>
            </div>
        </div>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-700 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50 relative" title="Уведомления" onclick="window.location.href='notifications.html'">
            <span class="material-symbols-outlined text-[20px]">notifications</span>
            <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full ring-2 ring-white"></span>
        </button>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-red-500 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50" title="Выход" onclick="logout()">
            <span class="material-symbols-outlined text-[20px]">logout</span>
        </button>
    </div>
</header>

<main class="flex-1 flex overflow-hidden p-4 gap-4">
    <!-- Sidebar: Vehicle List -->
    <aside class="w-[280px] flex flex-col gap-4 shrink-0">
        <!-- Status Summary -->
        <div class="grid grid-cols-4 gap-1.5">
            <div class="glass-card rounded-xl p-2 flex flex-col items-center justify-center">
                <span class="text-base font-bold text-emerald-500">4</span>
                <span class="text-[9px] text-slate-400 font-semibold uppercase">On</span>
            </div>
            <div class="glass-card rounded-xl p-2 flex flex-col items-center justify-center">
                <span class="text-base font-bold text-slate-400">2</span>
                <span class="text-[9px] text-slate-400 font-semibold uppercase">Off</span>
            </div>
            <div class="glass-card rounded-xl p-2 flex flex-col items-center justify-center">
                <span class="text-base font-bold text-blue-500">1</span>
                <span class="text-[9px] text-slate-400 font-semibold uppercase">Fix</span>
            </div>
            <div class="glass-card rounded-xl p-2 flex flex-col items-center justify-center">
                <span class="text-base font-bold text-red-500">1</span>
                <span class="text-[9px] text-slate-400 font-semibold uppercase">SOS</span>
            </div>
        </div>
        
        <!-- Search and Filters -->
        <div class="space-y-3">
            <div class="relative group">
                <input id="vehicleSearch" class="w-full pl-10 pr-4 py-3 bg-white/70 backdrop-blur border border-white/60 rounded-2xl text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none shadow-sm text-slate-700 font-medium transition-all placeholder:text-slate-400" placeholder="Поиск транспорта..." type="text" oninput="filterVehicles()"/>
                <span class="material-symbols-outlined absolute left-3 top-3 text-slate-400 group-focus-within:text-blue-500 transition-colors">search</span>
            </div>
            <div class="flex gap-2 overflow-x-auto pb-1 scrollbar-hide" id="filterButtons">
                <button onclick="setFilter('all')" data-filter="all" class="filter-btn px-3 py-1.5 btn-gradient text-[11px] font-bold rounded-lg shadow-sm whitespace-nowrap tracking-wide">Все</button>
                <button onclick="setFilter('active')" data-filter="active" class="filter-btn px-3 py-1.5 bg-white/60 text-slate-500 hover:text-emerald-600 text-[11px] font-bold rounded-lg border border-white/60 shadow-sm whitespace-nowrap transition-colors">Активные</button>
                <button onclick="setFilter('rest')" data-filter="rest" class="filter-btn px-3 py-1.5 bg-white/60 text-slate-500 hover:text-amber-600 text-[11px] font-bold rounded-lg border border-white/60 shadow-sm whitespace-nowrap transition-colors">Отдыхают</button>
                <button onclick="setFilter('alert')" data-filter="alert" class="filter-btn px-3 py-1.5 bg-white/60 text-slate-500 hover:text-red-600 text-[11px] font-bold rounded-lg border border-white/60 shadow-sm whitespace-nowrap transition-colors">Тревога</button>
                <button onclick="setFilter('repair')" data-filter="repair" class="filter-btn px-3 py-1.5 bg-white/60 text-slate-500 hover:text-blue-600 text-[11px] font-bold rounded-lg border border-white/60 shadow-sm whitespace-nowrap transition-colors">Ремонт</button>
            </div>
        </div>
        
        <!-- Vehicle Cards -->
        <div id="vehicleList" class="flex-1 overflow-y-auto space-y-3 pr-1 -mr-2 pr-2">
            <!-- Vehicles will be rendered by JavaScript -->
        </div>
        
        <button onclick="openAddVehicleModal()" class="w-full btn-gradient py-3 rounded-xl text-sm font-semibold shadow-lg">
            + Новый транспорт
        </button>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col gap-4 overflow-y-auto">
        <!-- Top Row: Vehicle Details + Map -->
        <div class="grid grid-cols-12 gap-4 min-h-[360px]">
            <!-- Vehicle Details Card -->
            <div class="col-span-12 lg:col-span-5 flex flex-col gap-4">
                <div class="glass-card rounded-3xl p-6 h-full flex flex-col relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-blue-100/50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
                    
                    <div class="flex items-start justify-between mb-4 relative z-10">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <h1 class="text-2xl font-bold text-slate-800 tracking-tight">MAN TGX</h1>
                                <span class="px-2 py-0.5 rounded-full bg-slate-100 border border-slate-200 text-[10px] font-bold text-slate-500">18.500</span>
                            </div>
                            <p class="text-slate-500 text-xs font-medium font-mono bg-slate-100/50 inline-block px-2 py-0.5 rounded">A 123 BC 116</p>
                        </div>
                        <div class="flex items-center gap-3 bg-white/60 backdrop-blur pl-1 pr-3 py-1 rounded-full border border-white shadow-sm">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white flex items-center justify-center font-bold text-[10px] shadow-sm">AM</div>
                            <div>
                                <p class="text-xs font-bold text-slate-800">Артём М.</p>
                                <p class="text-[9px] text-emerald-600 font-semibold">В пути • 4ч 12м</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex-1 flex items-center justify-center relative my-2">
                        <img alt="MAN Truck" class="w-full h-32 object-contain drop-shadow-xl rounded-lg" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBXqywzXMrrnzMLMoDDznq5VX_UzBJyvp6MWv-iCgKNbuga520dpkbSHpNSJyhBROvc3ZN2_wnC8Zj5LP3FYIX00QwoNX8dswJ0JLEbSBoyTgshBoPhupgHAykEMbuanE5zCuR_UNGcWO4ANNymWrCvWamnOKMr1tF8qOH8AbbYTAAqKUXM-9PA8qUg4pCyVgkAwaD9zzcKAz6ROBwoYggOd28qHLT7108fUeA-ZjwMKIz0sorTF29IdhjmMC2BMdz7tyAn3vQWaoY" style="mask-image: linear-gradient(to bottom, black 80%, transparent 100%);"/>
                        <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-white/40 to-transparent"></div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 mb-4 relative z-10">
                        <div class="bg-white/50 backdrop-blur rounded-2xl p-3 text-center border border-white shadow-sm">
                            <p class="text-[10px] uppercase tracking-wider text-slate-400 font-bold mb-1">Скорость</p>
                            <div class="flex items-baseline justify-center gap-0.5">
                                <span class="text-xl font-bold text-slate-800">68</span>
                                <span class="text-[9px] text-slate-400">km/h</span>
                            </div>
                        </div>
                        <div class="bg-white/50 backdrop-blur rounded-2xl p-3 text-center border border-white shadow-sm">
                            <p class="text-[10px] uppercase tracking-wider text-slate-400 font-bold mb-1">Время</p>
                            <div class="flex items-baseline justify-center gap-0.5">
                                <span class="text-xl font-bold text-slate-800">4.5</span>
                                <span class="text-[9px] text-slate-400">ч</span>
                            </div>
                        </div>
                        <div class="bg-white/50 backdrop-blur rounded-2xl p-3 text-center border border-white shadow-sm">
                            <p class="text-[10px] uppercase tracking-wider text-slate-400 font-bold mb-1">Пробег</p>
                            <div class="flex items-baseline justify-center gap-0.5">
                                <span class="text-xl font-bold text-slate-800">312</span>
                                <span class="text-[9px] text-slate-400">км</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3 relative z-10">
                        <div>
                            <div class="flex justify-between mb-1.5 items-end">
                                <span class="text-[11px] font-semibold text-slate-500">Топливо</span>
                                <span class="text-[11px] font-bold text-blue-600">72%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-200/50 rounded-full overflow-hidden shadow-inner">
                                <div class="h-full progress-gradient-blue w-[72%] rounded-full shadow-[0_0_10px_rgba(0,122,255,0.4)]"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1.5 items-end">
                                <span class="text-[11px] font-semibold text-slate-500">Загрузка</span>
                                <span class="text-[11px] font-bold text-emerald-600">85%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-200/50 rounded-full overflow-hidden shadow-inner">
                                <div class="h-full progress-gradient-green w-[85%] rounded-full shadow-[0_0_10px_rgba(52,199,89,0.4)]"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between mb-1.5 items-end">
                                <span class="text-[11px] font-semibold text-slate-500">Состояние</span>
                                <span class="text-[11px] font-bold text-purple-600">94%</span>
                            </div>
                            <div class="h-1.5 w-full bg-slate-200/50 rounded-full overflow-hidden shadow-inner">
                                <div class="h-full progress-gradient-teal w-[94%] rounded-full shadow-[0_0_10px_rgba(88,86,214,0.4)]"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Map -->
            <div class="col-span-12 lg:col-span-7 relative group h-full">
                <div class="w-full h-full rounded-3xl overflow-hidden shadow-card border border-white/60 relative bg-slate-100 map-container">
                    <div id="map" class="absolute inset-0 z-0"></div>
                    
                    <div class="absolute top-4 left-4 flex flex-col gap-1 z-20">
                        <div class="glass-card rounded-xl p-1 shadow-lg flex flex-col">
                            <button class="w-8 h-8 flex items-center justify-center text-slate-600 hover:text-blue-600 transition-colors border-b border-slate-200/50" onclick="map.zoomIn()">
                                <span class="material-symbols-outlined text-[20px]">add</span>
                            </button>
                            <button class="w-8 h-8 flex items-center justify-center text-slate-600 hover:text-blue-600 transition-colors" onclick="map.zoomOut()">
                                <span class="material-symbols-outlined text-[20px]">remove</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="absolute bottom-5 left-5 right-5 flex gap-4 z-20">
                        <div class="glass-card flex-1 p-3 rounded-2xl flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-500">
                                <span class="material-symbols-outlined text-[16px]">trip_origin</span>
                            </div>
                            <div>
                                <span class="text-[9px] uppercase text-slate-400 font-bold tracking-wider block">Откуда</span>
                                <span class="text-sm font-bold text-slate-800">Казань</span>
                            </div>
                        </div>
                        <div class="glass-card flex-1 p-3 rounded-2xl flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-500">
                                <span class="material-symbols-outlined text-[16px]">alt_route</span>
                            </div>
                            <div>
                                <span class="text-[9px] uppercase text-slate-400 font-bold tracking-wider block">Маршрут</span>
                                <span class="text-sm font-bold text-slate-800">M7-P239</span>
                            </div>
                        </div>
                        <div class="glass-card flex-1 p-3 rounded-2xl flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-red-50 flex items-center justify-center text-red-500">
                                <span class="material-symbols-outlined text-[16px]">flag</span>
                            </div>
                            <div>
                                <span class="text-[9px] uppercase text-slate-400 font-bold tracking-wider block">Куда</span>
                                <span class="text-sm font-bold text-slate-800">Минск</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Row: Info Cards -->
        <div class="h-36 grid grid-cols-12 gap-4 shrink-0">
            <!-- Cargo Card -->
            <div class="col-span-4 glass-card rounded-2xl p-4 flex flex-col justify-between relative overflow-hidden group">
                <div class="absolute -right-4 -top-4 w-20 h-20 bg-blue-50 rounded-full blur-2xl opacity-50 group-hover:opacity-100 transition-opacity"></div>
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-sm font-bold text-slate-800 flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-500 text-lg">inventory_2</span>
                        Груз
                    </h3>
                    <span class="px-2 py-0.5 rounded-md bg-blue-50 text-blue-600 text-[10px] font-bold">#ORD-4921</span>
                </div>
                <div class="grid grid-cols-2 gap-y-3 gap-x-1 text-sm">
                    <div class="flex flex-col">
                        <span class="text-[10px] text-slate-400 uppercase font-semibold">Тип</span>
                        <span class="font-semibold text-slate-700">Электроника</span>
                    </div>
                    <div class="flex flex-col text-right">
                        <span class="text-[10px] text-slate-400 uppercase font-semibold">Вес</span>
                        <span class="font-semibold text-slate-700">18.5 т</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-slate-400 uppercase font-semibold">Паллеты</span>
                        <span class="font-semibold text-slate-700">28 <span class="text-slate-400 font-normal">/ 38</span></span>
                    </div>
                    <div class="flex flex-col text-right">
                        <span class="text-[10px] text-slate-400 uppercase font-semibold">Стоимость</span>
                        <span class="font-bold text-emerald-600">₽ 2.4M</span>
                    </div>
                </div>
            </div>
            
            <!-- Temperature Card -->
            <div class="col-span-4 glass-card rounded-2xl p-4 flex flex-col justify-between items-center text-center relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-[0.03]">
                    <span class="material-symbols-outlined text-[120px] text-blue-600">thermostat</span>
                </div>
                <div class="w-full flex justify-between items-center mb-1">
                    <h3 class="text-sm font-bold text-slate-800 flex items-center gap-2">
                        <span class="material-symbols-outlined text-blue-500 text-lg">ac_unit</span>
                        Рефрижератор
                    </h3>
                </div>
                <div class="flex flex-col items-center justify-center flex-1">
                    <span class="text-4xl font-extrabold text-slate-800 tracking-tight drop-shadow-sm">+4°C</span>
                    <span class="text-[9px] text-slate-400 mt-0.5 font-medium bg-slate-100 px-2 py-0.5 rounded-full">+2°...+8°</span>
                </div>
                <div class="w-full flex items-center gap-2 justify-center mt-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_6px_rgba(16,185,129,0.6)]"></span>
                    <span class="text-xs font-bold text-emerald-600">Температура в норме</span>
                </div>
            </div>
            
            <!-- Events Card -->
            <div class="col-span-4 glass-card rounded-2xl p-4 flex flex-col overflow-hidden">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-sm font-bold text-slate-800 flex items-center gap-2">
                        <span class="material-symbols-outlined text-slate-500 text-lg">history</span>
                        События
                    </h3>
                </div>
                <div class="flex-1 overflow-y-auto custom-scrollbar pr-2 relative pl-2">
                    <div class="absolute left-[7px] top-2 bottom-2 w-[1px] bg-slate-200"></div>
                    <div class="space-y-3">
                        <div class="flex gap-3 relative group">
                            <div class="w-3 h-3 rounded-full bg-emerald-500 border-2 border-white shadow-sm shrink-0 relative z-10"></div>
                            <div>
                                <p class="text-xs font-bold text-slate-800">КПП Казань</p>
                                <p class="text-[9px] text-slate-400 font-medium">12:45</p>
                            </div>
                        </div>
                        <div class="flex gap-3 relative group">
                            <div class="w-3 h-3 rounded-full bg-blue-500 border-2 border-white shadow-sm shrink-0 relative z-10"></div>
                            <div>
                                <p class="text-xs font-bold text-slate-800">Заправка</p>
                                <p class="text-[9px] text-slate-400 font-medium">11:30 • 450л</p>
                            </div>
                        </div>
                        <div class="flex gap-3 relative group">
                            <div class="w-3 h-3 rounded-full bg-amber-400 border-2 border-white shadow-sm shrink-0 relative z-10"></div>
                            <div>
                                <p class="text-xs font-bold text-slate-800">Отдых</p>
                                <p class="text-[9px] text-slate-400 font-medium">10:00 • 45м</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Video Surveillance -->
        <div class="h-28 glass-card rounded-2xl p-3 relative shrink-0">
            <div class="flex items-center justify-between mb-2 px-1">
                <h3 class="text-sm font-bold text-slate-800 flex items-center gap-2">
                    <span class="material-symbols-outlined text-slate-500">videocam</span>
                    Видеонаблюдение
                </h3>
                <span class="px-2 py-0.5 bg-red-500/10 text-red-600 text-[10px] font-bold rounded-full border border-red-500/20 flex items-center gap-1.5 shadow-sm">
                    <span class="w-1.5 h-1.5 bg-red-500 rounded-full animate-ping"></span> LIVE
                </span>
            </div>
            <div class="flex gap-3 h-28 overflow-hidden">
                <div class="flex-1 rounded-xl bg-black relative overflow-hidden group cursor-pointer border border-white/20 shadow-md">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent z-10"></div>
                    <img alt="Cam 1" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDHQRicmXMoe2OWk2B7VpAZURLOAMth_LshqjLQ1aTDegDmEgL4YXtGccw0lpqYe-RcRfqrNZTsCt5dwtcz-2q2VtybxYILS5Wjfi4CV3PuysiprNVfAM_aCWcnGFZkpYF91g6hYR-o5mFs0N4O546qKB4hxFVPzOWZH_PMMMezeFcfvglEASwZphRsVvt0Lyl3otgmEMhbLHqpR2ax1Ptyzt-Ana5o-25rgmSdLj05pL19psefDV6EqhPSoYvlN0SThhpLcC9-4TE"/>
                    <div class="absolute bottom-2 left-3 z-20 flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_5px_rgba(16,185,129,0.8)]"></span>
                        <span class="text-[10px] text-white font-mono font-medium tracking-wide">CABIN_MAIN</span>
                    </div>
                    <span class="material-symbols-outlined absolute top-2 right-2 text-white/50 text-[16px] z-20">fullscreen</span>
                </div>
                <div class="flex-1 rounded-xl bg-black relative overflow-hidden group cursor-pointer border border-white/20 shadow-md">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent z-10"></div>
                    <img alt="Cam 2" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500" src="https://lh3.googleusercontent.com/aida-public/AB6AXuD-SROf5pEx-JWMk41YMQTo31P0nrU8Rr9YCgMFVu_15i4kNDyWtyZqHweut1AC5125qsccOuWqX5LhJyPUSNg8jnEr9-_ksivhHQxvztOxuvFV2yyHg3oaWDSjxcM3qFkmVK4L1Iz_7zKa4AMWxW0ocbsyRSepC3hoztIvfVviFusKZ8nRQ4Mmwvl7t7sSkoNpZ6sdTnQRHU61CC_8CIDu08VZw1r2kuLyPIQ_bCQUH5-SZ2oMiBijQD-Ptyj62RkNHgm2Y8YqgME"/>
                    <div class="absolute bottom-2 left-3 z-20 flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_5px_rgba(16,185,129,0.8)]"></span>
                        <span class="text-[10px] text-white font-mono font-medium tracking-wide">CARGO_REAR</span>
                    </div>
                    <span class="material-symbols-outlined absolute top-2 right-2 text-white/50 text-[16px] z-20">fullscreen</span>
                </div>
                <div class="flex-1 rounded-xl bg-slate-900 relative overflow-hidden group cursor-pointer border border-white/20 shadow-md flex items-center justify-center">
                    <div class="text-center">
                        <span class="material-symbols-outlined text-slate-600 text-[32px] mb-1">videocam_off</span>
                        <p class="text-[10px] text-slate-500 font-mono">ROAD_FRONT</p>
                    </div>
                    <div class="absolute bottom-2 left-3 z-20 flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-red-500"></span>
                        <span class="text-[10px] text-white/50 font-mono font-medium tracking-wide">OFFLINE</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Notifications Dropdown -->
<div id="notificationsDropdown" class="fixed top-20 right-4 w-96 glass-panel rounded-2xl shadow-2xl border border-white/60 z-50 hidden transform transition-all duration-300 opacity-0 scale-95">
    <div class="p-4 border-b border-slate-100">
        <div class="flex items-center justify-between">
            <h3 class="font-bold text-slate-800">Уведомления</h3>
            <button onclick="markAllRead()" class="text-xs text-blue-500 hover:text-blue-600 font-medium">Прочитать все</button>
        </div>
    </div>
    <div class="max-h-80 overflow-y-auto" id="notificationsList">
        <div class="p-3 border-b border-slate-50 hover:bg-blue-50/50 cursor-pointer transition-colors flex items-start gap-3">
            <div class="w-10 h-10 rounded-xl bg-red-100 flex items-center justify-center flex-shrink-0">
                <span class="material-symbols-outlined text-red-500 text-lg">warning</span>
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium text-slate-800">Превышение скорости</p>
                <p class="text-xs text-slate-500">A 123 BC 116 • 95 км/ч в зоне 60</p>
                <p class="text-[10px] text-slate-400 mt-1">5 минут назад</p>
            </div>
            <span class="w-2 h-2 rounded-full bg-blue-500 flex-shrink-0 mt-2"></span>
        </div>
        <div class="p-3 border-b border-slate-50 hover:bg-blue-50/50 cursor-pointer transition-colors flex items-start gap-3">
            <div class="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center flex-shrink-0">
                <span class="material-symbols-outlined text-amber-500 text-lg">local_gas_station</span>
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium text-slate-800">Низкий уровень топлива</p>
                <p class="text-xs text-slate-500">B 456 EK 116 • Осталось 15%</p>
                <p class="text-[10px] text-slate-400 mt-1">23 минуты назад</p>
            </div>
            <span class="w-2 h-2 rounded-full bg-blue-500 flex-shrink-0 mt-2"></span>
        </div>
        <div class="p-3 border-b border-slate-50 hover:bg-blue-50/50 cursor-pointer transition-colors flex items-start gap-3">
            <div class="w-10 h-10 rounded-xl bg-emerald-100 flex items-center justify-center flex-shrink-0">
                <span class="material-symbols-outlined text-emerald-500 text-lg">check_circle</span>
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium text-slate-800">Доставка завершена</p>
                <p class="text-xs text-slate-500">Заказ #4521 • Минск</p>
                <p class="text-[10px] text-slate-400 mt-1">1 час назад</p>
            </div>
        </div>
        <div class="p-3 hover:bg-blue-50/50 cursor-pointer transition-colors flex items-start gap-3">
            <div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center flex-shrink-0">
                <span class="material-symbols-outlined text-blue-500 text-lg">build</span>
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium text-slate-800">Напоминание о ТО</p>
                <p class="text-xs text-slate-500">C 789 HM 116 • через 500 км</p>
                <p class="text-[10px] text-slate-400 mt-1">2 часа назад</p>
            </div>
        </div>
    </div>
    <div class="p-3 border-t border-slate-100">
        <a href="./notifications.html" class="block text-center text-sm text-blue-500 hover:text-blue-600 font-medium">Все уведомления</a>
    </div>
</div>

<!-- Add Vehicle Modal -->
<div id="addVehicleModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeAddVehicleModal()"></div>
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg">
        <div class="glass-panel rounded-3xl p-6 m-4">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-slate-800">Добавить транспорт</h2>
                <button onclick="closeAddVehicleModal()" class="w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition-colors">
                    <span class="material-symbols-outlined text-slate-500">close</span>
                </button>
            </div>
            <form id="addVehicleForm" onsubmit="addVehicle(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Госномер</label>
                        <input type="text" name="plate" required class="w-full px-4 py-3 bg-white/70 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none" placeholder="A 123 BC 116">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Модель</label>
                        <input type="text" name="model" required class="w-full px-4 py-3 bg-white/70 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none" placeholder="MAN TGX 18.500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Водитель</label>
                        <select name="driver" class="w-full px-4 py-3 bg-white/70 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none">
                            <option value="">Не назначен</option>
                            <option value="1">Артём Малышев</option>
                            <option value="2">Сергей Иванов</option>
                            <option value="3">Дмитрий Козлов</option>
                            <option value="4">Алексей Петров</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Год выпуска</label>
                            <input type="number" name="year" class="w-full px-4 py-3 bg-white/70 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none" placeholder="2022">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Пробег (км)</label>
                            <input type="number" name="mileage" class="w-full px-4 py-3 bg-white/70 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none" placeholder="150000">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">ID трекера</label>
                        <input type="text" name="tracker" class="w-full px-4 py-3 bg-white/70 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none" placeholder="GLONASS-12345">
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeAddVehicleModal()" class="flex-1 px-4 py-3 bg-slate-100 hover:bg-slate-200 rounded-xl font-medium text-slate-700 transition-colors">Отмена</button>
                    <button type="submit" class="flex-1 btn-gradient px-4 py-3 rounded-xl font-medium">Добавить</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Leaflet Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// Vehicle data
const vehicles = [
    { id: 1, plate: 'A 123 BC 116', model: 'MAN TGX 18.500', driver: 'Артём Малышев', status: 'active', speed: 68, fuel: 75, lat: 54.3269, lng: 48.3862, route: 'Казань → Минск' },
    { id: 2, plate: 'B 456 EK 116', model: 'Volvo FH16', driver: 'Сергей Иванов', status: 'active', speed: 72, fuel: 45, lat: 55.1598, lng: 61.4025, route: 'Челябинск → Москва' },
    { id: 3, plate: 'C 789 HM 116', model: 'Scania R500', driver: 'Дмитрий Козлов', status: 'rest', speed: 0, fuel: 80, lat: 55.7558, lng: 37.6173, route: 'Москва (отдых)' },
    { id: 4, plate: 'E 012 PC 116', model: 'DAF XF', driver: 'Алексей Петров', status: 'repair', speed: 0, fuel: 30, lat: 59.9343, lng: 30.3351, route: 'СПб (ремонт)' },
    { id: 5, plate: 'K 345 TT 116', model: 'Mercedes Actros', driver: 'Иван Сидоров', status: 'alert', speed: 95, fuel: 20, lat: 53.9006, lng: 27.5590, route: 'Минск → Варшава' },
    { id: 6, plate: 'M 678 PP 116', model: 'Renault T High', driver: 'Николай Федоров', status: 'active', speed: 65, fuel: 55, lat: 56.8389, lng: 60.6057, route: 'Екатеринбург → Казань' }
];

let currentFilter = 'all';
let selectedVehicleId = 1;

// Role management
const userRoles = {
    owner: { name: 'Владелец', badge: 'Enterprise', color: 'text-purple-600' },
    admin: { name: 'Администратор', badge: 'Admin', color: 'text-red-600' },
    dispatcher: { name: 'Диспетчер', badge: 'Pro', color: 'text-blue-600' },
    logist: { name: 'Логист', badge: 'Pro', color: 'text-amber-600' }
};

function getCurrentRole() {
    return localStorage.getItem('routox_role') || 'dispatcher';
}

function updateRoleUI() {
    const role = getCurrentRole();
    const roleData = userRoles[role] || userRoles.dispatcher;
    
    const userNameEl = document.getElementById('userName');
    const userRoleEl = document.getElementById('userRole');
    
    if (userNameEl) userNameEl.textContent = roleData.name;
    if (userRoleEl) {
        userRoleEl.textContent = roleData.badge;
        userRoleEl.className = `text-[9px] ${roleData.color} font-semibold mt-0.5`;
    }
}

// Filter functions
function setFilter(filter) {
    currentFilter = filter;
    
    // Update button styles
    document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.dataset.filter === filter) {
            btn.className = 'filter-btn px-3 py-1.5 btn-gradient text-[11px] font-bold rounded-lg shadow-sm whitespace-nowrap tracking-wide';
        } else {
            btn.className = 'filter-btn px-3 py-1.5 bg-white/60 text-slate-500 hover:text-blue-600 text-[11px] font-bold rounded-lg border border-white/60 shadow-sm whitespace-nowrap transition-colors';
        }
    });
    
    renderVehicles();
    updateStats();
}

function filterVehicles() {
    renderVehicles();
}

function getFilteredVehicles() {
    const searchTerm = document.getElementById('vehicleSearch')?.value.toLowerCase() || '';
    
    return vehicles.filter(v => {
        const matchesSearch = v.plate.toLowerCase().includes(searchTerm) || 
                             v.model.toLowerCase().includes(searchTerm) || 
                             v.driver.toLowerCase().includes(searchTerm);
        
        if (currentFilter === 'all') return matchesSearch;
        if (currentFilter === 'active') return matchesSearch && v.status === 'active';
        if (currentFilter === 'rest') return matchesSearch && v.status === 'rest';
        if (currentFilter === 'alert') return matchesSearch && v.status === 'alert';
        if (currentFilter === 'repair') return matchesSearch && v.status === 'repair';
        
        return matchesSearch;
    });
}

function renderVehicles() {
    const container = document.getElementById('vehicleList');
    const filteredVehicles = getFilteredVehicles();
    
    container.innerHTML = filteredVehicles.map(v => {
        const isSelected = v.id === selectedVehicleId;
        const statusColor = {
            active: 'emerald-500',
            rest: 'amber-400',
            alert: 'red-500',
            repair: 'blue-500'
        }[v.status];
        
        const borderClass = isSelected ? 'border-l-4 border-l-blue-500 bg-white/80 ring-1 ring-blue-500/10' : 
                           v.status === 'rest' ? 'border-l-4 border-l-amber-400' :
                           v.status === 'alert' ? 'border-l-4 border-l-red-500' :
                           v.status === 'repair' ? 'border-l-4 border-l-blue-400 opacity-70' :
                           'border border-white/60';
        
        return `
            <div onclick="selectVehicle(${v.id})" class="glass-card p-4 rounded-2xl ${borderClass} cursor-pointer relative group hover:bg-white/90 transition-all">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 ${isSelected ? 'bg-gradient-to-br from-slate-100 to-slate-200' : 'bg-slate-50'} rounded-xl flex items-center justify-center ${isSelected ? 'text-slate-500 shadow-inner' : 'text-slate-400'}">
                            <span class="material-symbols-outlined">local_shipping</span>
                        </div>
                        <div>
                            <h3 class="font-bold ${isSelected ? 'text-slate-800' : 'text-slate-700'} text-sm flex items-center gap-2">
                                ${v.plate}
                                <span class="w-1.5 h-1.5 rounded-full bg-${statusColor} ${v.status === 'active' ? 'shadow-[0_0_8px_rgba(16,185,129,0.5)]' : ''}"></span>
                            </h3>
                            <p class="text-[11px] text-slate-500 font-medium">${v.model}</p>
                            <p class="text-[10px] text-slate-400 mt-0.5">${v.driver}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-lg font-bold ${v.speed > 0 ? (isSelected ? 'text-slate-800' : 'text-slate-700') : 'text-slate-400'} tracking-tight">${v.speed}</span>
                        <span class="text-[10px] text-slate-400 block font-medium">km/h</span>
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function selectVehicle(id) {
    selectedVehicleId = id;
    const vehicle = vehicles.find(v => v.id === id);
    
    if (vehicle) {
        // Update main panel
        updateVehicleDetails(vehicle);
        
        // Center map on vehicle
        if (map) {
            map.setView([vehicle.lat, vehicle.lng], 8);
        }
    }
    
    renderVehicles();
}

function updateVehicleDetails(v) {
    // Update vehicle title
    const titleEl = document.querySelector('.text-2xl.font-bold.text-slate-800');
    if (titleEl) {
        const modelParts = v.model.split(' ');
        titleEl.textContent = modelParts[0] + ' ' + (modelParts[1] || '');
    }
    
    // Update plate number
    const plateEl = document.querySelector('.font-mono.bg-slate-100\\/50');
    if (plateEl) {
        plateEl.textContent = v.plate;
    }
    
    // Update driver name - find element with driver info
    const driverNameEl = document.querySelector('#driverName');
    if (driverNameEl) {
        driverNameEl.textContent = v.driver;
    }
    
    // Update speed display
    const speedEl = document.querySelector('#currentSpeed');
    if (speedEl) {
        speedEl.textContent = v.speed;
    }
    
    // Update route info
    const routeEl = document.querySelector('#currentRoute');
    if (routeEl) {
        routeEl.textContent = v.route;
    }
}

function updateStats() {
    const activeCount = vehicles.filter(v => v.status === 'active').length;
    const restCount = vehicles.filter(v => v.status === 'rest').length;
    const repairCount = vehicles.filter(v => v.status === 'repair').length;
    const alertCount = vehicles.filter(v => v.status === 'alert').length;
    
    // Update stat cards if they exist
    const statValues = document.querySelectorAll('.stat-value, .text-base.font-bold');
    if (statValues.length >= 4) {
        // Update based on current HTML structure
    }
}

// Notifications
let notificationsOpen = false;

function toggleNotifications() {
    const dropdown = document.getElementById('notificationsDropdown');
    notificationsOpen = !notificationsOpen;
    
    if (notificationsOpen) {
        dropdown.classList.remove('hidden');
        setTimeout(() => {
            dropdown.classList.remove('opacity-0', 'scale-95');
            dropdown.classList.add('opacity-100', 'scale-100');
        }, 10);
    } else {
        dropdown.classList.add('opacity-0', 'scale-95');
        dropdown.classList.remove('opacity-100', 'scale-100');
        setTimeout(() => dropdown.classList.add('hidden'), 300);
    }
}

function markAllRead() {
    document.querySelectorAll('#notificationsList .bg-blue-500').forEach(dot => {
        dot.remove();
    });
    const badge = document.querySelector('.icon-btn .bg-red-500');
    if (badge) badge.textContent = '0';
}

// Add Vehicle Modal
function openAddVehicleModal() {
    document.getElementById('addVehicleModal').classList.remove('hidden');
}

function closeAddVehicleModal() {
    document.getElementById('addVehicleModal').classList.add('hidden');
    document.getElementById('addVehicleForm').reset();
}

function addVehicle(event) {
    event.preventDefault();
    const form = event.target;
    const formData = new FormData(form);
    
    const newVehicle = {
        id: vehicles.length + 1,
        plate: formData.get('plate'),
        model: formData.get('model'),
        driver: formData.get('driver') ? document.querySelector(`option[value="${formData.get('driver')}"]`).textContent : 'Не назначен',
        status: 'rest',
        speed: 0,
        fuel: 100,
        lat: 55.7558,
        lng: 37.6173,
        route: 'Ожидает назначения'
    };
    
    vehicles.push(newVehicle);
    renderVehicles();
    closeAddVehicleModal();
    
    // Show success notification
    showToast('Транспорт успешно добавлен!', 'success');
}

// Logout function
function logout() {
    if (typeof Routa !== 'undefined' && Routa.Auth) {
        Routa.Auth.logout();
    } else {
        localStorage.removeItem('routox_role');
        localStorage.removeItem('routox_token');
        window.location.href = 'login.html';
    }
}

// Toast notification
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `fixed bottom-24 right-8 px-6 py-3 rounded-xl shadow-lg z-50 transform transition-all duration-300 ${
        type === 'success' ? 'bg-emerald-500 text-white' : 'bg-blue-500 text-white'
    }`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('opacity-0', 'translate-y-2');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Initialize Map
let map;
let markers = [];

document.addEventListener('DOMContentLoaded', function() {
    updateRoleUI();
    renderVehicles();
    
    // Add notification button handler
    const notifBtn = document.querySelector('.icon-btn[title="Уведомления"]');
    if (notifBtn) {
        notifBtn.onclick = function(e) {
            e.preventDefault();
            toggleNotifications();
        };
    }
    
    // Close notifications on outside click
    document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('notificationsDropdown');
        const notifBtn = document.querySelector('.icon-btn[title="Уведомления"]');
        if (notificationsOpen && !dropdown.contains(e.target) && !notifBtn.contains(e.target)) {
            toggleNotifications();
        }
    });
    
    // Initialize Leaflet map
    map = L.map('map', {
        zoomControl: false,
        attributionControl: false
    }).setView([55.0084, 50.8224], 5);
    
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19
    }).addTo(map);
    
    // Add markers for all vehicles
    vehicles.forEach(v => {
        const statusColors = {
            active: '#10B981',
            rest: '#F59E0B',
            alert: '#EF4444',
            repair: '#3B82F6'
        };
        
        const truckIcon = L.divIcon({
            className: 'custom-truck-marker',
            html: `<div class="w-8 h-8 rounded-full border-3 border-white shadow-lg flex items-center justify-center" style="background: ${statusColors[v.status]}; ${v.status === 'active' ? 'animation: pulse 2s infinite;' : ''}">
                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                </svg>
            </div>`,
            iconSize: [32, 32],
            iconAnchor: [16, 16]
        });
        
        const marker = L.marker([v.lat, v.lng], { icon: truckIcon }).addTo(map);
        marker.bindPopup(`<div style="min-width: 150px;">
            <b style="font-size: 14px;">${v.plate}</b><br>
            <span style="color: #64748b;">${v.model}</span><br>
            <div style="margin-top: 6px; padding-top: 6px; border-top: 1px solid #e2e8f0;">
                <span style="font-weight: 600;">👨‍✈️ ${v.driver}</span><br>
                <span style="color: ${v.speed > 0 ? '#10b981' : '#94a3b8'};">${v.speed} km/h</span>
            </div>
            <div style="margin-top: 4px; font-size: 11px; color: #64748b;">${v.route}</div>
        </div>`);
        marker.on('click', () => selectVehicle(v.id));
        markers.push(marker);
    });
});
</script>
<script src="./assets/js/routa-core.js"></script>
<script>
  // Initialize Routa theme
  Routa.Theme.load();
</script>
<script src="./assets/js/role-theme.js"></script>
<script src="./assets/js/smooth-navigation.js"></script>
<script src="./assets/js/routox-ai.js"></script>

</body>
</html>
