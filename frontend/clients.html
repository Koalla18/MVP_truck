<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoutoX ‚Äî –ö–ª–∏–µ–Ω—Ç—ã</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script src="https://kit.fontawesome.com/a2e0e9e5a9.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="./assets/css/routox-unified.css">
  <link rel="stylesheet" href="./assets/css/page-transitions.css">
  <style>
    body {
        font-family: "Inter", sans-serif;
        background-color: #FFF8F0;
        background-image: 
            radial-gradient(at 0% 0%, hsla(30,100%,96%,1) 0, transparent 50%), 
            radial-gradient(at 100% 0%, hsla(35,100%,96%,1) 0, transparent 50%);
    }
    .glass-panel { background: rgba(255,255,255,0.75); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.9); box-shadow: 0 8px 32px 0 rgba(245,158,11,0.08); border-radius: 16px; }
    .glass-card { background: rgba(255,255,255,0.85); backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.7); box-shadow: 0 4px 20px rgba(245,158,11,0.05); border-radius: 14px; transition: all 0.2s ease; }
    .glass-card:hover { background: rgba(255,255,255,0.95); box-shadow: 0 10px 30px rgba(245,158,11,0.12); transform: translateY(-2px); }
    .nav-item-active { background: rgba(255,255,255,0.9); color: #f59e0b !important; box-shadow: 0 2px 10px rgba(245,158,11,0.15); font-weight: 600 !important; }
    .btn-primary { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; transition: all 0.2s ease; }
    .btn-primary:hover { background: linear-gradient(135deg, #d97706, #b45309); box-shadow: 0 8px 20px rgba(245,158,11,0.25); transform: translateY(-1px); }
    .client-card { cursor: pointer; border-left: 3px solid transparent; }
    .client-card.selected { border-left-color: #f59e0b; background: rgba(245,158,11,0.05); }
    .stat-card { background: linear-gradient(135deg, #fef3c7, #fde68a); border: 1px solid #fbbf24; }
    .segment-vip { background: rgba(147,51,234,0.1); color: #9333ea; }
    .segment-regular { background: rgba(59,130,246,0.1); color: #3b82f6; }
    .segment-new { background: rgba(16,185,129,0.1); color: #10b981; }
    .order-status-delivered { background: rgba(16,185,129,0.1); color: #10b981; }
    .order-status-transit { background: rgba(245,158,11,0.1); color: #f59e0b; }
    .order-status-pending { background: rgba(59,130,246,0.1); color: #3b82f6; }
    .order-status-cancelled { background: rgba(239,68,68,0.1); color: #ef4444; }
    .modal-overlay { background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); }
    .btn-secondary { background: white; border: 1px solid #e2e8f0; color: #475569; transition: all 0.2s ease; }
    .btn-secondary:hover { background: #f8fafc; border-color: #cbd5e1; }
    .segment-btn.active { background: rgba(245,158,11,0.1); color: #b45309; font-weight: 600; }
  </style>
</head>
<body>
  <header class="sticky top-0 z-40 glass-panel border-b border-white/50 px-6 py-3">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-8">
        <a href="logist.html" class="flex items-center gap-3 group">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center shadow-lg">
            <i class="fa-solid fa-truck-fast text-white text-lg"></i>
          </div>
          <div class="flex flex-col leading-none">
            <span class="text-lg font-bold bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent">RoutoX</span>
            <span class="text-[10px] text-slate-500 font-medium">LOGIST</span>
          </div>
        </a>
        <nav class="hidden lg:flex items-center gap-1 bg-slate-100/50 p-1 rounded-xl">
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="logist.html">–ó–∞–∫–∞–∑—ã</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="routes.html">–ú–∞—Ä—à—Ä—É—Ç—ã</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="trips.html">–†–µ–π—Å—ã</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="drivers-manage.html">–í–æ–¥–∏—Ç–µ–ª–∏</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-semibold nav-item-active transition-all" href="clients.html">–ö–ª–∏–µ–Ω—Ç—ã</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="warehouse.html">–°–∫–ª–∞–¥</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="loading-plan.html">–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="delivery-stats.html">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
          <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-amber-800 hover:bg-white/60 transition-colors" href="geozones.html">–ì–µ–æ–∑–æ–Ω—ã</a>
        </nav>
      </div>
      <div class="flex items-center gap-3">
        <span class="hidden lg:flex items-center gap-2 px-3 py-1.5 bg-amber-50 border border-amber-200 rounded-full text-xs">
            <i class="fa-solid fa-id-card text-amber-600"></i>
            <span class="font-semibold text-amber-800">–õ–æ–≥–∏—Å—Ç</span>
        </span>
        <div class="flex items-center gap-3 pl-1 pr-1 py-1 bg-white/50 border border-white rounded-full shadow-sm">
            <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden ring-2 ring-white">
                <img alt="User" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCTs9iN8pKS03W5I54u9FB4B-c8kh0-SvddoYiVdknvnn0XFQ_ScxzcOGMuvCw75ZDO7eej3OBFSUyW7YGzfIdw8bm2JVE2qYntX-6WFsuWZDXeCjqgvXyR-Lo9UnAE2bTQejiaicaZNqXTEEWzBEmoalZytqScbtdaXlk0i5laN5yjsqI3j457keHzESRrW4bLeWD2l5xuer1uZ4Zd_LMeP8p-XTEa4_wtLTcRyHGOncDuMQUJk788z8tvDII7r8UTdnahdzzaAtY"/>
            </div>
            <div class="pr-3 flex flex-col items-end leading-none">
                <p class="text-xs font-bold text-slate-800">–õ–æ–≥–∏—Å—Ç</p>
                <p class="text-[9px] text-amber-600 font-semibold mt-0.5">Pro</p>
            </div>
        </div>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-700 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50 relative" onclick="window.location.href='notifications.html'">
            <span class="material-symbols-outlined text-[20px]">notifications</span>
            <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full ring-2 ring-white"></span>
        </button>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-red-500 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50" onclick="logout()">
            <span class="material-symbols-outlined text-[20px]">logout</span>
        </button>
      </div>
    </div>
  </header>

  <main class="p-4 grid grid-cols-12 gap-4" style="height: calc(100vh - 88px);">
    <aside class="col-span-3 space-y-4 flex flex-col">
      <div class="grid grid-cols-2 gap-3">
        <div class="stat-card p-3 rounded-xl">
          <div class="text-2xl font-bold text-amber-800">42</div>
          <div class="text-[10px] text-amber-700 font-medium mt-1">–ö–ª–∏–µ–Ω—Ç–æ–≤</div>
        </div>
        <div class="stat-card p-3 rounded-xl">
          <div class="text-2xl font-bold text-purple-600">8</div>
          <div class="text-[10px] text-amber-700 font-medium mt-1">VIP</div>
        </div>
      </div>

      <button onclick="showAddClientModal()" class="btn-primary py-2.5 rounded-xl text-sm font-medium shadow-lg">
        <i class="fa-solid fa-user-plus mr-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
      </button>

      <div class="glass-panel p-4">
        <h3 class="text-xs font-bold text-slate-500 mb-3 uppercase">–°–µ–≥–º–µ–Ω—Ç—ã</h3>
        <div class="space-y-2" id="segmentFilters">
          <button onclick="filterSegment('all')" class="segment-btn active w-full text-left px-3 py-2 rounded-lg hover:bg-amber-50 text-sm flex justify-between items-center" data-segment="all">
            <span>–í—Å–µ</span><span class="text-xs text-slate-400" id="countAll">42</span>
          </button>
          <button onclick="filterSegment('vip')" class="segment-btn w-full text-left px-3 py-2 rounded-lg hover:bg-amber-50 text-sm flex justify-between items-center" data-segment="vip">
            <span>üåü VIP</span><span class="text-xs text-slate-400" id="countVip">8</span>
          </button>
          <button onclick="filterSegment('regular')" class="segment-btn w-full text-left px-3 py-2 rounded-lg hover:bg-amber-50 text-sm flex justify-between items-center" data-segment="regular">
            <span>–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ</span><span class="text-xs text-slate-400" id="countRegular">26</span>
          </button>
          <button onclick="filterSegment('new')" class="segment-btn w-full text-left px-3 py-2 rounded-lg hover:bg-amber-50 text-sm flex justify-between items-center" data-segment="new">
            <span>–ù–æ–≤—ã–µ</span><span class="text-xs text-slate-400" id="countNew">8</span>
          </button>
        </div>
      </div>

      <div class="glass-panel p-4 flex-1 overflow-y-auto">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-xs font-bold text-slate-500 uppercase">–ö–ª–∏–µ–Ω—Ç—ã</h3>
          <input type="text" id="searchClient" placeholder="–ü–æ–∏—Å–∫..." class="text-xs px-3 py-1.5 rounded-lg bg-white/60 border border-white/50 w-32" oninput="searchClients(this.value)">
        </div>
        <div class="space-y-2" id="clientsList"></div>
      </div>
    </aside>

    <section class="col-span-5">
      <div class="glass-panel p-4 h-full flex flex-col">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-bold text-slate-800">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h2>
          <select id="orderStatusFilter" class="text-xs px-3 py-1.5 rounded-lg bg-white/60 border border-white/50" onchange="filterOrdersByStatus(this.value)">
            <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
            <option value="delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</option>
            <option value="transit">–í –ø—É—Ç–∏</option>
            <option value="pending">–û–∂–∏–¥–∞–µ—Ç</option>
            <option value="cancelled">–û—Ç–º–µ–Ω—ë–Ω</option>
          </select>
        </div>
        <div class="flex-1 overflow-y-auto space-y-3" id="ordersHistory"></div>
      </div>
    </section>

    <aside class="col-span-4">
      <div class="glass-panel p-4 h-full overflow-y-auto">
        <h3 class="text-sm font-bold text-slate-800 mb-4">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ</h3>
        <div id="clientDetails">
          <div class="text-center text-slate-400 py-10">
            <i class="fa-solid fa-user-group text-4xl mb-3 opacity-30"></i>
            <p class="text-sm">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞</p>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Add/Edit Client Modal -->
  <div id="clientModal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
    <div class="glass-panel w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl">
      <div class="p-4 border-b border-white/30 flex items-center justify-between bg-gradient-to-r from-amber-500/10 to-orange-500/10">
        <h3 class="font-bold text-slate-800 text-lg" id="clientModalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h3>
        <button onclick="closeClientModal()" class="w-8 h-8 rounded-full bg-white/50 hover:bg-white flex items-center justify-center">
          <i class="fa-solid fa-times text-slate-500"></i>
        </button>
      </div>
      <form id="clientForm" class="p-4 space-y-4">
        <input type="hidden" id="clientId">
        <div class="grid grid-cols-2 gap-4">
          <div class="col-span-2">
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ *</label>
            <input type="text" id="clientName" required class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder='–û–û–û "–ù–∞–∑–≤–∞–Ω–∏–µ"'>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–ò–ù–ù *</label>
            <input type="text" id="clientInn" required class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="7701234567">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–°–µ–≥–º–µ–Ω—Ç</label>
            <select id="clientSegment" class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm">
              <option value="new">–ù–æ–≤—ã–π</option>
              <option value="regular">–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π</option>
              <option value="vip">VIP</option>
            </select>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ *</label>
            <input type="text" id="clientContact" required class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
            <input type="tel" id="clientPhone" required class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="+7 999 123-45-67">
          </div>
          <div class="col-span-2">
            <label class="text-xs font-semibold text-slate-600 mb-1 block">Email</label>
            <input type="email" id="clientEmail" class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="email@company.ru">
          </div>
          <div class="col-span-2">
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–ê–¥—Ä–µ—Å</label>
            <input type="text" id="clientAddress" class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1">
          </div>
          <div class="col-span-2">
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
            <textarea id="clientNotes" class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm h-20" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"></textarea>
          </div>
        </div>
      </form>
      <div class="p-4 border-t border-white/30 flex gap-3">
        <button onclick="closeClientModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 text-slate-600 font-semibold">–û—Ç–º–µ–Ω–∞</button>
        <button onclick="saveClient()" class="flex-1 py-2.5 rounded-xl btn-primary font-semibold">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div id="orderModal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
    <div class="glass-panel w-full max-w-2xl rounded-2xl overflow-hidden shadow-2xl">
      <div class="p-4 border-b border-white/30 flex items-center justify-between bg-gradient-to-r from-amber-500/10 to-orange-500/10">
        <h3 class="font-bold text-slate-800 text-lg" id="orderModalTitle">–ó–∞–∫–∞–∑ #1001</h3>
        <button onclick="closeOrderModal()" class="w-8 h-8 rounded-full bg-white/50 hover:bg-white flex items-center justify-center">
          <i class="fa-solid fa-times text-slate-500"></i>
        </button>
      </div>
      <div class="p-6" id="orderModalContent"></div>
      <div class="p-4 border-t border-white/30 flex gap-3">
        <button onclick="closeOrderModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 text-slate-600 font-semibold">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button onclick="printOrder()" class="py-2.5 px-6 rounded-xl btn-secondary font-semibold">
          <i class="fa-solid fa-print mr-2"></i>–ü–µ—á–∞—Ç—å
        </button>
        <button onclick="repeatOrder()" class="py-2.5 px-6 rounded-xl btn-primary font-semibold">
          <i class="fa-solid fa-redo mr-2"></i>–ü–æ–≤—Ç–æ—Ä–∏—Ç—å
        </button>
      </div>
    </div>
  </div>

  <!-- Create Order Modal -->
  <div id="createOrderModal" class="hidden fixed inset-0 modal-overlay z-50 flex items-center justify-center p-4">
    <div class="glass-panel w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl">
      <div class="p-4 border-b border-white/30 flex items-center justify-between bg-gradient-to-r from-green-500/10 to-emerald-500/10">
        <h3 class="font-bold text-slate-800 text-lg">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h3>
        <button onclick="closeCreateOrderModal()" class="w-8 h-8 rounded-full bg-white/50 hover:bg-white flex items-center justify-center">
          <i class="fa-solid fa-times text-slate-500"></i>
        </button>
      </div>
      <form id="orderForm" class="p-4 space-y-4">
        <input type="hidden" id="orderClientId">
        <div class="glass-card p-3 mb-4">
          <div class="text-xs text-slate-500 mb-1">–ö–ª–∏–µ–Ω—Ç</div>
          <div class="font-semibold text-slate-800" id="orderClientName">-</div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="col-span-2">
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–ú–∞—Ä—à—Ä—É—Ç *</label>
            <div class="grid grid-cols-2 gap-2">
              <input type="text" id="orderFrom" required class="px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="–û—Ç–∫—É–¥–∞">
              <input type="text" id="orderTo" required class="px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="–ö—É–¥–∞">
            </div>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–¢–∏–ø –≥—Ä—É–∑–∞ *</label>
            <select id="orderCargoType" class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm">
              <option value="general">–ì–µ–Ω–µ—Ä–∞–ª—å–Ω—ã–π</option>
              <option value="bulk">–ù–∞—Å—ã–ø–Ω–æ–π</option>
              <option value="liquid">–ù–∞–ª–∏–≤–Ω–æ–π</option>
              <option value="dangerous">–û–ø–∞—Å–Ω—ã–π</option>
              <option value="perishable">–°–∫–æ—Ä–æ–ø–æ—Ä—Ç—è—â–∏–π—Å—è</option>
            </select>
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–í–µ—Å (—Ç) *</label>
            <input type="number" id="orderWeight" required class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="0.0" step="0.1">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–î–∞—Ç–∞ –ø–æ–≥—Ä—É–∑–∫–∏ *</label>
            <input type="date" id="orderDate" required class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm">
          </div>
          <div>
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–°—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
            <input type="number" id="orderPrice" class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm" placeholder="0">
          </div>
          <div class="col-span-2">
            <label class="text-xs font-semibold text-slate-600 mb-1 block">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
            <textarea id="orderNotes" class="w-full px-4 py-2 rounded-xl bg-white/60 border border-white/50 text-sm h-16" placeholder="–û—Å–æ–±—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è"></textarea>
          </div>
        </div>
      </form>
      <div class="p-4 border-t border-white/30 flex gap-3">
        <button onclick="closeCreateOrderModal()" class="flex-1 py-2.5 rounded-xl bg-slate-100 text-slate-600 font-semibold">–û—Ç–º–µ–Ω–∞</button>
        <button onclick="submitNewOrder()" class="flex-1 py-2.5 rounded-xl btn-primary font-semibold">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
      </div>
    </div>
  </div>

  <script src="./assets/js/routa-core.js"></script>
  <script>
    Routa.Theme.load();

    // Data
    let clients = [
      { id: 1, name: '–û–û–û "–°—Ç—Ä–æ–π–õ–æ–≥–∏—Å—Ç–∏–∫–∞"', inn: '7701234567', contact: '–ò–≤–∞–Ω–æ–≤ –ü–µ—Ç—Ä', phone: '+7 495 123-4567', email: 'ivanov@stroylg.ru', address: '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, 15', segment: 'vip', orders: 156, revenue: 12500000, rating: 5.0, notes: '–ö–ª—é—á–µ–≤–æ–π –∫–ª–∏–µ–Ω—Ç, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞' },
      { id: 2, name: '–ò–ü –ú–æ—Ä–æ–∑–æ–≤ –ê.–í.', inn: '772298765432', contact: '–ú–æ—Ä–æ–∑–æ–≤ –ê–Ω–¥—Ä–µ–π', phone: '+7 916 888-9900', email: 'morozov@mail.ru', address: '–≥. –ú–æ—Å–∫–≤–∞, –õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä., 45', segment: 'regular', orders: 42, revenue: 3200000, rating: 4.8, notes: '' },
      { id: 3, name: '–ó–ê–û "–¢—Ä–∞–Ω—Å–°–Ω–∞–±"', inn: '7734567890', contact: '–ü–µ—Ç—Ä–æ–≤–∞ –ï–ª–µ–Ω–∞', phone: '+7 495 567-8901', email: 'petrova@transsnab.ru', address: '–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä., 100', segment: 'vip', orders: 289, revenue: 18700000, rating: 4.9, notes: '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã' },
      { id: 4, name: '–û–û–û "–ú–µ–≥–∞–¢–æ—Ä–≥"', inn: '7712345678', contact: '–°–∏–¥–æ—Ä–æ–≤ –ò–≥–æ—Ä—å', phone: '+7 495 222-3344', email: 'sidorov@megatorg.ru', address: '–≥. –ö–∞–∑–∞–Ω—å, —É–ª. –ë–∞—É–º–∞–Ω–∞, 50', segment: 'regular', orders: 67, revenue: 5100000, rating: 4.7, notes: '' },
      { id: 5, name: '–ò–ü –ö—É–∑–Ω–µ—Ü–æ–≤ –ú.–°.', inn: '772387654321', contact: '–ö—É–∑–Ω–µ—Ü–æ–≤ –ú–∞–∫—Å–∏–º', phone: '+7 917 555-6677', email: 'kuznetsov@gmail.com', address: '–≥. –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫, –ö—Ä–∞—Å–Ω—ã–π –ø—Ä., 20', segment: 'new', orders: 8, revenue: 450000, rating: 4.5, notes: '–ù–æ–≤—ã–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç' },
      { id: 6, name: '–û–û–û "–ê–≥—Ä–æ–•–∏–º"', inn: '7756789012', contact: '–í–∞—Å–∏–ª—å–µ–≤–∞ –û–ª—å–≥–∞', phone: '+7 495 777-8899', email: 'vasilyeva@agrohim.ru', address: '–≥. –í–æ—Ä–æ–Ω–µ–∂, —É–ª. –ú–∏—Ä–∞, 10', segment: 'regular', orders: 34, revenue: 2800000, rating: 4.6, notes: '–°–µ–∑–æ–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏' }
    ];

    let orders = [
      { id: 1001, clientId: 1, route: '–ú–æ—Å–∫–≤–∞ ‚Üí –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', from: '–ú–æ—Å–∫–≤–∞', to: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', date: '2026-01-15', deliveryDate: '2026-01-16', status: 'delivered', amount: 85000, weight: 12.5, cargoType: '–°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã', vehicle: '–ê 123 –ê–í', driver: '–ü–µ—Ç—Ä–æ–≤ –ò.–ê.' },
      { id: 1002, clientId: 1, route: '–ú–æ—Å–∫–≤–∞ ‚Üí –ö–∞–∑–∞–Ω—å', from: '–ú–æ—Å–∫–≤–∞', to: '–ö–∞–∑–∞–Ω—å', date: '2026-01-18', deliveryDate: null, status: 'transit', amount: 92000, weight: 15.0, cargoType: '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', vehicle: '–í 456 –ú–ö', driver: '–°–∏–¥–æ—Ä–æ–≤ –ü.–°.' },
      { id: 1003, clientId: 1, route: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ ‚Üí –ú–æ—Å–∫–≤–∞', from: '–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥', to: '–ú–æ—Å–∫–≤–∞', date: '2026-01-20', deliveryDate: '2026-01-21', status: 'delivered', amount: 88000, weight: 14.2, cargoType: '–ú–µ–±–µ–ª—å', vehicle: '–° 789 –ù–ù', driver: '–ö–æ–∑–ª–æ–≤ –ê.–ú.' },
      { id: 1004, clientId: 2, route: '–ú–æ—Å–∫–≤–∞ ‚Üí –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', from: '–ú–æ—Å–∫–≤–∞', to: '–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥', date: '2026-01-22', deliveryDate: '2026-01-22', status: 'delivered', amount: 45000, weight: 8.0, cargoType: '–ü—Ä–æ–¥—É–∫—Ç—ã', vehicle: '–ï 012 –ï–ï', driver: '–ù–æ–≤–∏–∫–æ–≤ –î.–í.' },
      { id: 1005, clientId: 3, route: '–ú–æ—Å–∫–≤–∞ ‚Üí –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', from: '–ú–æ—Å–∫–≤–∞', to: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', date: '2026-01-25', deliveryDate: null, status: 'transit', amount: 125000, weight: 20.0, cargoType: '–ú–µ—Ç–∞–ª–ª–æ–ø—Ä–æ–∫–∞—Ç', vehicle: '–ö 345 –ö–ö', driver: '–§–µ–¥–æ—Ä–æ–≤ –°.–ò.' },
      { id: 1006, clientId: 3, route: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ ‚Üí –ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', from: '–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥', to: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', date: '2026-01-28', deliveryDate: null, status: 'pending', amount: 145000, weight: 22.0, cargoType: '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', vehicle: null, driver: null },
      { id: 1007, clientId: 4, route: '–ö–∞–∑–∞–Ω—å ‚Üí –°–∞–º–∞—Ä–∞', from: '–ö–∞–∑–∞–Ω—å', to: '–°–∞–º–∞—Ä–∞', date: '2026-01-20', deliveryDate: '2026-01-20', status: 'delivered', amount: 38000, weight: 6.5, cargoType: '–¢–µ–∫—Å—Ç–∏–ª—å', vehicle: '–ú 678 –ú–ú', driver: '–û—Ä–ª–æ–≤ –í.–ê.' },
      { id: 1008, clientId: 5, route: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ ‚Üí –û–º—Å–∫', from: '–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫', to: '–û–º—Å–∫', date: '2026-01-24', deliveryDate: null, status: 'pending', amount: 52000, weight: 10.0, cargoType: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', vehicle: null, driver: null }
    ];

    let selectedClientId = null;
    let currentSegmentFilter = 'all';
    let currentStatusFilter = 'all';
    let currentOrderId = null;

    document.addEventListener('DOMContentLoaded', () => {
      updateStats();
      renderClients();
    });

    function updateStats() {
      const vip = clients.filter(c => c.segment === 'vip').length;
      const regular = clients.filter(c => c.segment === 'regular').length;
      const newClients = clients.filter(c => c.segment === 'new').length;
      
      document.getElementById('countAll').textContent = clients.length;
      document.getElementById('countVip').textContent = vip;
      document.getElementById('countRegular').textContent = regular;
      document.getElementById('countNew').textContent = newClients;
    }

    function renderClients() {
      let filtered = clients;
      if (currentSegmentFilter !== 'all') {
        filtered = clients.filter(c => c.segment === currentSegmentFilter);
      }
      
      document.getElementById('clientsList').innerHTML = filtered.map(c => `
        <div class="client-card glass-card p-3 ${selectedClientId === c.id ? 'selected' : ''}" onclick="selectClient(${c.id})">
          <div class="flex items-start gap-2 mb-2">
            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
              ${c.name.replace(/[^–∞-—è–ê-–Øa-zA-Z]/g, '').substring(0, 2).toUpperCase()}
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-sm text-slate-800 truncate">${c.name}</div>
              <div class="text-xs text-slate-500">${c.contact}</div>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-xs px-2 py-1 rounded-full segment-${c.segment}">${c.segment === 'vip' ? 'üåü VIP' : c.segment === 'regular' ? '–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π' : '–ù–æ–≤—ã–π'}</span>
            <span class="text-xs text-slate-600">${c.orders} –∑–∞–∫–∞–∑–æ–≤</span>
          </div>
        </div>
      `).join('');
    }

    function selectClient(id) {
      selectedClientId = id;
      renderClients();
      renderClientDetails();
      renderOrders();
    }

    function renderClientDetails() {
      const client = clients.find(c => c.id === selectedClientId);
      if (!client) {
        document.getElementById('clientDetails').innerHTML = `
          <div class="text-center text-slate-400 py-10">
            <i class="fa-solid fa-user-group text-4xl mb-3 opacity-30"></i>
            <p class="text-sm">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞</p>
          </div>
        `;
        return;
      }

      const formatMoney = (n) => n >= 1000000 ? (n/1000000).toFixed(1) + '–ú ‚ÇΩ' : (n/1000).toFixed(0) + '–ö ‚ÇΩ';
      
      document.getElementById('clientDetails').innerHTML = `
        <div class="space-y-4">
          <div class="glass-card p-4">
            <div class="font-bold text-lg text-slate-800 mb-1">${client.name}</div>
            <div class="text-xs px-2 py-1 rounded-full inline-block segment-${client.segment}">
              ${client.segment === 'vip' ? 'üåü VIP –ö–ª–∏–µ–Ω—Ç' : client.segment === 'regular' ? '–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç' : 'üÜï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç'}
            </div>
          </div>

          <div class="space-y-2 text-sm">
            <div class="flex justify-between py-2 border-b border-slate-100">
              <span class="text-slate-500">–ò–ù–ù</span>
              <span class="font-semibold">${client.inn}</span>
            </div>
            <div class="flex justify-between py-2 border-b border-slate-100">
              <span class="text-slate-500">–ö–æ–Ω—Ç–∞–∫—Ç</span>
              <span class="font-semibold">${client.contact}</span>
            </div>
            <div class="flex justify-between py-2 border-b border-slate-100">
              <span class="text-slate-500">–¢–µ–ª–µ—Ñ–æ–Ω</span>
              <a href="tel:${client.phone}" class="font-semibold text-amber-600 hover:underline">${client.phone}</a>
            </div>
            <div class="flex justify-between py-2 border-b border-slate-100">
              <span class="text-slate-500">Email</span>
              <a href="mailto:${client.email}" class="font-semibold text-amber-600 hover:underline text-xs">${client.email}</a>
            </div>
            <div class="py-2 border-b border-slate-100">
              <span class="text-slate-500 block mb-1">–ê–¥—Ä–µ—Å</span>
              <span class="font-medium text-xs">${client.address || '‚Äî'}</span>
            </div>
            ${client.notes ? `
            <div class="py-2">
              <span class="text-slate-500 block mb-1">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</span>
              <span class="font-medium text-xs text-slate-600">${client.notes}</span>
            </div>
            ` : ''}
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="glass-card p-3 text-center">
              <div class="text-2xl font-bold text-amber-600">${client.orders}</div>
              <div class="text-xs text-slate-600 mt-1">–ó–∞–∫–∞–∑–æ–≤</div>
            </div>
            <div class="glass-card p-3 text-center">
              <div class="text-2xl font-bold text-yellow-500">‚≠ê ${client.rating}</div>
              <div class="text-xs text-slate-600 mt-1">–†–µ–π—Ç–∏–Ω–≥</div>
            </div>
          </div>

          <div class="glass-card p-3 bg-gradient-to-br from-green-50 to-emerald-50">
            <div class="text-xs text-slate-600 mb-1">–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</div>
            <div class="text-2xl font-bold text-green-700">${formatMoney(client.revenue)}</div>
          </div>

          <div class="grid grid-cols-2 gap-2">
            <button onclick="showCreateOrderModal(${client.id})" class="btn-primary py-2.5 rounded-xl text-xs font-medium">
              <i class="fa-solid fa-plus mr-1"></i>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑
            </button>
            <button onclick="editClient(${client.id})" class="btn-secondary py-2.5 rounded-xl text-xs font-medium">
              <i class="fa-solid fa-edit mr-1"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </button>
          </div>
          
          <button onclick="deleteClient(${client.id})" class="w-full py-2 rounded-xl text-xs font-medium text-red-500 hover:bg-red-50 transition">
            <i class="fa-solid fa-trash mr-1"></i>–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
          </button>
        </div>
      `;
    }

    function renderOrders() {
      if (!selectedClientId) {
        document.getElementById('ordersHistory').innerHTML = '<p class="text-sm text-slate-400 text-center py-10">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</p>';
        return;
      }
      
      let clientOrders = orders.filter(o => o.clientId === selectedClientId);
      
      if (currentStatusFilter !== 'all') {
        clientOrders = clientOrders.filter(o => o.status === currentStatusFilter);
      }

      if (!clientOrders.length) {
        document.getElementById('ordersHistory').innerHTML = '<p class="text-sm text-slate-400 text-center py-10">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
        return;
      }

      const statusText = { delivered: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω', transit: '–í –ø—É—Ç–∏', pending: '–û–∂–∏–¥–∞–µ—Ç', cancelled: '–û—Ç–º–µ–Ω—ë–Ω' };
      const statusClass = { delivered: 'order-status-delivered', transit: 'order-status-transit', pending: 'order-status-pending', cancelled: 'order-status-cancelled' };

      document.getElementById('ordersHistory').innerHTML = clientOrders.map(o => `
        <div class="glass-card p-4 cursor-pointer hover:shadow-lg transition" onclick="showOrderDetails(${o.id})">
          <div class="flex items-center justify-between mb-3">
            <span class="font-bold text-slate-800">–ó–∞–∫–∞–∑ #${o.id}</span>
            <span class="text-xs px-3 py-1 rounded-full ${statusClass[o.status]}">${statusText[o.status]}</span>
          </div>
          <div class="space-y-2 text-sm">
            <div class="flex items-center text-slate-600">
              <i class="fa-solid fa-route w-5 text-amber-500"></i>
              <span>${o.route}</span>
            </div>
            <div class="flex items-center text-slate-600">
              <i class="fa-solid fa-box w-5 text-amber-500"></i>
              <span>${o.cargoType} ‚Ä¢ ${o.weight} —Ç</span>
            </div>
            <div class="flex items-center text-slate-600">
              <i class="fa-solid fa-calendar w-5 text-amber-500"></i>
              <span>${formatDate(o.date)}</span>
            </div>
            ${o.vehicle ? `
            <div class="flex items-center text-slate-600">
              <i class="fa-solid fa-truck w-5 text-amber-500"></i>
              <span>${o.vehicle} ‚Ä¢ ${o.driver}</span>
            </div>
            ` : ''}
          </div>
          <div class="flex items-center justify-between mt-3 pt-3 border-t border-slate-100">
            <span class="text-xs text-slate-500">–°—Ç–æ–∏–º–æ—Å—Ç—å</span>
            <span class="font-bold text-amber-600">${o.amount.toLocaleString('ru-RU')} ‚ÇΩ</span>
          </div>
        </div>
      `).join('');
    }

    function formatDate(dateStr) {
      const d = new Date(dateStr);
      return d.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    // Filter functions
    function filterSegment(segment) {
      currentSegmentFilter = segment;
      document.querySelectorAll('.segment-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.segment === segment);
      });
      renderClients();
    }

    function filterOrdersByStatus(status) {
      currentStatusFilter = status;
      renderOrders();
    }

    function searchClients(query) {
      const q = query.toLowerCase();
      const filtered = clients.filter(c => 
        c.name.toLowerCase().includes(q) || 
        c.contact.toLowerCase().includes(q) ||
        c.inn.includes(q)
      );
      
      document.getElementById('clientsList').innerHTML = filtered.map(c => `
        <div class="client-card glass-card p-3 ${selectedClientId === c.id ? 'selected' : ''}" onclick="selectClient(${c.id})">
          <div class="flex items-start gap-2 mb-2">
            <div class="w-9 h-9 rounded-lg bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
              ${c.name.replace(/[^–∞-—è–ê-–Øa-zA-Z]/g, '').substring(0, 2).toUpperCase()}
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-sm text-slate-800 truncate">${c.name}</div>
              <div class="text-xs text-slate-500">${c.contact}</div>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-xs px-2 py-1 rounded-full segment-${c.segment}">${c.segment === 'vip' ? 'üåü VIP' : c.segment === 'regular' ? '–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π' : '–ù–æ–≤—ã–π'}</span>
            <span class="text-xs text-slate-600">${c.orders} –∑–∞–∫–∞–∑–æ–≤</span>
          </div>
        </div>
      `).join('');
    }

    // Client Modal functions
    function showAddClientModal() {
      document.getElementById('clientModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞';
      document.getElementById('clientForm').reset();
      document.getElementById('clientId').value = '';
      document.getElementById('clientModal').classList.remove('hidden');
    }

    function editClient(id) {
      const client = clients.find(c => c.id === id);
      if (!client) return;
      
      document.getElementById('clientModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞';
      document.getElementById('clientId').value = client.id;
      document.getElementById('clientName').value = client.name;
      document.getElementById('clientInn').value = client.inn;
      document.getElementById('clientSegment').value = client.segment;
      document.getElementById('clientContact').value = client.contact;
      document.getElementById('clientPhone').value = client.phone;
      document.getElementById('clientEmail').value = client.email || '';
      document.getElementById('clientAddress').value = client.address || '';
      document.getElementById('clientNotes').value = client.notes || '';
      document.getElementById('clientModal').classList.remove('hidden');
    }

    function closeClientModal() {
      document.getElementById('clientModal').classList.add('hidden');
    }

    function saveClient() {
      const id = document.getElementById('clientId').value;
      const clientData = {
        name: document.getElementById('clientName').value,
        inn: document.getElementById('clientInn').value,
        segment: document.getElementById('clientSegment').value,
        contact: document.getElementById('clientContact').value,
        phone: document.getElementById('clientPhone').value,
        email: document.getElementById('clientEmail').value,
        address: document.getElementById('clientAddress').value,
        notes: document.getElementById('clientNotes').value
      };

      if (!clientData.name || !clientData.inn || !clientData.contact || !clientData.phone) {
        showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
        return;
      }

      if (id) {
        const idx = clients.findIndex(c => c.id === parseInt(id));
        if (idx !== -1) {
          clients[idx] = { ...clients[idx], ...clientData };
        }
      } else {
        const newId = Math.max(...clients.map(c => c.id)) + 1;
        clients.push({
          id: newId,
          ...clientData,
          orders: 0,
          revenue: 0,
          rating: 5.0
        });
      }

      closeClientModal();
      updateStats();
      renderClients();
      if (selectedClientId) renderClientDetails();
      showToast(id ? '–ö–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω' : '–ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
    }

    function deleteClient(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;
      
      clients = clients.filter(c => c.id !== id);
      orders = orders.filter(o => o.clientId !== id);
      
      if (selectedClientId === id) {
        selectedClientId = null;
        renderClientDetails();
        document.getElementById('ordersHistory').innerHTML = '<p class="text-sm text-slate-400 text-center py-10">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</p>';
      }
      
      updateStats();
      renderClients();
      showToast('–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª—ë–Ω');
    }

    // Order Modal functions
    function showOrderDetails(orderId) {
      const order = orders.find(o => o.id === orderId);
      if (!order) return;
      
      currentOrderId = orderId;
      const client = clients.find(c => c.id === order.clientId);
      const statusText = { delivered: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω', transit: '–í –ø—É—Ç–∏', pending: '–û–∂–∏–¥–∞–µ—Ç', cancelled: '–û—Ç–º–µ–Ω—ë–Ω' };
      const statusClass = { delivered: 'order-status-delivered', transit: 'order-status-transit', pending: 'order-status-pending', cancelled: 'order-status-cancelled' };

      document.getElementById('orderModalTitle').textContent = `–ó–∞–∫–∞–∑ #${order.id}`;
      document.getElementById('orderModalContent').innerHTML = `
        <div class="space-y-6">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-sm text-slate-500">–ö–ª–∏–µ–Ω—Ç</div>
              <div class="font-bold text-lg text-slate-800">${client?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</div>
            </div>
            <span class="text-sm px-4 py-2 rounded-full ${statusClass[order.status]}">${statusText[order.status]}</span>
          </div>

          <div class="glass-card p-4">
            <div class="text-sm text-slate-500 mb-2">–ú–∞—Ä—à—Ä—É—Ç</div>
            <div class="flex items-center gap-4">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                  <span class="font-medium">${order.from}</span>
                </div>
                <div class="border-l-2 border-dashed border-slate-300 h-4 ml-1.5"></div>
                <div class="flex items-center gap-2 mt-2">
                  <div class="w-3 h-3 rounded-full bg-green-500"></div>
                  <span class="font-medium">${order.to}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div class="glass-card p-3">
              <div class="text-xs text-slate-500">–¢–∏–ø –≥—Ä—É–∑–∞</div>
              <div class="font-semibold">${order.cargoType}</div>
            </div>
            <div class="glass-card p-3">
              <div class="text-xs text-slate-500">–í–µ—Å</div>
              <div class="font-semibold">${order.weight} —Ç</div>
            </div>
            <div class="glass-card p-3">
              <div class="text-xs text-slate-500">–î–∞—Ç–∞ –ø–æ–≥—Ä—É–∑–∫–∏</div>
              <div class="font-semibold">${formatDate(order.date)}</div>
            </div>
            <div class="glass-card p-3">
              <div class="text-xs text-slate-500">–î–∞—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</div>
              <div class="font-semibold">${order.deliveryDate ? formatDate(order.deliveryDate) : '‚Äî'}</div>
            </div>
          </div>

          ${order.vehicle ? `
          <div class="glass-card p-4 bg-gradient-to-br from-blue-50 to-indigo-50">
            <div class="text-sm text-slate-500 mb-2">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div>
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center">
                <i class="fa-solid fa-truck text-white"></i>
              </div>
              <div>
                <div class="font-semibold">${order.vehicle}</div>
                <div class="text-sm text-slate-600">${order.driver}</div>
              </div>
            </div>
          </div>
          ` : `
          <div class="glass-card p-4 bg-gradient-to-br from-amber-50 to-orange-50">
            <div class="text-sm text-amber-700 flex items-center gap-2">
              <i class="fa-solid fa-clock"></i>
              –û–∂–∏–¥–∞–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
            </div>
          </div>
          `}

          <div class="glass-card p-4 bg-gradient-to-br from-green-50 to-emerald-50">
            <div class="flex items-center justify-between">
              <div class="text-sm text-slate-500">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
              <div class="text-2xl font-bold text-green-700">${order.amount.toLocaleString('ru-RU')} ‚ÇΩ</div>
            </div>
          </div>
        </div>
      `;
      
      document.getElementById('orderModal').classList.remove('hidden');
    }

    function closeOrderModal() {
      document.getElementById('orderModal').classList.add('hidden');
      currentOrderId = null;
    }

    function printOrder() {
      window.print();
    }

    function repeatOrder() {
      const order = orders.find(o => o.id === currentOrderId);
      if (!order) return;
      
      showCreateOrderModal(order.clientId);
      document.getElementById('orderFrom').value = order.from;
      document.getElementById('orderTo').value = order.to;
      document.getElementById('orderWeight').value = order.weight;
      document.getElementById('orderPrice').value = order.amount;
      closeOrderModal();
    }

    // Create Order Modal
    function showCreateOrderModal(clientId) {
      const client = clients.find(c => c.id === clientId);
      if (!client) return;
      
      document.getElementById('orderClientId').value = clientId;
      document.getElementById('orderClientName').textContent = client.name;
      document.getElementById('orderForm').reset();
      document.getElementById('orderDate').valueAsDate = new Date();
      document.getElementById('createOrderModal').classList.remove('hidden');
    }

    function closeCreateOrderModal() {
      document.getElementById('createOrderModal').classList.add('hidden');
    }

    function submitNewOrder() {
      const clientId = parseInt(document.getElementById('orderClientId').value);
      const from = document.getElementById('orderFrom').value;
      const to = document.getElementById('orderTo').value;
      const weight = parseFloat(document.getElementById('orderWeight').value);
      const date = document.getElementById('orderDate').value;
      const price = parseInt(document.getElementById('orderPrice').value) || 0;
      const cargoType = document.getElementById('orderCargoType').options[document.getElementById('orderCargoType').selectedIndex].text;

      if (!from || !to || !weight || !date) {
        showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
        return;
      }

      const newId = Math.max(...orders.map(o => o.id)) + 1;
      orders.push({
        id: newId,
        clientId: clientId,
        route: `${from} ‚Üí ${to}`,
        from: from,
        to: to,
        date: date,
        deliveryDate: null,
        status: 'pending',
        amount: price,
        weight: weight,
        cargoType: cargoType,
        vehicle: null,
        driver: null
      });

      const client = clients.find(c => c.id === clientId);
      if (client) {
        client.orders++;
        client.revenue += price;
      }

      closeCreateOrderModal();
      renderOrders();
      updateStats();
      renderClientDetails();
      showToast('–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω');
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = 'fixed bottom-4 right-4 glass-panel px-6 py-3 flex items-center gap-3 z-50 shadow-lg';
      const icon = type === 'error' ? 'fa-exclamation-circle' : 'fa-check';
      const color = type === 'error' ? 'red' : 'green';
      toast.innerHTML = `
        <div class="w-8 h-8 rounded-lg bg-${color}-500/20 flex items-center justify-center">
          <i class="fa-solid ${icon} text-${color}-500"></i>
        </div>
        <span class="font-medium text-slate-800">${message}</span>
      `;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function logout() {
      if (typeof Routa !== 'undefined' && Routa.Auth) {
        Routa.Auth.logout();
      } else {
        localStorage.removeItem('routox_token');
        localStorage.removeItem('routox_role');
        window.location.href = 'login.html';
      }
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeClientModal();
        closeOrderModal();
        closeCreateOrderModal();
      }
    });
  </script>
  <script src="./assets/js/smooth-navigation.js"></script>
</body>
</html>
