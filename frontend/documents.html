<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoutoX — Документы</title>
  <link rel="stylesheet" href="./assets/css/routox-unified.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script src="https://kit.fontawesome.com/a2e0e9e5a9.js" crossorigin="anonymous"></script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
  <style>
    .doc-status { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
    .doc-signed { background: rgba(16, 185, 129, 0.15); color: #059669; border: 1px solid rgba(16, 185, 129, 0.3); }
    .doc-pending { background: rgba(245, 158, 11, 0.15); color: #d97706; border: 1px solid rgba(245, 158, 11, 0.3); }
    .doc-draft { background: rgba(100, 116, 139, 0.15); color: #64748b; border: 1px solid rgba(100, 116, 139, 0.3); }
    .doc-rejected { background: rgba(239, 68, 68, 0.15); color: #dc2626; border: 1px solid rgba(239, 68, 68, 0.3); }
    [data-theme="dark"] .doc-signed { color: #34d399; }
    [data-theme="dark"] .doc-pending { color: #fbbf24; }
    [data-theme="dark"] .doc-draft { color: #94a3b8; }
    [data-theme="dark"] .doc-rejected { color: #f87171; }
    .doc-row { transition: all 0.2s ease; cursor: pointer; border-radius: 8px; }
    .doc-row:hover { background: rgba(59, 130, 246, 0.08); }
    .tab-btn { flex: 1; padding: 12px; border-radius: 12px; font-size: 14px; font-weight: 500; transition: all 0.2s ease; color: var(--text-secondary); }
    .tab-btn:hover { color: var(--text-primary); }
    .tab-btn.active { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
    .doc-3d { perspective: 500px; }
    .doc-3d-inner { transform-style: preserve-3d; animation: docFloat 4s ease-in-out infinite; }
    @keyframes docFloat { 0%, 100% { transform: rotateY(-5deg) rotateX(5deg); } 50% { transform: rotateY(5deg) rotateX(-5deg); } }
    .timeline-item { position: relative; padding-left: 24px; }
    .timeline-item::before { content: ''; position: absolute; left: 0; top: 8px; width: 10px; height: 10px; border-radius: 50%; background: #3b82f6; }
    .timeline-item::after { content: ''; position: absolute; left: 4px; top: 22px; width: 2px; height: calc(100% + 8px); background: rgba(59, 130, 246, 0.3); }
    .timeline-item:last-child::after { display: none; }
    .qr-container { background: white; padding: 12px; border-radius: 12px; }
    .role-badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .role-badge.admin { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
    .role-badge.owner { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; border: 1px solid rgba(139, 92, 246, 0.3); }
    .role-badge.dispatcher { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="h-16 glass-panel flex items-center justify-between px-6 z-40 shrink-0 border-b border-white/50 sticky top-0 mx-4 mt-4 rounded-2xl">
    <div class="flex items-center gap-12">
        <div class="flex items-center gap-3">
            <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-extrabold text-xl shadow-lg shadow-blue-500/20">
                R
            </div>
            <div class="flex flex-col">
                <span class="font-bold text-lg leading-none tracking-tight text-slate-800">RoutoX</span>
                <span class="text-[10px] text-slate-400 font-semibold uppercase tracking-widest mt-0.5">Fleet OS</span>
            </div>
        </div>
        <nav class="hidden lg:flex items-center gap-1 bg-slate-100/50 p-1 rounded-xl">
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="fleet.html">Флот</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="trips.html">Рейсы</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="geozones.html">Геозоны</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="fuel.html">Топливо</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-800 hover:bg-white/60 transition-colors" href="maintenance.html">ТО</a>
            <a class="px-4 py-1.5 rounded-lg text-sm font-semibold nav-item-active transition-all" href="documents.html">Документы</a>
        </nav>
    </div>
    <div class="flex items-center gap-5">
        <div class="px-3 py-1.5 bg-white/60 backdrop-blur-md border border-white/60 rounded-full flex items-center gap-2 shadow-sm">
            <span class="relative flex h-2.5 w-2.5">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
            </span>
            <span class="text-xs font-bold text-slate-700 tracking-tight">LIVE</span>
        </div>
        <div class="h-6 w-px bg-slate-200"></div>
        <div class="flex items-center gap-3 pl-1 pr-1 py-1 bg-white/50 border border-white rounded-full shadow-sm hover:shadow-md transition-shadow cursor-pointer">
            <div class="w-8 h-8 rounded-full bg-slate-200 overflow-hidden ring-2 ring-white">
                <img alt="User" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCTs9iN8pKS03W5I54u9FB4B-c8kh0-SvddoYiVdknvnn0XFQ_ScxzcOGMuvCw75ZDO7eej3OBFSUyW7YGzfIdw8bm2JVE2qYntX-6WFsuWZDXeCjqgvXyR-Lo9UnAE2bTQejiaicaZNqXTEEWzBEmoalZytqScbtdaXlk0i5laN5yjsqI3j457keHzESRrW4bLeWD2l5xuer1uZ4Zd_LMeP8p-XTEa4_wtLTcRyHGOncDuMQUJk788z8tvDII7r8UTdnahdzzaAtY"/>
            </div>
            <div class="pr-3 flex flex-col items-end leading-none">
                <p class="text-xs font-bold text-slate-800" id="userName">Диспетчер</p>
                <p class="text-[9px] text-blue-600 font-semibold mt-0.5" id="userRole">Pro</p>
            </div>
        </div>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-slate-700 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50 relative" title="Уведомления" onclick="window.location.href='notifications.html'">
            <span class="material-symbols-outlined text-[20px]">notifications</span>
            <span class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full ring-2 ring-white"></span>
        </button>
        <button class="w-10 h-10 flex items-center justify-center text-slate-400 hover:text-red-500 bg-white/50 hover:bg-white rounded-full transition-all shadow-sm border border-white/50" title="Выход" onclick="logout()">
            <span class="material-symbols-outlined text-[20px]">logout</span>
        </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="p-4 grid grid-cols-12 gap-4">
    <!-- Left Panel - Document List -->
    <section class="col-span-8 space-y-4">
      <!-- Actions Bar -->
      <div class="glass-panel p-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <button class="btn-primary flex items-center gap-2" onclick="showCreateModal()">
            <i class="fa-solid fa-plus"></i>
            Создать eTTН
          </button>
          <button class="glass-card px-4 py-2.5 flex items-center gap-2 text-sm" onclick="importDocuments()">
            <i class="fa-solid fa-file-import text-blue-500"></i>
            Импорт
          </button>
          <button class="glass-card px-4 py-2.5 flex items-center gap-2 text-sm" onclick="showExportModal()">
            <i class="fa-solid fa-file-export text-emerald-500"></i>
            Экспорт
          </button>
          <input type="file" id="importInput" accept=".json,.csv,.xlsx" style="display: none" onchange="handleImport(event)">
        </div>

        <div class="flex items-center gap-2">
          <div class="relative">
            <input type="text" placeholder="Поиск документов..." class="input-field pl-10 w-64">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-muted text-sm"></i>
          </div>
          <button class="icon-btn"><i class="fa-solid fa-filter text-muted"></i></button>
        </div>
      </div>

      <!-- Tabs -->
      <div class="glass-panel p-2 flex items-center gap-2">
        <button class="tab-btn active" data-tab="all">
          Все документы
          <span class="ml-2 px-2 py-0.5 rounded-lg bg-blue-500/15 text-xs text-blue-500">156</span>
        </button>
        <button class="tab-btn" data-tab="ttn">
          eTTН
          <span class="ml-2 px-2 py-0.5 rounded-lg bg-slate-500/15 text-xs">89</span>
        </button>
        <button class="tab-btn" data-tab="invoices">
          Счета
          <span class="ml-2 px-2 py-0.5 rounded-lg bg-slate-500/15 text-xs">42</span>
        </button>
        <button class="tab-btn" data-tab="contracts">
          Договоры
          <span class="ml-2 px-2 py-0.5 rounded-lg bg-slate-500/15 text-xs">25</span>
        </button>
      </div>

      <!-- Documents Table -->
      <div class="glass-panel overflow-hidden">
        <table class="w-full">
          <thead>
            <tr style="border-bottom: 1px solid var(--border-color);">
              <th class="text-left p-4 text-xs font-medium text-muted uppercase tracking-wider">
                <input type="checkbox" class="rounded" style="background: var(--bg-card); border-color: var(--border-color);">
              </th>
              <th class="text-left p-4 text-xs font-medium text-muted uppercase tracking-wider">Номер</th>
              <th class="text-left p-4 text-xs font-medium text-muted uppercase tracking-wider">Тип</th>
              <th class="text-left p-4 text-xs font-medium text-muted uppercase tracking-wider">Маршрут</th>
              <th class="text-left p-4 text-xs font-medium text-muted uppercase tracking-wider">Дата</th>
              <th class="text-left p-4 text-xs font-medium text-muted uppercase tracking-wider">Статус</th>
              <th class="text-right p-4 text-xs font-medium text-muted uppercase tracking-wider">Действия</th>
            </tr>
          </thead>
          <tbody id="documentsTable"></tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="flex items-center justify-between">
        <span class="text-sm text-muted">Показано 1-10 из 156 документов</span>
        <div class="flex items-center gap-2">
          <button class="icon-btn w-8 h-8"><i class="fa-solid fa-chevron-left text-xs"></i></button>
          <button class="w-8 h-8 rounded-lg bg-blue-500 text-white text-sm font-medium">1</button>
          <button class="w-8 h-8 rounded-lg text-sm" style="background: var(--bg-card);">2</button>
          <button class="w-8 h-8 rounded-lg text-sm" style="background: var(--bg-card);">3</button>
          <span class="text-muted">...</span>
          <button class="w-8 h-8 rounded-lg text-sm" style="background: var(--bg-card);">16</button>
          <button class="icon-btn w-8 h-8"><i class="fa-solid fa-chevron-right text-xs"></i></button>
        </div>
      </div>
    </section>

    <!-- Right Panel - Document Details -->
    <aside class="col-span-4 space-y-4">
      <!-- Document Preview -->
      <div class="glass-panel p-5" id="docPreview">
        <div class="flex items-center justify-between mb-4">
          <span class="text-xs text-muted uppercase tracking-wider">Просмотр документа</span>
          <span class="doc-status doc-signed">Подписан</span>
        </div>

        <!-- 3D Document Icon -->
        <div class="doc-3d flex justify-center mb-4">
          <div class="doc-3d-inner">
            <div class="w-32 h-40 rounded-xl shadow-2xl flex flex-col items-center justify-center relative overflow-hidden" style="background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card)); border: 1px solid var(--border-color);">
              <div class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-emerald-500/10"></div>
              <i class="fa-solid fa-file-lines text-4xl text-blue-500 mb-2"></i>
              <span class="text-xs font-semibold">eTTН</span>
              <span class="text-xs text-muted">PDF</span>
              <div class="absolute bottom-2 right-2">
                <i class="fa-solid fa-check-circle text-emerald-500"></i>
              </div>
            </div>
          </div>
        </div>

        <h3 class="text-lg font-bold text-center" id="docTitle">eTTН-2024-001254</h3>
        <p class="text-sm text-muted text-center mb-4">Москва → Санкт-Петербург</p>

        <!-- QR Code -->
        <div class="flex justify-center mb-4">
          <div class="qr-container">
            <svg viewBox="0 0 100 100" width="80" height="80">
              <rect x="10" y="10" width="20" height="20" fill="#000"/>
              <rect x="70" y="10" width="20" height="20" fill="#000"/>
              <rect x="10" y="70" width="20" height="20" fill="#000"/>
              <rect x="40" y="10" width="10" height="10" fill="#000"/>
              <rect x="50" y="20" width="10" height="10" fill="#000"/>
              <rect x="40" y="40" width="20" height="20" fill="#000"/>
              <rect x="70" y="40" width="10" height="10" fill="#000"/>
              <rect x="40" y="70" width="10" height="10" fill="#000"/>
              <rect x="60" y="70" width="10" height="10" fill="#000"/>
              <rect x="70" y="80" width="20" height="10" fill="#000"/>
            </svg>
          </div>
        </div>

        <!-- Document Details -->
        <div class="space-y-3 text-sm">
          <div class="flex justify-between">
            <span class="text-muted">Грузоотправитель:</span>
            <span class="font-medium">ООО "ТрансЛогистик"</span>
          </div>
          <div class="flex justify-between">
            <span class="text-muted">Грузополучатель:</span>
            <span class="font-medium">ИП Петров А.С.</span>
          </div>
          <div class="flex justify-between">
            <span class="text-muted">Перевозчик:</span>
            <span class="font-medium">RoutoX Cargo</span>
          </div>
          <div class="flex justify-between">
            <span class="text-muted">Вес груза:</span>
            <span class="font-medium">5,240 кг</span>
          </div>
          <div class="flex justify-between">
            <span class="text-muted">Стоимость:</span>
            <span class="font-medium text-emerald-500">₽ 125,000</span>
          </div>
        </div>

        <!-- Signatures -->
        <div class="mt-5 pt-5" style="border-top: 1px solid var(--border-color);">
          <div class="text-xs text-muted mb-3">Электронные подписи</div>
          <div class="space-y-2">
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                <i class="fa-solid fa-signature text-emerald-500 text-sm"></i>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium">Отправитель</div>
                <div class="text-xs text-muted">15.01.2024 09:30</div>
              </div>
              <i class="fa-solid fa-check-circle text-emerald-500"></i>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                <i class="fa-solid fa-signature text-emerald-500 text-sm"></i>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium">Перевозчик</div>
                <div class="text-xs text-muted">15.01.2024 10:15</div>
              </div>
              <i class="fa-solid fa-check-circle text-emerald-500"></i>
            </div>
            <div class="flex items-center gap-3">
              <div class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center">
                <i class="fa-solid fa-clock text-amber-500 text-sm"></i>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium">Получатель</div>
                <div class="text-xs text-muted">Ожидает подписи</div>
              </div>
              <i class="fa-solid fa-hourglass-half text-amber-500"></i>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex gap-2 mt-5">
          <button class="flex-1 btn-primary text-sm flex items-center justify-center gap-2">
            <i class="fa-solid fa-download"></i>
            Скачать
          </button>
          <button class="flex-1 glass-card py-2.5 text-sm flex items-center justify-center gap-2">
            <i class="fa-solid fa-print text-muted"></i>
            Печать
          </button>
        </div>
      </div>

      <!-- Activity Timeline -->
      <div class="glass-panel p-5">
        <h3 class="text-sm font-semibold mb-4">История изменений</h3>
        <div class="space-y-4 custom-scroll max-h-64 overflow-y-auto">
          <div class="timeline-item pb-4">
            <div class="text-sm font-medium">Документ создан</div>
            <div class="text-xs text-muted">15.01.2024, 09:00</div>
            <div class="text-xs text-muted mt-1">Система автоматически создала eTTН</div>
          </div>
          <div class="timeline-item pb-4">
            <div class="text-sm font-medium">Подпись отправителя</div>
            <div class="text-xs text-muted">15.01.2024, 09:30</div>
            <div class="text-xs text-emerald-500 mt-1">ЭЦП подтверждена</div>
          </div>
          <div class="timeline-item pb-4">
            <div class="text-sm font-medium">Подпись перевозчика</div>
            <div class="text-xs text-muted">15.01.2024, 10:15</div>
            <div class="text-xs text-emerald-500 mt-1">ЭЦП подтверждена</div>
          </div>
          <div class="timeline-item">
            <div class="text-sm font-medium">Ожидание получателя</div>
            <div class="text-xs text-muted">В процессе</div>
            <div class="text-xs text-amber-500 mt-1">Отправлено уведомление</div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Create Document Modal -->
  <div id="createModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden items-center justify-center">
    <div class="glass-panel w-full max-w-2xl mx-4 p-6 max-h-[90vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold">Создать новую eTTН</h2>
        <button onclick="closeCreateModal()" class="icon-btn">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <form class="space-y-5">
        <!-- Route -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-muted mb-2 block">Пункт отправления</label>
            <input type="text" placeholder="Город, адрес" class="input-field">
          </div>
          <div>
            <label class="text-sm text-muted mb-2 block">Пункт назначения</label>
            <input type="text" placeholder="Город, адрес" class="input-field">
          </div>
        </div>

        <!-- Parties -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-muted mb-2 block">Грузоотправитель</label>
            <select class="input-field">
              <option>Выберите компанию...</option>
              <option>ООО "ТрансЛогистик"</option>
              <option>ООО "КаргоМастер"</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-muted mb-2 block">Грузополучатель</label>
            <select class="input-field">
              <option>Выберите компанию...</option>
              <option>ИП Петров А.С.</option>
              <option>ООО "Северная Звезда"</option>
            </select>
          </div>
        </div>

        <!-- Cargo -->
        <div>
          <label class="text-sm text-muted mb-2 block">Наименование груза</label>
          <input type="text" placeholder="Описание груза" class="input-field">
        </div>

        <div class="grid grid-cols-3 gap-4">
          <div>
            <label class="text-sm text-muted mb-2 block">Вес (кг)</label>
            <input type="number" placeholder="0" class="input-field">
          </div>
          <div>
            <label class="text-sm text-muted mb-2 block">Объём (м³)</label>
            <input type="number" placeholder="0" class="input-field">
          </div>
          <div>
            <label class="text-sm text-muted mb-2 block">Стоимость (₽)</label>
            <input type="number" placeholder="0" class="input-field">
          </div>
        </div>

        <!-- Vehicle -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-muted mb-2 block">Транспортное средство</label>
            <select class="input-field">
              <option>Выберите ТС...</option>
              <option>TR-001 • MAN TGX</option>
              <option>TR-002 • SCANIA R-SERIES</option>
              <option>TR-003 • VOLVO FH</option>
            </select>
          </div>
          <div>
            <label class="text-sm text-muted mb-2 block">Водитель</label>
            <select class="input-field">
              <option>Выберите водителя...</option>
              <option>Иванов Пётр</option>
              <option>Смирнов Алексей</option>
              <option>Козлов Дмитрий</option>
            </select>
          </div>
        </div>

        <!-- Additional -->
        <div>
          <label class="text-sm text-muted mb-2 block">Особые условия</label>
          <textarea placeholder="Дополнительная информация о грузе, требования к перевозке..." rows="3" class="input-field resize-none"></textarea>
        </div>

        <!-- Actions -->
        <div class="flex gap-3 pt-4">
          <button type="submit" class="flex-1 btn-primary py-3 flex items-center justify-center gap-2">
            <i class="fa-solid fa-file-signature"></i>
            Создать и подписать
          </button>
          <button type="button" class="flex-1 glass-card py-3">
            Сохранить черновик
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Theme management
    const savedTheme = localStorage.getItem('routoxTheme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);

    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('routoxTheme', next);
    }

    // Sample documents data
    const documents = [
      { id: 'eTTН-2024-001254', type: 'ttn', route: 'Москва → СПб', date: '15.01.2024', status: 'signed', weight: '5,240 кг', cost: '₽ 125,000' },
      { id: 'eTTН-2024-001253', type: 'ttn', route: 'Казань → Москва', date: '14.01.2024', status: 'pending', weight: '3,800 кг', cost: '₽ 98,000' },
      { id: 'eTTН-2024-001252', type: 'ttn', route: 'Н.Новгород → Казань', date: '14.01.2024', status: 'signed', weight: '7,100 кг', cost: '₽ 156,000' },
      { id: 'INV-2024-000089', type: 'invoice', route: 'ООО "КаргоМастер"', date: '13.01.2024', status: 'signed', weight: '-', cost: '₽ 450,000' },
      { id: 'eTTН-2024-001251', type: 'ttn', route: 'Екб → Москва', date: '13.01.2024', status: 'draft', weight: '4,500 кг', cost: '₽ 210,000' },
      { id: 'eTTН-2024-001250', type: 'ttn', route: 'Самара → СПб', date: '12.01.2024', status: 'rejected', weight: '2,900 кг', cost: '₽ 78,000' },
      { id: 'CNT-2024-000025', type: 'contract', route: 'ИП Сидоров', date: '12.01.2024', status: 'pending', weight: '-', cost: '₽ 1,200,000' },
      { id: 'eTTН-2024-001249', type: 'ttn', route: 'Воронеж → Ростов', date: '11.01.2024', status: 'signed', weight: '6,200 кг', cost: '₽ 89,000' },
    ];

    const statusMap = {
      signed: { label: 'Подписан', class: 'doc-signed' },
      pending: { label: 'Ожидает', class: 'doc-pending' },
      draft: { label: 'Черновик', class: 'doc-draft' },
      rejected: { label: 'Отклонён', class: 'doc-rejected' }
    };

    const typeIcons = {
      ttn: 'fa-file-lines text-blue-500',
      invoice: 'fa-file-invoice text-emerald-500',
      contract: 'fa-file-contract text-purple-500'
    };

    // Render documents table
    function renderDocuments(filter = 'all') {
      const tbody = document.getElementById('documentsTable');
      const filteredDocs = filter === 'all' 
        ? documents 
        : documents.filter(d => {
            if (filter === 'ttn') return d.type === 'ttn';
            if (filter === 'invoices') return d.type === 'invoice';
            if (filter === 'contracts') return d.type === 'contract';
            return true;
          });

      tbody.innerHTML = filteredDocs.map(doc => `
        <tr class="doc-row" onclick="selectDocument('${doc.id}')" style="border-bottom: 1px solid var(--border-color);">
          <td class="p-4">
            <input type="checkbox" class="rounded" style="background: var(--bg-card); border-color: var(--border-color);" onclick="event.stopPropagation()">
          </td>
          <td class="p-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl flex items-center justify-center" style="background: var(--bg-card); border: 1px solid var(--border-color);">
                <i class="fa-solid ${typeIcons[doc.type]}"></i>
              </div>
              <div>
                <div class="font-medium">${doc.id}</div>
                <div class="text-xs text-muted">${doc.weight}</div>
              </div>
            </div>
          </td>
          <td class="p-4 text-sm">
            ${doc.type === 'ttn' ? 'eTTН' : doc.type === 'invoice' ? 'Счёт' : 'Договор'}
          </td>
          <td class="p-4 text-sm">${doc.route}</td>
          <td class="p-4 text-sm text-muted">${doc.date}</td>
          <td class="p-4">
            <span class="doc-status ${statusMap[doc.status].class}">${statusMap[doc.status].label}</span>
          </td>
          <td class="p-4 text-right">
            <div class="flex items-center justify-end gap-1">
              <button class="w-8 h-8 rounded-lg hover:bg-blue-50 flex items-center justify-center" title="Просмотр">
                <i class="fa-solid fa-eye text-muted text-sm"></i>
              </button>
              <button class="w-8 h-8 rounded-lg hover:bg-blue-50 flex items-center justify-center" title="Скачать">
                <i class="fa-solid fa-download text-muted text-sm"></i>
              </button>
              <button class="w-8 h-8 rounded-lg hover:bg-blue-50 flex items-center justify-center" title="Ещё">
                <i class="fa-solid fa-ellipsis-vertical text-muted text-sm"></i>
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Tab switching
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderDocuments(btn.dataset.tab);
      });
    });

    // Select document
    function selectDocument(id) {
      const doc = documents.find(d => d.id === id);
      if (doc) {
        document.getElementById('docTitle').textContent = doc.id;
      }
    }

    // Modal controls
    function showCreateModal() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm';
      modal.id = 'createTTNModal';
      modal.innerHTML = `
        <div class="glass-panel p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center">
                <i class="fa-solid fa-file-lines text-white text-lg"></i>
              </div>
              <div>
                <h3 class="text-xl font-bold">Создание еТТН</h3>
                <p class="text-sm text-muted">Электронная товарно-транспортная накладная</p>
              </div>
            </div>
            <button onclick="document.getElementById('createTTNModal').remove()" class="icon-btn">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
          
          <form id="createTTNForm" class="space-y-5">
            <!-- Sender Section -->
            <div class="p-4 rounded-xl bg-white/5 border border-white/10">
              <h4 class="font-semibold mb-4 flex items-center gap-2">
                <i class="fa-solid fa-building text-blue-500"></i>
                Грузоотправитель
              </h4>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Компания</label>
                  <input type="text" placeholder="ООО ТрансЛогистик" class="input-field w-full" required>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">ИНН</label>
                  <input type="text" placeholder="7707123456" class="input-field w-full">
                </div>
                <div class="col-span-2">
                  <label class="block text-sm font-medium mb-2">Адрес отправления</label>
                  <input type="text" placeholder="г. Москва, ул. Складская, д. 1" class="input-field w-full" required>
                </div>
              </div>
            </div>

            <!-- Receiver Section -->
            <div class="p-4 rounded-xl bg-white/5 border border-white/10">
              <h4 class="font-semibold mb-4 flex items-center gap-2">
                <i class="fa-solid fa-location-dot text-emerald-500"></i>
                Грузополучатель
              </h4>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Компания/ФИО</label>
                  <input type="text" placeholder="ИП Петров А.С." class="input-field w-full" required>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Телефон</label>
                  <input type="tel" placeholder="+7 (900) 123-45-67" class="input-field w-full">
                </div>
                <div class="col-span-2">
                  <label class="block text-sm font-medium mb-2">Адрес доставки</label>
                  <input type="text" placeholder="г. Санкт-Петербург, пр. Невский, д. 100" class="input-field w-full" required>
                </div>
              </div>
            </div>

            <!-- Cargo Section -->
            <div class="p-4 rounded-xl bg-white/5 border border-white/10">
              <h4 class="font-semibold mb-4 flex items-center gap-2">
                <i class="fa-solid fa-box text-amber-500"></i>
                Сведения о грузе
              </h4>
              <div class="grid grid-cols-3 gap-4">
                <div class="col-span-2">
                  <label class="block text-sm font-medium mb-2">Наименование груза</label>
                  <input type="text" placeholder="Строительные материалы" class="input-field w-full" required>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Кол-во мест</label>
                  <input type="number" placeholder="24" class="input-field w-full">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Вес брутто (кг)</label>
                  <input type="number" placeholder="5240" class="input-field w-full" required>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Объём (м³)</label>
                  <input type="number" placeholder="28" class="input-field w-full">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Объявленная стоимость</label>
                  <input type="number" placeholder="125000" class="input-field w-full">
                </div>
              </div>
            </div>

            <!-- Transport Section -->
            <div class="p-4 rounded-xl bg-white/5 border border-white/10">
              <h4 class="font-semibold mb-4 flex items-center gap-2">
                <i class="fa-solid fa-truck text-purple-500"></i>
                Транспорт и водитель
              </h4>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Транспортное средство</label>
                  <select class="input-field w-full">
                    <option>Volvo FH16 #1 (А123ВС77)</option>
                    <option>MAN TGX #2 (В456ОР77)</option>
                    <option>Scania R500 #3 (Е789КМ77)</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Водитель</label>
                  <select class="input-field w-full">
                    <option>Иванов Алексей</option>
                    <option>Петров Сергей</option>
                    <option>Сидоров Михаил</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="flex gap-3 pt-4">
              <button type="button" onclick="document.getElementById('createTTNModal').remove()" class="btn-secondary flex-1 py-3">
                Отмена
              </button>
              <button type="submit" class="btn-primary flex-1 py-3">
                <i class="fa-solid fa-check mr-2"></i>
                Создать еТТН
              </button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);
      modal.addEventListener('click', e => { if (e.target === modal) modal.remove(); });
      
      document.getElementById('createTTNForm').addEventListener('submit', (e) => {
        e.preventDefault();
        document.getElementById('createTTNModal').remove();
        alert('еТТН успешно создана! Номер: eTTН-2026-' + Math.floor(Math.random() * 10000).toString().padStart(6, '0'));
      });
    }

    function closeCreateModal() {
      document.getElementById('createTTNModal')?.remove();
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeCreateModal();
    });

    // Initial render
    renderDocuments();

    // Import/Export functions
    function importDocuments() {
      document.getElementById('importInput').click();
    }

    function handleImport(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          alert(`Импортировано ${data.length || 1} документов`);
          // In real app, send to API
        } catch {
          alert('Ошибка при импорте файла. Проверьте формат.');
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    function showExportModal() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm';
      modal.innerHTML = `
        <div class="glass-panel p-6 w-full max-w-md">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold">Экспорт документов</h2>
            <button onclick="this.closest('.fixed').remove()" class="icon-btn"><i class="fa-solid fa-xmark"></i></button>
          </div>
          
          <div class="space-y-4">
            <div>
              <label class="text-sm text-muted mb-2 block">Формат экспорта</label>
              <div class="grid grid-cols-3 gap-2">
                <button class="export-format-btn glass-card p-4 text-center border-2 border-transparent hover:border-blue-500" onclick="selectExportFormat(this, 'pdf')">
                  <i class="fa-solid fa-file-pdf text-2xl text-red-500 mb-2"></i>
                  <div class="text-sm font-medium">PDF</div>
                </button>
                <button class="export-format-btn glass-card p-4 text-center border-2 border-blue-500" onclick="selectExportFormat(this, 'xlsx')">
                  <i class="fa-solid fa-file-excel text-2xl text-emerald-500 mb-2"></i>
                  <div class="text-sm font-medium">Excel</div>
                </button>
                <button class="export-format-btn glass-card p-4 text-center border-2 border-transparent hover:border-blue-500" onclick="selectExportFormat(this, 'csv')">
                  <i class="fa-solid fa-file-csv text-2xl text-blue-500 mb-2"></i>
                  <div class="text-sm font-medium">CSV</div>
                </button>
              </div>
            </div>
            
            <div>
              <label class="text-sm text-muted mb-2 block">Период</label>
              <select class="input-field w-full">
                <option>Текущий месяц</option>
                <option>Последние 3 месяца</option>
                <option>Текущий год</option>
                <option>Произвольный период</option>
              </select>
            </div>
            
            <div>
              <label class="text-sm text-muted mb-2 block">Типы документов</label>
              <div class="space-y-2">
                <label class="flex items-center gap-2">
                  <input type="checkbox" checked class="rounded">
                  <span class="text-sm">eTTН</span>
                </label>
                <label class="flex items-center gap-2">
                  <input type="checkbox" checked class="rounded">
                  <span class="text-sm">Счета</span>
                </label>
                <label class="flex items-center gap-2">
                  <input type="checkbox" checked class="rounded">
                  <span class="text-sm">Договоры</span>
                </label>
              </div>
            </div>
          </div>
          
          <div class="flex gap-3 mt-6">
            <button onclick="this.closest('.fixed').remove()" class="flex-1 glass-card py-3">Отмена</button>
            <button onclick="exportDocuments()" class="flex-1 btn-primary py-3 flex items-center justify-center gap-2">
              <i class="fa-solid fa-download"></i>
              Скачать
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    let selectedExportFormat = 'xlsx';

    function selectExportFormat(btn, format) {
      document.querySelectorAll('.export-format-btn').forEach(b => b.classList.remove('border-blue-500'));
      btn.classList.add('border-blue-500');
      selectedExportFormat = format;
    }

    function exportDocuments() {
      // Create fake download
      const data = documents.map(d => ({
        'Номер': d.id,
        'Тип': d.type === 'ttn' ? 'eTTН' : d.type === 'invoice' ? 'Счёт' : 'Договор',
        'Маршрут': d.route,
        'Дата': d.date,
        'Статус': statusMap[d.status].label,
        'Вес': d.weight,
        'Стоимость': d.cost
      }));

      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `documents_export_${new Date().toISOString().split('T')[0]}.${selectedExportFormat === 'xlsx' ? 'json' : selectedExportFormat}`;
      a.click();
      URL.revokeObjectURL(url);
      
      document.querySelector('.fixed.z-50')?.remove();
      alert('Документы успешно экспортированы!');
    }

  </script>
  <script src="./assets/js/routa-core.js"></script>
  <script src="./assets/js/routox-unified.js"></script>
  <script src="./assets/js/routox-ai.js"></script>
  <script>
    // ========== ROUTA PLATFORM INITIALIZATION ==========
    (async function() {
      Routa.Theme.load();
      const user = await Routa.App.init({
        requireAuth: true,
        currentPage: 'documents.html'
      });
      if (!user) return;
      console.log('Documents page initialized for:', user.role, user.edition);
    })();
    
  </script>
</body>
</html>
