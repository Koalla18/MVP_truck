<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoutoX — Панель водителя</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script src="https://kit.fontawesome.com/a2e0e9e5a9.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="./assets/css/routox-unified.css">
  <style>
    :root {
      --card-bg: #ffffff;
      --page-bg: #f0f4f8;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border: rgba(0,0,0,0.06);
    }
    [data-theme="dark"] {
      --card-bg: #1e293b;
      --page-bg: #0f172a;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --border: rgba(255,255,255,0.1);
    }
    
    body { 
      background: var(--page-bg); 
      color: var(--text-primary);
      min-height: 100vh;
    }
    
    /* Light Glass Card */
    .glass-card {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.06);
      border: 1px solid var(--border);
    }
    
    /* Info Badge */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }
    .badge-active { background: rgba(16, 185, 129, 0.12); color: #10b981; }
    .badge-route { background: rgba(59, 130, 246, 0.12); color: #3b82f6; }
    .badge-live { background: #ef4444; color: white; }
    
    /* Cargo Grid - 3D Truck View */
    .cargo-container {
      background: linear-gradient(145deg, #f8fafc 0%, #e2e8f0 100%);
      border-radius: 24px;
      padding: 24px;
      position: relative;
    }
    [data-theme="dark"] .cargo-container {
      background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
    }
    
    .cargo-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 6px;
      padding: 16px;
      background: rgba(59, 130, 246, 0.08);
      border-radius: 16px;
      border: 2px dashed rgba(59, 130, 246, 0.3);
    }
    
    .cargo-cell {
      aspect-ratio: 1;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 600;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    .cargo-cell:hover { transform: scale(1.08); }
    
    .cargo-cell.filled {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    .cargo-cell.filled.heavy {
      background: linear-gradient(135deg, #1d4ed8, #1e40af);
    }
    .cargo-cell.empty {
      background: rgba(255,255,255,0.6);
      border: 2px dashed rgba(0,0,0,0.15);
      color: var(--text-secondary);
    }
    [data-theme="dark"] .cargo-cell.empty {
      background: rgba(255,255,255,0.05);
      border-color: rgba(255,255,255,0.1);
    }
    
    .cargo-cell .weight {
      font-size: 8px;
      opacity: 0.8;
      margin-top: 2px;
    }
    
    /* Camera with Live */
    .camera-box {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      background: #000;
    }
    .camera-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .camera-live-badge {
      position: absolute;
      bottom: 12px;
      left: 12px;
      background: #ef4444;
      color: white;
      padding: 5px 12px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .camera-live-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: pulse-live 1.5s infinite;
    }
    @keyframes pulse-live {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(0.8); }
    }
    
    /* Mechanical Bars */
    .mech-bars {
      display: flex;
      gap: 4px;
      align-items: flex-end;
      height: 50px;
    }
    .mech-bar {
      width: 32px;
      border-radius: 4px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 4px;
      font-size: 9px;
      font-weight: 700;
      color: white;
      transition: all 0.3s;
    }
    .mech-bar.good { background: linear-gradient(to top, #3b82f6, #60a5fa); }
    .mech-bar.warning { background: linear-gradient(to top, #f59e0b, #fbbf24); }
    
    /* Speed Bars */
    .speed-bars {
      display: flex;
      gap: 3px;
      align-items: flex-end;
      height: 32px;
    }
    .speed-bar {
      width: 14px;
      border-radius: 3px;
      transition: all 0.3s;
    }
    
    /* Progress Ring */
    .progress-ring-container {
      position: relative;
      width: 90px;
      height: 90px;
    }
    .progress-ring-container svg { transform: rotate(-90deg); }
    .progress-ring-bg { fill: none; stroke: #e2e8f0; stroke-width: 8; }
    [data-theme="dark"] .progress-ring-bg { stroke: #334155; }
    .progress-ring-fill { fill: none; stroke: #3b82f6; stroke-width: 8; stroke-linecap: round; }
    .progress-ring-text {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    /* Fuel Gauge */
    .fuel-gauge {
      width: 50px;
      height: 70px;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      position: relative;
      overflow: hidden;
    }
    [data-theme="dark"] .fuel-gauge { border-color: #334155; }
    .fuel-gauge-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, #3b82f6, #60a5fa);
      transition: height 0.5s;
    }
    .fuel-gauge-value {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    
    /* Map */
    #driverMap {
      border-radius: 16px;
      height: 100%;
      min-height: 180px;
    }
    .leaflet-control-zoom { display: none; }
    
    /* Action Buttons */
    .action-circle {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 4px 14px rgba(59, 130, 246, 0.35);
      transition: all 0.2s;
    }
    .action-circle:hover { transform: scale(1.1); }
    
    /* Quick Action Grid */
    .quick-action {
      padding: 14px;
      border-radius: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
    }
    .quick-action:hover { transform: translateY(-2px); }
    .quick-action i { font-size: 20px; }
    .quick-action.blue { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
    .quick-action.amber { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
    .quick-action.purple { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
    .quick-action.emerald { background: rgba(16, 185, 129, 0.1); color: #10b981; }
    
    /* SOS Button */
    .btn-sos {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      padding: 14px 28px;
      border-radius: 14px;
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      animation: sos-pulse 2s infinite;
    }
    @keyframes sos-pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5); }
      50% { box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); }
    }
    
    /* Section Title */
    .section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }
    
    /* Responsive */
    @media (max-width: 1024px) {
      .main-grid { grid-template-columns: 1fr !important; }
      .sidebar-left, .sidebar-right { display: none; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="glass-card mx-4 mt-4 px-5 py-3 flex items-center justify-between sticky top-4 z-50">
    <div class="flex items-center gap-4">
      <a href="./fleet.html" class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-emerald-500 flex items-center justify-center text-white font-bold shadow-lg">
          <i class="fa-solid fa-truck"></i>
        </div>
        <div class="hidden sm:block">
          <div class="font-semibold text-sm">RoutoX</div>
          <div class="text-xs text-[var(--text-secondary)]">Панель водителя</div>
        </div>
      </a>
      
      <div class="hidden lg:flex items-center gap-6 ml-6">
        <div class="flex items-center gap-2 text-sm">
          <span class="text-[var(--text-secondary)]">Daily active:</span>
          <span class="font-bold">8h 40min</span>
          <span class="text-[var(--text-secondary)]">/ 10h</span>
        </div>
      </div>
    </div>
    
    <div class="flex items-center gap-3">
      <span class="badge badge-active">
        <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
        Active
      </span>
      
      <a href="./notifications.html" class="icon-btn relative" title="Уведомления">
        <i class="fa-solid fa-bell"></i>
        <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[10px] text-white flex items-center justify-center font-bold">2</span>
      </a>
      
      <button onclick="openSettingsModal()" class="icon-btn" title="Настройки">
        <i class="fa-solid fa-gear"></i>
      </button>
      
      <div class="theme-toggle-track" onclick="toggleTheme()" title="Сменить тему">
        <div class="theme-toggle-thumb"></div>
      </div>
      
      <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-10 h-10 rounded-full border-2 border-white shadow-md object-cover" alt="Driver">
    </div>
  </header>

  <!-- Main Content -->
  <main class="p-4 main-grid grid grid-cols-12 gap-4" style="min-height: calc(100vh - 100px);">
    
    <!-- Left Sidebar -->
    <aside class="sidebar-left col-span-3 space-y-4">
      <!-- Vehicle Info Card -->
      <div class="glass-card p-5">
        <div class="flex items-center justify-between mb-4">
          <span class="text-xs text-[var(--text-secondary)]">Vehicle</span>
          <span class="badge badge-active">Active</span>
        </div>
        
        <h2 class="text-2xl font-bold mb-4">MAN TGX</h2>
        
        <div class="space-y-4">
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-[var(--text-secondary)]">Burden</span>
              <span class="font-semibold">5,000 / 10,000 kg</span>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-[var(--text-secondary)]">Used volume</span>
              <span class="font-semibold">23 / 45 m³</span>
            </div>
          </div>
          
          <div>
            <div class="flex justify-between text-sm mb-1">
              <span class="text-[var(--text-secondary)]">Used capacity</span>
              <span class="font-semibold">50%</span>
            </div>
            <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
              <div class="h-full bg-blue-500 rounded-full" style="width: 50%;"></div>
            </div>
          </div>
        </div>
        
        <!-- Driver -->
        <div class="flex items-center gap-3 mt-5 pt-4 border-t border-[var(--border)]">
          <img src="https://randomuser.me/api/portraits/men/32.jpg" class="w-10 h-10 rounded-full" alt="Driver">
          <div class="flex-1 min-w-0">
            <div class="text-xs text-[var(--text-secondary)]">Driver</div>
            <div class="font-medium truncate">Иван Петров</div>
          </div>
          <button class="action-circle w-9 h-9">
            <i class="fa-solid fa-phone text-sm"></i>
          </button>
        </div>
        
        <!-- Fuel & Temp -->
        <div class="grid grid-cols-2 gap-4 mt-5 pt-4 border-t border-[var(--border)]">
          <div class="text-center">
            <div class="text-xs text-[var(--text-secondary)] mb-2">Fuel</div>
            <div class="fuel-gauge mx-auto">
              <div class="fuel-gauge-fill" style="height: 60%;"></div>
              <div class="fuel-gauge-value">60%</div>
            </div>
          </div>
          <div class="text-center">
            <div class="text-xs text-[var(--text-secondary)] mb-2">Temperature</div>
            <div class="text-3xl font-light mt-3">24°<span class="text-lg">c</span></div>
          </div>
        </div>
      </div>
      
      <!-- Map Card -->
      <div class="glass-card p-4">
        <div class="flex items-center gap-2 mb-3">
          <button class="px-4 py-2 rounded-lg bg-blue-500 text-white text-sm font-medium">
            <i class="fa-solid fa-map mr-2"></i>Map
          </button>
          <button class="px-4 py-2 rounded-lg text-[var(--text-secondary)] text-sm font-medium hover:bg-gray-100 dark:hover:bg-gray-800">
            <i class="fa-solid fa-triangle-exclamation mr-1"></i>
            Alerts
            <span class="ml-1 w-5 h-5 inline-flex items-center justify-center rounded-full bg-amber-500 text-white text-xs">2</span>
          </button>
        </div>
        
        <div id="driverMap" style="height: 180px;"></div>
        
        <div class="mt-3">
          <span class="badge badge-route">
            <i class="fa-solid fa-circle text-[6px]"></i>
            In route
          </span>
        </div>
      </div>
    </aside>

    <!-- Center - Main View -->
    <section class="col-span-6 space-y-4">
      <!-- Action Bar -->
      <div class="flex items-center justify-center gap-3">
        <button class="px-5 py-2.5 rounded-xl bg-blue-500 text-white text-sm font-medium flex items-center gap-2 hover:bg-blue-600 transition">
          <i class="fa-solid fa-plus"></i>
          Add cargo
        </button>
        <button class="px-3 py-2.5 rounded-xl bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 text-sm border border-gray-200 dark:border-gray-700 hover:border-blue-400 transition">
          <i class="fa-solid fa-qrcode"></i>
        </button>
        <button class="px-3 py-2.5 rounded-xl bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 text-sm border border-gray-200 dark:border-gray-700 hover:border-blue-400 transition">
          <i class="fa-solid fa-file-lines"></i>
        </button>
        <button class="px-3 py-2.5 rounded-xl bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-200 text-sm border border-gray-200 dark:border-gray-700 hover:border-blue-400 transition">
          <i class="fa-solid fa-pen"></i>
        </button>
      </div>

      <!-- Cargo Visualization -->
      <div class="cargo-container">
        <div class="cargo-grid">
          <!-- Row 1 -->
          <div class="cargo-cell empty"><i class="fa-solid fa-plus text-xs"></i></div>
          <div class="cargo-cell filled"><span>BX-05</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell filled"><span>BX-06</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell empty"><i class="fa-solid fa-plus text-xs"></i></div>
          <div class="cargo-cell filled"><span>BX-08</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell empty"><i class="fa-solid fa-plus text-xs"></i></div>
          
          <!-- Row 2 -->
          <div class="cargo-cell filled"><span>BX-03</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell filled heavy"><span>BX-04</span><span class="weight">1550 kg</span></div>
          <div class="cargo-cell filled"><span>BX-07</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell empty"><i class="fa-solid fa-plus text-xs"></i></div>
          <div class="cargo-cell filled"><span>BX-11</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell filled"><span>BX-12</span><span class="weight">700 kg</span></div>
          
          <!-- Row 3 -->
          <div class="cargo-cell filled heavy"><span>BX-01</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell filled heavy"><span>BX-02</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell filled"><span>BX-09</span><span class="weight">800 kg</span></div>
          <div class="cargo-cell filled"><span>BX-10</span><span class="weight">400 kg</span></div>
          <div class="cargo-cell filled"><span>BX-13</span><span class="weight">700 kg</span></div>
          <div class="cargo-cell filled"><span>BX-14</span><span class="weight">700 kg</span></div>
        </div>
        
        <!-- Truck Image -->
        <div class="flex justify-center mt-4">
          <img src="./assets/images/trucks/truck-side.png" alt="Truck" class="h-28 object-contain opacity-70" 
               onerror="this.src='https://images.unsplash.com/photo-1601584115197-04ecc0da31d7?w=400&h=120&fit=crop&auto=format'">
        </div>
      </div>

      <!-- Stats Row -->
      <div class="grid grid-cols-3 gap-4">
        <!-- Daily Active Time -->
        <div class="glass-card p-4">
          <div class="section-title">Daily active time</div>
          <div class="flex items-center justify-between mb-3">
            <span class="text-xl font-bold">8h 40min</span>
            <span class="text-sm text-[var(--text-secondary)]">/ 10h max</span>
          </div>
          <div class="h-2.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-blue-500 to-emerald-500 rounded-full" style="width: 86%;"></div>
          </div>
          <div class="flex items-center gap-2 mt-3">
            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            <span class="text-xs text-[var(--text-secondary)]">Normal day</span>
          </div>
        </div>
        
        <!-- Average Speed -->
        <div class="glass-card p-4">
          <div class="section-title">Average speed</div>
          <div class="text-sm text-[var(--text-secondary)] mb-2">60-80 km/h</div>
          <div class="speed-bars">
            <div class="speed-bar" style="height: 60%; background: #fcd34d;"></div>
            <div class="speed-bar" style="height: 80%; background: #fbbf24;"></div>
            <div class="speed-bar" style="height: 100%; background: #f59e0b;"></div>
            <div class="speed-bar" style="height: 85%; background: #10b981;"></div>
            <div class="speed-bar" style="height: 70%; background: #10b981;"></div>
            <div class="speed-bar" style="height: 55%; background: #34d399;"></div>
          </div>
          <div class="flex items-center gap-2 mt-3">
            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            <span class="text-xs text-[var(--text-secondary)]">Optimal</span>
          </div>
        </div>
        
        <!-- Mechanical Condition -->
        <div class="glass-card p-4">
          <div class="section-title">Mechanical condition</div>
          <div class="flex items-center gap-4">
            <div class="mech-bars">
              <div class="mech-bar good" style="height: 45px;">90%</div>
              <div class="mech-bar good" style="height: 45px;">90%</div>
              <div class="mech-bar warning" style="height: 40px;">80%</div>
              <div class="mech-bar good" style="height: 44px;">89%</div>
              <div class="mech-bar good" style="height: 46px;">92%</div>
            </div>
            <div class="text-right">
              <div class="text-2xl font-bold">91%</div>
              <div class="flex items-center gap-1 justify-end">
                <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
                <span class="text-xs text-[var(--text-secondary)]">Optimal</span>
              </div>
            </div>
          </div>
          <div class="grid grid-cols-5 gap-1 text-[9px] text-[var(--text-secondary)] text-center mt-2">
            <span>Engine</span>
            <span>Brakes</span>
            <span>Tires</span>
            <span>Oil</span>
            <span>Susp.</span>
          </div>
        </div>
      </div>
      
      <!-- Camera Feed -->
      <div class="glass-card p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold">Camera</h3>
          <span class="text-sm text-[var(--text-secondary)]">TR-001</span>
        </div>
        <div class="camera-box" style="height: 200px;">
          <img src="https://images.unsplash.com/photo-1449965408869-ebd3fee52a27?w=800&h=350&fit=crop&auto=format" alt="Camera feed">
          <div class="camera-live-badge">Live</div>
          <div class="absolute bottom-3 right-3 text-white text-xs bg-black/50 px-2 py-1 rounded">04:39:16</div>
          <button class="absolute top-3 right-3 w-9 h-9 bg-white/20 backdrop-blur rounded-lg flex items-center justify-center text-white hover:bg-white/30 transition">
            <i class="fa-solid fa-expand"></i>
          </button>
        </div>
      </div>
    </section>

    <!-- Right Sidebar -->
    <aside class="sidebar-right col-span-3 space-y-4">
      <!-- Current Trip -->
      <div class="glass-card p-5">
        <h3 class="font-semibold mb-4">Текущий рейс</h3>
        
        <div class="space-y-3">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-emerald-500/15 flex items-center justify-center">
              <i class="fa-solid fa-location-dot text-emerald-500"></i>
            </div>
            <div>
              <div class="text-xs text-[var(--text-secondary)]">Откуда</div>
              <div class="font-medium">Москва, Склад-1</div>
            </div>
          </div>
          
          <div class="border-l-2 border-dashed border-gray-200 dark:border-gray-700 h-5 ml-5"></div>
          
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-blue-500/15 flex items-center justify-center">
              <i class="fa-solid fa-flag-checkered text-blue-500"></i>
            </div>
            <div>
              <div class="text-xs text-[var(--text-secondary)]">Куда</div>
              <div class="font-medium">СПб, ООО "Нева"</div>
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-3 mt-5 pt-4 border-t border-[var(--border)]">
          <div class="text-center">
            <div class="text-2xl font-bold text-blue-500">224</div>
            <div class="text-xs text-[var(--text-secondary)]">км осталось</div>
          </div>
          <div class="text-center">
            <div class="text-2xl font-bold text-emerald-500">~14:30</div>
            <div class="text-xs text-[var(--text-secondary)]">ETA</div>
          </div>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div class="glass-card p-5">
        <h3 class="font-semibold mb-4">Быстрые действия</h3>
        <div class="grid grid-cols-2 gap-3">
          <button class="quick-action blue">
            <i class="fa-solid fa-gas-pump"></i>
            <span>Заправка</span>
          </button>
          <button class="quick-action amber">
            <i class="fa-solid fa-bed"></i>
            <span>Отдых</span>
          </button>
          <button class="quick-action purple">
            <i class="fa-solid fa-headset"></i>
            <span>Диспетчер</span>
          </button>
          <button class="quick-action emerald">
            <i class="fa-solid fa-file-lines"></i>
            <span>Документы</span>
          </button>
        </div>
        
        <button class="btn-sos w-full mt-4">
          <i class="fa-solid fa-phone-volume"></i>
          SOS
        </button>
      </div>
      
      <!-- RTO Warning -->
      <div class="glass-card p-4 border-l-4 border-amber-500">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-amber-500/15 flex items-center justify-center">
            <i class="fa-solid fa-clock text-amber-500"></i>
          </div>
          <div>
            <div class="font-semibold text-amber-600 dark:text-amber-400">Режим РТО</div>
            <div class="text-sm">До перерыва: <span class="font-bold">1ч 20м</span></div>
          </div>
        </div>
      </div>
      
      <!-- Trip Progress -->
      <div class="glass-card p-4">
        <div class="flex items-center justify-between mb-3">
          <span class="section-title mb-0">Trip Progress</span>
          <span class="text-sm font-bold text-blue-500">68%</span>
        </div>
        <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
          <div class="h-full bg-gradient-to-r from-blue-500 to-emerald-500 rounded-full" style="width: 68%;"></div>
        </div>
        <div class="flex justify-between text-xs text-[var(--text-secondary)] mt-2">
          <span>Москва</span>
          <span>СПб</span>
        </div>
      </div>
    </aside>
  </main>

  <script>
    // Theme initialization
    const savedTheme = localStorage.getItem('routox_theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('routox_theme', next);
      
      // Update toggle visual
      const toggle = document.querySelector('.theme-toggle-track');
      if (toggle) {
        toggle.classList.toggle('light', next === 'light');
      }
      
      // Update map tiles
      if (window.driverMap && window.tileLayer) {
        const tileUrl = next === 'dark' 
          ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
          : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
        window.tileLayer.setUrl(tileUrl);
      }
    }
    
    // Initialize map
    document.addEventListener('DOMContentLoaded', () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      
      window.driverMap = L.map('driverMap', {
        zoomControl: false,
        attributionControl: false
      }).setView([56.8584, 35.9176], 6);
      
      window.tileLayer = L.tileLayer(
        isDark 
          ? 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'
          : 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
        { attribution: '' }
      ).addTo(window.driverMap);
      
      // Route line
      const routeCoords = [
        [55.7558, 37.6173], // Moscow
        [56.8584, 35.9176], // Current position
        [59.9343, 30.3351]  // SPb
      ];
      
      L.polyline(routeCoords, {
        color: '#3b82f6',
        weight: 4,
        dashArray: '10, 10',
        opacity: 0.8
      }).addTo(window.driverMap);
      
      // Current position marker
      L.marker([56.8584, 35.9176], {
        icon: L.divIcon({
          className: '',
          html: `<div style="width:18px;height:18px;background:#3b82f6;border-radius:50%;border:3px solid white;box-shadow:0 2px 8px rgba(59,130,246,0.5);"></div>`,
          iconSize: [18, 18],
          iconAnchor: [9, 9]
        })
      }).addTo(window.driverMap);
      
      // Start marker
      L.marker([55.7558, 37.6173], {
        icon: L.divIcon({
          className: '',
          html: `<div style="width:12px;height:12px;background:#10b981;border-radius:50%;border:2px solid white;"></div>`,
          iconSize: [12, 12],
          iconAnchor: [6, 6]
        })
      }).addTo(window.driverMap);
      
      // End marker
      L.marker([59.9343, 30.3351], {
        icon: L.divIcon({
          className: '',
          html: `<div style="width:12px;height:12px;background:#f59e0b;border-radius:50%;border:2px solid white;"></div>`,
          iconSize: [12, 12],
          iconAnchor: [6, 6]
        })
      }).addTo(window.driverMap);
    });
    
    // Logout function - use standard Routa Auth
    function logout() {
      if (confirm('Выйти из аккаунта?')) {
        // Use Routa.Auth.logout if available (clears all auth data properly)
        if (typeof Routa !== 'undefined' && Routa.Auth && Routa.Auth.logout) {
          Routa.Auth.logout();
        } else {
          // Fallback: clear all auth data manually
          localStorage.removeItem('routa_access_token');
          localStorage.removeItem('routa_user');
          localStorage.removeItem('routa_features');
          localStorage.removeItem('user_role');
          window.location.href = './login.html';
        }
      }
    }
  </script>
  
  <script src="./assets/js/routa-core.js"></script>
  <script src="./assets/js/routox-unified.js"></script>
  <script>
    // ========== ROUTA PLATFORM INITIALIZATION ==========
    (async function() {
      Routa.Theme.load();
      const user = await Routa.App.init({
        requireAuth: true,
        currentPage: 'driver.html'
      });
      if (!user) return;
      console.log('Driver page initialized for:', user.role, user.edition);
    })();
  </script>
</body>
</html>
