<!DOCTYPE html>
<!--
RoutoX — Intelligent Fleet Management Dashboard
This single-page demo recreates the described PDF layout: dark tech look, responsive grid, interactive vehicle list,
live-ish metric jitter, mechanical status LEDs, map & alert modals, and add-vehicle form. Built with Tailwind CDN + vanilla JS.
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Панель RoutoX</title>
  <link rel="stylesheet" href="./assets/css/routox-unified.css">
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script src="https://kit.fontawesome.com/a2e0e9e5a9.js" crossorigin="anonymous"></script>
  <!-- Leaflet Map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="./assets/css/style.css" />
  <link rel="stylesheet" href="./assets/css/liquid-glass.css" />
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="glass-panel mx-4 mt-4 px-6 py-4 flex items-center justify-between sticky top-4 z-30">
    <div class="flex items-center gap-6">
      <a href="./index.html" class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center text-white font-bold text-lg shadow-lg">R</div>
        <div>
          <div class="font-semibold text-lg">RoutoX</div>
          <div class="text-xs text-muted">Управление флотом</div>
        </div>
      </a>
      <nav class="flex items-center gap-1 ml-8" id="mainNav">
        <!-- Navigation will be populated by JS based on role -->
      </nav>
    </div>
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2 px-3 py-2 rounded-xl bg-emerald-500/15 border border-emerald-500/30">
        <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
        <span class="text-sm text-emerald-500 font-medium">Live</span>
      </div>
      <span class="role-badge admin" id="roleBadge">
        <i class="fa-solid fa-user-gear"></i>
        <span id="roleText">Администратор</span>
      </span>
      <button class="icon-btn" id="notifBtn">
        <i class="fa-solid fa-bell"></i>
        <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[10px] text-white flex items-center justify-center">3</span>
      </button>
      <div class="theme-toggle-track" onclick="toggleTheme()">
        <div class="theme-toggle-thumb"></div>
      </div>
      <button class="icon-btn" onclick="logout()">
        <i class="fa-solid fa-right-from-bracket"></i>
      </button>
    </div>
  </header>

  <!-- Quick Stats Bar -->
  <div class="mx-4 mt-4 glass-panel p-4">
    <div class="grid grid-cols-4 gap-4">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-blue-600/20 flex items-center justify-center">
          <i class="fa-solid fa-truck text-blue-500 text-xl"></i>
        </div>
        <div>
          <div class="text-xs text-muted">Активные</div>
          <div class="text-2xl font-bold" id="metricActiveFleet">—</div>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center">
          <i class="fa-solid fa-screwdriver-wrench text-amber-500 text-xl"></i>
        </div>
        <div>
          <div class="text-xs text-muted">На ТО</div>
          <div class="text-2xl font-bold" id="metricMaintenance">—</div>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500/20 to-green-500/20 flex items-center justify-center">
          <i class="fa-solid fa-gauge-high text-emerald-500 text-xl"></i>
        </div>
        <div>
          <div class="text-xs text-muted">Эффективность</div>
          <div class="text-2xl font-bold" id="metricEfficiency">—</div>
        </div>
      </div>
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500/20 to-violet-500/20 flex items-center justify-center">
          <i class="fa-solid fa-boxes-stacked text-purple-500 text-xl"></i>
        </div>
        <div>
          <div class="text-xs text-muted">Грузы в пути</div>
          <div class="text-2xl font-bold" id="metricCargoValue">—</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Grid -->
  <main class="p-6 grid lg:grid-cols-[320px_1fr_320px] gap-4 flex-1">
    <!-- Track List -->
    <section class="glass rounded-2xl p-4 flex flex-col min-h-[70vh]">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Список маршрутов</h2>
        <span class="text-xs text-slate-400">Колонна · Онлайн</span>
      </div>
      <div id="trackList" class="space-y-3 overflow-y-auto scroll-slim">
        <!-- Cards injected by JS -->
      </div>
    </section>

    <!-- Center Panels -->
    <section class="space-y-4">
      <!-- Selected vehicle hero -->
      <div class="glass hero-panel rounded-3xl p-6 border border-slate-800">
        <div class="grid gap-6 items-center lg:grid-cols-[1.1fr_0.9fr] relative">
          <div class="space-y-4">
            <div>
              <p class="text-xs uppercase tracking-[0.25em] text-slate-400">Центральный контроль</p>
              <div id="selName" class="text-3xl font-semibold mt-1">MANTTOX</div>
              <div class="mt-2 text-sm text-slate-400" id="selCargo">Груз: SCOOT (D3000g) · Маршрут: 2B / 6B/1F</div>
            </div>
            <div id="selStatuses" class="flex gap-2 flex-wrap text-xs"></div>
            <div id="statusControls" class="flex flex-wrap gap-2 text-xs mt-2">
              <button class="status-btn" data-status="В сопровождении">В сопровождении</button>
              <button class="status-btn" data-status="Под охраной">Под охраной</button>
              <button class="status-btn" data-status="В пути">В пути</button>
              <button class="status-btn" data-status="На разгрузке">На разгрузке</button>
              <button class="status-btn" data-status="На погрузке">На погрузке</button>
              <button class="status-btn" data-status="Свободен">Свободен</button>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 text-xs">
              <div class="hero-badge">
                <span class="hero-badge-label">ETA</span>
                <span class="hero-badge-value" id="heroEta">17:45</span>
                <span class="hero-badge-sub">Минск</span>
              </div>
              <div class="hero-badge">
                <span class="hero-badge-label">Дистанция</span>
                <span class="hero-badge-value" id="heroDistance">780 км</span>
                <span class="hero-badge-sub">На маршруте</span>
              </div>
              <div class="hero-badge">
                <span class="hero-badge-label">Связь</span>
                <span class="hero-badge-value">Стойкая</span>
                <span class="hero-badge-sub">Канал 4B</span>
              </div>
            </div>
            <div class="flex flex-wrap gap-2">
              <button id="mapBtn" class="glass px-4 py-2 rounded-lg border border-slate-700 hover:border-emerald-400/60 flex items-center gap-2 text-sm transition-all">
                <i class="fa-solid fa-map text-emerald-300"></i> Карта
              </button>
              <button id="alertBtn" class="glass px-4 py-2 rounded-lg border border-slate-700 hover:border-red-400/60 hover:bg-red-500/10 flex items-center gap-2 text-sm transition-all">
                <i class="fa-solid fa-bell text-red-400 animate-pulse"></i> Тревога
              </button>
              <button id="deleteVehicleBtn" class="glass px-3 py-2 rounded-lg border border-slate-700 hover:border-red-400/60 hover:bg-red-500/10 flex items-center gap-2 text-sm transition-all text-slate-400 hover:text-red-400" title="Удалить выбранную фуру">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </button>
            </div>
          </div>
          <div class="hero-visual">
            <img id="heroImage" src="./assets/images/truck-data.png" alt="Изображение грузовика" class="hero-truck" loading="lazy" />
            <div class="hero-overlay top-4 left-4">
              <span class="hero-overlay-label">Загрузка</span>
              <span class="hero-overlay-value" id="heroLoadValue">77%</span>
            </div>
            <div class="hero-overlay top-4 right-4">
              <span class="hero-overlay-label">Госномер</span>
              <span class="hero-overlay-value" id="heroPlateValue">А123ВС 16 RUS</span>
            </div>
            <div class="hero-overlay bottom-6 right-4">
              <span class="hero-overlay-label">Скорость</span>
              <span class="hero-overlay-value" id="heroSpeedValue">68 км/ч</span>
            </div>
            <div class="hero-overlay bottom-6 left-4">
              <span class="hero-overlay-label">Температура</span>
              <span class="hero-overlay-value" id="heroTempValue">24°C</span>
            </div>
          </div>
        </div>

        <div class="grid sm:grid-cols-3 gap-4 mt-6">
          <div class="glass rounded-xl p-3 border border-slate-800 flex items-center gap-3">
            <div class="w-12 h-12 rounded-full flex items-center justify-center text-lg font-semibold pulse dev-circle dev-ok" id="devCircle">0°</div>
            <div>
              <div class="text-xs text-slate-400">Отклонение узла</div>
              <div class="text-base font-semibold" id="devLabel">Стабильно</div>
            </div>
          </div>
          <div class="glass rounded-xl p-3 border border-slate-800 flex items-center gap-3">
            <i class="fa-solid fa-temperature-half text-orange-300 text-xl"></i>
            <div class="flex-1">
              <div class="text-xs text-slate-400">Температура</div>
              <div class="flex items-center gap-2">
                <div class="text-base font-semibold" id="tempVal">24°C</div>
                <span class="text-xs px-2 py-0.5 rounded-full bg-orange-500/10 text-orange-200 border border-orange-500/30">Норма</span>
              </div>
            </div>
          </div>
          <div class="glass rounded-xl p-3 border border-slate-800">
            <div class="flex items-center justify-between text-xs text-slate-400">
              <span>Загрузка</span><span id="rollValLabel">60%</span>
            </div>
            <div class="progress mt-2"><span id="rollBar" class="bg-emerald-500/70 w-[60%]"></span></div>
          </div>
        </div>
      </div>
      
      <!-- Driver + truck info -->
      <div class="grid gap-4 md:grid-cols-2">
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center gap-4">
            <button class="driver-avatar" id="driverAvatarBtn" aria-label="Открыть профиль водителя"><span id="driverAvatar">АМ</span></button>
            <div class="flex-1">
              <div class="flex items-center justify-between gap-2 flex-wrap">
                <div>
                  <div class="text-lg font-semibold" id="driverName">Артем Малышев</div>
                  <div class="text-sm text-slate-400" id="driverStatus">На линии · 4ч 12м</div>
                  <div class="text-xs text-slate-500" id="driverHome">База: Казань</div>
                </div>
                <a id="driverCall" href="#" class="call-chip" aria-label="Позвонить водителю" aria-disabled="true" title="Телефон не указан" style="pointer-events:none;opacity:.6"><i class="fa-solid fa-phone"></i><span id="driverPhone">—</span></a>
              </div>
            </div>
            <button class="icon-button" aria-label="Связаться с водителем"><i class="fa-solid fa-headset"></i></button>
          </div>
          <div class="grid grid-cols-1 gap-3 text-sm mt-4">
            <div class="data-pill">
              <span class="pill-label">Стаж</span>
              <span class="pill-value" id="driverExperience">9 лет</span>
            </div>
            <div class="data-pill">
              <span class="pill-label">Смена</span>
              <span class="pill-value" id="driverShift">4ч 12м</span>
            </div>
            <div class="data-pill">
              <span class="pill-label">До лимита (12ч)</span>
              <span class="pill-value" id="driverRemaining">—</span>
            </div>
            <div class="data-pill">
              <span class="pill-label">Допуск</span>
              <span class="pill-value" id="driverLicense">CE</span>
            </div>
            <div class="data-pill">
              <span class="pill-label">Отдых</span>
              <span class="pill-value" id="driverRest">через 1ч</span>
            </div>
            <div class="data-pill">
              <span class="pill-label">Телефон</span>
              <span class="pill-value" id="driverPhonePill">—</span>
            </div>
          </div>
        </div>
        <div class="glass rounded-2xl p-4">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="text-lg font-semibold">Параметры фуры</h3>
              <p class="text-xs text-slate-500">VIN · <span id="truckVin">SDK-8831</span></p>
            </div>
            <span class="truck-tag" id="truckSeries">SDK · AM</span>
          </div>
          <div class="space-y-4 mt-4">
            <div>
              <div class="truck-spec">
                <span class="spec-label">Загрузка</span>
                <span class="spec-value" id="truckLoadValue">77%</span>
              </div>
              <div class="text-xs text-slate-400" id="truckPallets">28/38 пал.</div>
              <div class="metric-bar"><span id="truckLoadBar"></span></div>
            </div>
            <div>
              <div class="truck-spec">
                <span class="spec-label">Топливо</span>
                <span class="spec-value" id="truckFuelValue">480 л</span>
              </div>
              <div class="text-xs text-slate-400" id="truckFuelStatus">72%</div>
              <div class="metric-bar"><span id="truckFuelBar"></span></div>
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div class="spec-card">
                <span class="spec-card-label">Температура</span>
                <span class="spec-card-value" id="truckTempValue">24°C</span>
                <p class="spec-card-sub">Стабилизирована</p>
              </div>
              <div class="spec-card">
                <span class="spec-card-label">Состояние</span>
                <span class="spec-card-value" id="truckHealthValue">94%</span>
                <p class="spec-card-sub">Узелов в норме</p>
              </div>
            </div>
            <div class="data-card">
              <div class="data-row"><span>Шасси</span><span id="truckChassis">6x4</span></div>
              <div class="data-row"><span>Полная масса</span><span id="truckMass">38 т</span></div>
              <div class="data-row"><span>Высота/длина</span><span id="truckSize">4.0 м / 13.6 м</span></div>
              <div class="data-row"><span>Осевая нагрузка</span><span id="truckAxle">11.5 / 10 / 10 т</span></div>
            </div>
            <div class="fault-block" id="faultBlock">
              <div class="fault-title">Ошибки узлов</div>
              <div class="fault-grid">
                <button class="fault-btn" data-fault="ABS">ABS</button>
                <button class="fault-btn" data-fault="Пневмо">Пневмо</button>
                <button class="fault-btn" data-fault="Давление шин">Давление шин</button>
                <button class="fault-btn" data-fault="Колодки">Колодки</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Route / Activity -->
      <div class="glass rounded-2xl p-4">
        <div class="flex items-center justify-between flex-wrap gap-2">
          <h3 class="text-lg font-semibold">Маршрут / Узлы</h3>
          <span class="text-xs text-slate-400">Живой маршрут</span>
        </div>
        <div class="mt-4">
          <div class="flex items-center gap-3 mb-4">
            <div class="node"></div>
            <div class="flex-1 route-line"></div>
            <div class="node"></div>
            <div class="flex-1 route-line"></div>
            <div class="node-warn"></div>
            <div class="flex-1 route-line"></div>
            <div class="node"></div>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-3 text-sm">
            <div class="glass rounded-xl p-3 border border-slate-800">
              <div class="text-xs text-slate-400">Активность за день</div>
              <div class="font-semibold" id="metricActive">4ч 12м</div>
            </div>
            <div class="glass rounded-xl p-3 border border-slate-800">
              <div class="text-xs text-slate-400">Просушка (10 мин)</div>
              <div class="font-semibold" id="metricDry">7 циклов</div>
            </div>
            <div class="glass rounded-xl p-3 border border-slate-800">
              <div class="text-xs text-slate-400">Средняя скорость</div>
              <div class="font-semibold" id="metricSpeed">68 км/ч</div>
            </div>
            <div class="glass rounded-xl p-3 border border-slate-800">
              <div class="text-xs text-slate-400">Использование кузова</div>
              <div class="font-semibold" id="metricTrunk">Включено</div>
            </div>
            <div class="glass rounded-xl p-3 border border-slate-800">
              <div class="text-xs text-slate-400">Полоса</div>
              <div class="font-semibold" id="metricRunway">Штатный день</div>
            </div>
            <div class="glass rounded-xl p-3 border border-slate-800">
              <div class="text-xs text-slate-400">Гимм-3</div>
              <div class="font-semibold" id="metricGymm">42 ед</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Live truck map with Leaflet -->
      <div class="glass rounded-2xl p-4">
        <div class="flex items-center justify-between flex-wrap gap-2 mb-4">
          <div>
            <h3 class="text-lg font-semibold flex items-center gap-2">
              <i class="fa-solid fa-route text-emerald-400"></i>
              Маршрут фуры
            </h3>
            <p class="text-xs text-slate-500">Живой трек маршрута с GPS-координатами</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-xs px-2 py-1 rounded-full bg-emerald-500/20 text-emerald-300 border border-emerald-500/30" id="routeProgressLabel">Пройдено 0%</span>
          </div>
        </div>
        
        <!-- Interactive Map -->
        <div id="routeMapLeaflet" class="rounded-xl overflow-hidden border border-slate-700/50" style="height: 280px; background: #1a1f2e;"></div>
        
        <!-- Route Info Cards -->
        <div class="grid grid-cols-3 gap-3 mt-4">
          <!-- Point A -->
          <div class="glass rounded-xl p-3 border border-emerald-500/30 bg-emerald-500/5">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full bg-emerald-500 shadow-lg shadow-emerald-500/50"></div>
              <span class="text-[10px] uppercase tracking-wider text-emerald-400">Пункт А</span>
            </div>
            <div class="font-bold text-base text-white" id="routeFrom">Казань</div>
            <div class="text-xs text-slate-400 mt-1" id="routeStartTime">Старт 08:00</div>
            <div class="text-xs text-slate-500" id="routeTimeElapsed">4.5 ч в пути</div>
          </div>
          
          <!-- Distance -->
          <div class="glass rounded-xl p-3 border border-sky-500/30 bg-sky-500/5">
            <div class="flex items-center gap-2 mb-2">
              <i class="fa-solid fa-road text-sky-400"></i>
              <span class="text-[10px] uppercase tracking-wider text-sky-400">Дистанция</span>
            </div>
            <div class="font-bold text-base text-white" id="routeDistance">312 / 780 км</div>
            <div class="text-xs text-slate-400 mt-1" id="routeSpeed">Ср. скорость 68 км/ч</div>
            <div class="text-xs text-slate-500">Код: <span id="routeCode" class="text-sky-300">М7-Р239</span></div>
          </div>
          
          <!-- Point B -->
          <div class="glass rounded-xl p-3 border border-orange-500/30 bg-orange-500/5">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full bg-orange-500 shadow-lg shadow-orange-500/50"></div>
              <span class="text-[10px] uppercase tracking-wider text-orange-400">Пункт B</span>
            </div>
            <div class="font-bold text-base text-white" id="routeTo">Минск</div>
            <div class="text-xs text-slate-400 mt-1" id="routeEta">ETA 17:45</div>
            <div class="text-xs text-slate-500" id="routeTimeRemaining">6.8 ч осталось</div>
          </div>
        </div>
        
        <!-- Progress Bar -->
        <div class="mt-4">
          <div class="h-2 rounded-full bg-slate-800 overflow-hidden">
            <div id="routeProgressBar" class="h-full rounded-full transition-all duration-500" style="width: 40%; background: linear-gradient(90deg, #22c55e, #0ea5e9);"></div>
          </div>
        </div>
      </div>

      <!-- Cargo layout -->
      <div class="glass rounded-2xl p-4 liquid-glass-section">
        <div class="flex items-center justify-between flex-wrap gap-2 mb-4">
          <div class="flex items-center gap-3">
            <img id="cargoTruckThumb" src="./assets/images/truck-data.png" alt="Фура" class="w-12 h-12 rounded-lg object-cover border border-slate-700/50" />
            <div>
              <h3 class="text-lg font-semibold flex items-center gap-2">
                <i class="fa-solid fa-boxes-stacked text-emerald-400"></i>
                Конструктор груза
              </h3>
              <p class="text-xs text-slate-400">Интерактивное распределение груза в прицепе · <span id="cargoTruckName" class="text-sky-300">—</span></p>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <div class="flex items-center gap-2 text-xs">
              <span class="text-slate-400">Загрузка:</span>
              <span class="font-semibold text-emerald-400" id="cargoLoadPercent">0%</span>
            </div>
            <button id="clearCargoBtn" class="glass px-3 py-1.5 rounded-lg border border-slate-700 hover:border-red-400/60 transition text-xs flex items-center gap-2">
              <i class="fa-solid fa-eraser text-red-300"></i>
              Очистить
            </button>
            <span class="text-xs text-slate-500" id="cargoUpdated">Обновлено только что</span>
          </div>
        </div>
        
        <!-- Truck Visualization with Cargo Grid Inside Trailer -->
        <div class="truck-visualization-container relative rounded-2xl overflow-hidden" style="background: radial-gradient(ellipse 80% 60% at 65% 40%, rgba(6, 182, 212, 0.08) 0%, transparent 60%), rgba(15, 23, 42, 0.6);">
          
          <!-- Truck with Trailer SVG - Cargo Grid INSIDE -->
          <div class="truck-trailer-visual relative w-full" style="padding: 20px;">
            
            <!-- Main Truck + Trailer Container -->
            <div class="relative mx-auto" style="max-width: 900px;">
              
              <!-- Dynamic SVG Truck Container - will be replaced based on selected vehicle -->
              <div id="cargoTruckSvg" class="w-full" style="filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3));">
                <!-- Default SVG Truck with Trailer -->
                <svg viewBox="0 0 900 280" class="w-full h-auto">
                  <defs>
                    <linearGradient id="trailerGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                      <stop offset="0%" style="stop-color:#3b4a5a"/>
                      <stop offset="100%" style="stop-color:#1e293b"/>
                    </linearGradient>
                    <linearGradient id="cabGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                      <stop offset="0%" style="stop-color:#0ea5e9"/>
                      <stop offset="100%" style="stop-color:#0284c7"/>
                    </linearGradient>
                    <linearGradient id="wheelGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                      <stop offset="0%" style="stop-color:#374151"/>
                      <stop offset="100%" style="stop-color:#1f2937"/>
                    </linearGradient>
                  </defs>
                  <ellipse cx="450" cy="265" rx="400" ry="12" fill="rgba(0,0,0,0.3)"/>
                  <rect x="50" y="60" width="580" height="160" rx="8" fill="url(#trailerGradient)" stroke="#475569" stroke-width="2"/>
                  <rect x="50" y="55" width="580" height="12" rx="4" fill="#4b5563"/>
                  <rect x="50" y="62" width="30" height="156" fill="#2d3748" stroke="#475569" stroke-width="1"/>
                  <circle cx="65" cy="140" r="4" fill="#6b7280"/>
                  <rect x="625" y="170" width="40" height="20" fill="#374151" stroke="#475569" stroke-width="1"/>
                  <path d="M665 80 L665 220 L800 220 L820 160 L820 100 Q820 80 800 80 Z" fill="url(#cabGradient)" stroke="#0369a1" stroke-width="2"/>
                  <rect x="675" y="95" width="50" height="40" rx="4" fill="#0f172a" opacity="0.7"/>
                  <rect x="730" y="95" width="60" height="50" rx="6" fill="rgba(125, 211, 252, 0.3)" stroke="#7dd3fc" stroke-width="1"/>
                  <rect x="675" y="160" width="60" height="20" rx="2" fill="#1e293b"/>
                  <circle cx="690" cy="170" r="3" fill="#6b7280"/>
                  <rect x="810" y="140" width="8" height="12" rx="2" fill="#fef08a"/>
                  <rect x="810" y="160" width="8" height="8" rx="2" fill="#f97316"/>
                  <rect x="820" y="100" width="8" height="40" rx="2" fill="#374151"/>
                  <circle cx="180" cy="235" r="28" fill="url(#wheelGradient)" stroke="#1f2937" stroke-width="3"/>
                  <circle cx="180" cy="235" r="12" fill="#4b5563"/>
                  <circle cx="220" cy="235" r="28" fill="url(#wheelGradient)" stroke="#1f2937" stroke-width="3"/>
                  <circle cx="220" cy="235" r="12" fill="#4b5563"/>
                  <circle cx="520" cy="235" r="28" fill="url(#wheelGradient)" stroke="#1f2937" stroke-width="3"/>
                  <circle cx="520" cy="235" r="12" fill="#4b5563"/>
                  <circle cx="560" cy="235" r="28" fill="url(#wheelGradient)" stroke="#1f2937" stroke-width="3"/>
                  <circle cx="560" cy="235" r="12" fill="#4b5563"/>
                  <circle cx="720" cy="235" r="32" fill="url(#wheelGradient)" stroke="#1f2937" stroke-width="3"/>
                  <circle cx="720" cy="235" r="14" fill="#4b5563"/>
                  <circle cx="780" cy="235" r="32" fill="url(#wheelGradient)" stroke="#1f2937" stroke-width="3"/>
                  <circle cx="780" cy="235" r="14" fill="#4b5563"/>
                  <rect x="245" y="220" width="30" height="30" rx="2" fill="#1f2937"/>
                  <rect x="585" y="220" width="30" height="30" rx="2" fill="#1f2937"/>
                  <text x="700" y="145" font-size="14" fill="#fff" font-weight="bold" opacity="0.8">RoutoX</text>
                </svg>
              </div>
              
              <!-- Cargo Grid Overlay - Positioned precisely INSIDE the trailer body -->
              <!-- Position calculated: x=85/900=9.44%, y=72/280=25.71%, w=530/900=58.89%, h=138/280=49.29% -->
              <div id="cargoGridOverlay" class="absolute" style="top: 25.71%; left: 9.44%; width: 58.89%; height: 49.29%;">
                <div id="cargoGrid" class="cargo-grid-inside grid h-full w-full gap-[1px] rounded" style="grid-template-columns: repeat(8, 1fr); grid-template-rows: repeat(3, 1fr); background: rgba(0,0,0,0.15);">
                  <!-- Cells generated by JS -->
                </div>
              </div>
              
              <!-- Status badges on truck -->
              <div class="absolute top-2 left-2 glass px-2 py-1 rounded-lg border border-slate-700/50 text-xs">
                <span class="text-slate-400">Загрузка:</span>
                <span class="font-bold text-emerald-400" id="heroCargoLoad">0%</span>
              </div>
              
              <div class="absolute top-2 right-2 glass px-2 py-1 rounded-lg border border-slate-700/50 text-xs">
                <span class="text-slate-400">Ячеек:</span>
                <span class="font-bold text-white" id="heroPalletCount">0</span><span class="text-slate-500">/24</span>
              </div>
              
              <div class="absolute bottom-10 left-2 glass px-2 py-1 rounded-lg border border-cyan-500/30 text-xs">
                <span class="text-slate-400">t°:</span>
                <span class="font-bold text-cyan-400" id="heroCargoTemp">4°C</span>
              </div>
              
              <div class="absolute bottom-10 right-2 glass px-2 py-1 rounded-lg border border-orange-500/30 text-xs">
                <span class="text-slate-400">Вес:</span>
                <span class="font-bold text-orange-400" id="heroCargoWeight">0</span><span class="text-slate-500"> т</span>
              </div>
              
            </div>
            
            <!-- Instructions -->
            <div class="text-center mt-4 text-xs text-slate-500">
              <i class="fa-solid fa-hand-pointer mr-1"></i> Кликните на ячейку для просмотра · 
              <i class="fa-solid fa-arrows-alt mr-1"></i> Shift+клик для начала объединения · 
              <i class="fa-solid fa-scissors mr-1"></i> Ctrl+клик для разделения
            </div>
          </div>
        </div>
        
        <!-- Cargo Type Palette -->
        <div class="cargo-palette-section mt-4 p-4 rounded-xl border border-slate-700/50 bg-slate-900/30 backdrop-blur-sm">
          <div class="flex items-center justify-between mb-3">
            <span class="text-xs font-semibold uppercase tracking-wider text-slate-400">Типы груза</span>
            <span class="text-xs text-slate-500">Перетащите на прицеп или кликните для выбора</span>
          </div>
          <div class="flex flex-wrap gap-2" id="cargoPalette">
            <button class="cargo-type-btn flex items-center gap-2 px-3 py-2 rounded-xl border border-sky-500/40 bg-sky-500/10 text-sky-300 hover:bg-sky-500/20 transition-all" data-type="cold" draggable="true">
              <span class="w-3 h-3 rounded-full bg-sky-400"></span>
              <span class="text-sm font-medium">Холод</span>
              <span class="text-xs text-sky-400/70">2-6°C</span>
            </button>
            <button class="cargo-type-btn flex items-center gap-2 px-3 py-2 rounded-xl border border-orange-500/40 bg-orange-500/10 text-orange-300 hover:bg-orange-500/20 transition-all" data-type="dry" draggable="true">
              <span class="w-3 h-3 rounded-full bg-orange-400"></span>
              <span class="text-sm font-medium">Сухой</span>
              <span class="text-xs text-orange-400/70">18-22°C</span>
            </button>
            <button class="cargo-type-btn flex items-center gap-2 px-3 py-2 rounded-xl border border-purple-500/40 bg-purple-500/10 text-purple-300 hover:bg-purple-500/20 transition-all" data-type="fragile" draggable="true">
              <span class="w-3 h-3 rounded-full bg-purple-400"></span>
              <span class="text-sm font-medium">Хрупкое</span>
              <span class="text-xs text-purple-400/70">Осторожно</span>
            </button>
            <button class="cargo-type-btn flex items-center gap-2 px-3 py-2 rounded-xl border border-amber-500/40 bg-amber-500/10 text-amber-300 hover:bg-amber-500/20 transition-all" data-type="hot" draggable="true">
              <span class="w-3 h-3 rounded-full bg-amber-400"></span>
              <span class="text-sm font-medium">Горячий</span>
              <span class="text-xs text-amber-400/70">60-80°C</span>
            </button>
            <button class="cargo-type-btn flex items-center gap-2 px-3 py-2 rounded-xl border border-red-500/40 bg-red-500/10 text-red-300 hover:bg-red-500/20 transition-all" data-type="hazmat" draggable="true">
              <span class="w-3 h-3 rounded-full bg-red-400"></span>
              <span class="text-sm font-medium">Опасный</span>
              <span class="text-xs text-red-400/70">ADR</span>
            </button>
            <button class="cargo-type-btn flex items-center gap-2 px-3 py-2 rounded-xl border border-slate-500/40 bg-slate-500/10 text-slate-300 hover:bg-slate-500/20 transition-all" data-type="general" draggable="true">
              <span class="w-3 h-3 rounded-full bg-slate-400"></span>
              <span class="text-sm font-medium">Общий</span>
              <span class="text-xs text-slate-400/70">Стандарт</span>
            </button>
          </div>
          
          <!-- Temperature Conflict Warning -->
          <div id="tempConflictWarning" class="hidden mt-3 p-3 rounded-xl border-2 border-red-500/60 bg-red-500/20 backdrop-blur-sm">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-triangle-exclamation text-red-400 text-2xl animate-pulse"></i>
              <div>
                <div class="font-bold text-red-300">⚠️ ТЕМПЕРАТУРНЫЙ КОНФЛИКТ!</div>
                <div class="text-sm text-red-200/80">Холодный и горячий груз нельзя перевозить вместе в одном прицепе</div>
              </div>
            </div>
          </div>
          
          <!-- Load Progress Bar -->
          <div class="mt-4">
            <div class="flex items-center justify-between text-xs mb-1">
              <span class="text-slate-400">Заполненность прицепа</span>
              <span class="font-semibold text-white" id="cargoProgressLabel">0 / 24 ячеек</span>
            </div>
            <div class="h-2 rounded-full bg-slate-800 overflow-hidden">
              <div id="cargoProgressBar" class="h-full rounded-full transition-all duration-300" style="width: 0%; background: linear-gradient(90deg, #10b981, #06b6d4);"></div>
            </div>
          </div>
        </div>
        
        <!-- Cargo Statistics -->
        <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mt-4">
          <div class="stat-mini glass rounded-xl p-3 border border-sky-500/20 bg-sky-500/5">
            <div class="flex items-center gap-2 mb-1">
              <span class="w-2 h-2 rounded-full bg-sky-400"></span>
              <span class="text-[10px] uppercase tracking-wider text-slate-400">Холод</span>
            </div>
            <div class="text-lg font-bold text-sky-400" id="statColdCount">0</div>
          </div>
          <div class="stat-mini glass rounded-xl p-3 border border-amber-500/20 bg-amber-500/5">
            <div class="flex items-center gap-2 mb-1">
              <span class="w-2 h-2 rounded-full bg-amber-400"></span>
              <span class="text-[10px] uppercase tracking-wider text-slate-400">Горячий</span>
            </div>
            <div class="text-lg font-bold text-amber-400" id="statHotCount">0</div>
          </div>
          <div class="stat-mini glass rounded-xl p-3 border border-orange-500/20 bg-orange-500/5">
            <div class="flex items-center gap-2 mb-1">
              <span class="w-2 h-2 rounded-full bg-orange-400"></span>
              <span class="text-[10px] uppercase tracking-wider text-slate-400">Сухой</span>
            </div>
            <div class="text-lg font-bold text-orange-400" id="statDryCount">0</div>
          </div>
          <div class="stat-mini glass rounded-xl p-3 border border-purple-500/20 bg-purple-500/5">
            <div class="flex items-center gap-2 mb-1">
              <span class="w-2 h-2 rounded-full bg-purple-400"></span>
              <span class="text-[10px] uppercase tracking-wider text-slate-400">Хрупкое</span>
            </div>
            <div class="text-lg font-bold text-purple-400" id="statFragileCount">0</div>
          </div>
          <div class="stat-mini glass rounded-xl p-3 border border-red-500/20 bg-red-500/5">
            <div class="flex items-center gap-2 mb-1">
              <span class="w-2 h-2 rounded-full bg-red-400"></span>
              <span class="text-[10px] uppercase tracking-wider text-slate-400">Опасный</span>
            </div>
            <div class="text-lg font-bold text-red-400" id="statHazmatCount">0</div>
          </div>
          <div class="stat-mini glass rounded-xl p-3 border border-slate-500/20 bg-slate-500/5">
            <div class="flex items-center gap-2 mb-1">
              <span class="w-2 h-2 rounded-full bg-slate-400"></span>
              <span class="text-[10px] uppercase tracking-wider text-slate-400">Общий</span>
            </div>
            <div class="text-lg font-bold text-slate-400" id="statGeneralCount">0</div>
          </div>
        </div>
        
        <!-- Mini Stats Row -->
        <div class="grid md:grid-cols-3 gap-3 mt-4 text-sm">
          <div class="mini-stat">
            <span class="mini-stat-label">Температура ядра</span>
            <div class="mini-stat-value" id="cargoCoreTemp">3.8°C</div>
            <p class="text-xs text-slate-400">Допуск 2-5°C</p>
          </div>
          <div class="mini-stat">
            <span class="mini-stat-label">Влажность</span>
            <div class="mini-stat-value" id="cargoHumidity">52%</div>
            <p class="text-xs text-slate-400">Стабилизаторы активны</p>
          </div>
          <div class="mini-stat">
            <span class="mini-stat-label">Давление</span>
            <div class="mini-stat-value" id="cargoPressure">1.01 бар</div>
            <p class="text-xs text-slate-400">P03 · компенсация</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Right Column -->
    <section class="space-y-4">
      <!-- Orders (admin) -->
      <div class="glass rounded-2xl p-4">
        <div class="flex items-center justify-between mb-3 gap-3 flex-wrap">
          <div>
            <h3 class="text-lg font-semibold">Заказы</h3>
            <p class="text-xs text-slate-500">Создание заказов доступно администратору</p>
          </div>
          <button id="ordersAdminRefreshBtn" class="glass px-3 py-2 rounded-lg border border-slate-700 hover:border-sky-400/60 transition flex items-center gap-2 text-sm">
            <i class="fa-solid fa-arrows-rotate text-sky-300"></i>
            Обновить
          </button>
        </div>

        <form id="adminOrderForm" class="grid gap-2">
          <input id="adminOrderTitle" required placeholder="Название заказа" class="glass rounded-lg border border-slate-700 px-3 py-2 text-sm" />
          <div class="grid grid-cols-2 gap-2">
            <input id="adminOrderOrigin" placeholder="Откуда" class="glass rounded-lg border border-slate-700 px-3 py-2 text-sm" />
            <input id="adminOrderDestination" placeholder="Куда" class="glass rounded-lg border border-slate-700 px-3 py-2 text-sm" />
          </div>
          <button type="submit" class="glass px-4 py-2 rounded-lg border border-slate-700 hover:border-emerald-400/60 transition flex items-center justify-center gap-2 text-sm">
            <i class="fa-solid fa-plus text-emerald-300"></i>
            Создать заказ
          </button>
          <div id="adminOrdersNote" class="text-sm text-slate-400 hidden"></div>
        </form>

        <div id="ordersAdminEmpty" class="mt-3 text-sm text-slate-400">—</div>
        <div id="ordersAdminList" class="mt-3 grid gap-2"></div>
      </div>

      <!-- Mechanical condition - New Visual Style -->
      <div class="glass rounded-2xl p-4">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Mechanical condition</h3>
          <div class="flex items-center gap-2">
            <span class="text-2xl font-bold" id="mechOverallPercent">91%</span>
            <span class="flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
              <span class="w-2 h-2 rounded-full bg-emerald-400"></span>
              Optimal
            </span>
          </div>
        </div>
        
        <!-- Visual condition bars -->
        <div class="grid grid-cols-5 gap-2" id="mechanicalBars">
          <div class="mech-bar-item flex flex-col items-center gap-1">
            <span class="text-sm font-semibold text-slate-300" id="mechEnginePercent">90%</span>
            <div class="mech-bar-container w-full h-24 rounded-lg overflow-hidden bg-slate-800/50 relative">
              <div class="mech-bar-fill absolute bottom-0 w-full transition-all duration-500" id="mechEngineBar" style="height: 90%; background: linear-gradient(to top, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);"></div>
            </div>
            <span class="text-xs text-slate-400">Engine</span>
          </div>
          <div class="mech-bar-item flex flex-col items-center gap-1">
            <span class="text-sm font-semibold text-slate-300" id="mechBrakesPercent">90%</span>
            <div class="mech-bar-container w-full h-24 rounded-lg overflow-hidden bg-slate-800/50 relative">
              <div class="mech-bar-fill absolute bottom-0 w-full transition-all duration-500" id="mechBrakesBar" style="height: 90%; background: linear-gradient(to top, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);"></div>
            </div>
            <span class="text-xs text-slate-400">Brakes</span>
          </div>
          <div class="mech-bar-item flex flex-col items-center gap-1">
            <span class="text-sm font-semibold text-slate-300" id="mechTiresPercent">80%</span>
            <div class="mech-bar-container w-full h-24 rounded-lg overflow-hidden bg-slate-800/50 relative">
              <div class="mech-bar-fill absolute bottom-0 w-full transition-all duration-500" id="mechTiresBar" style="height: 80%; background: linear-gradient(to top, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);"></div>
            </div>
            <span class="text-xs text-slate-400">Tires</span>
          </div>
          <div class="mech-bar-item flex flex-col items-center gap-1">
            <span class="text-sm font-semibold text-slate-300" id="mechOilPercent">89%</span>
            <div class="mech-bar-container w-full h-24 rounded-lg overflow-hidden bg-slate-800/50 relative">
              <div class="mech-bar-fill absolute bottom-0 w-full transition-all duration-500" id="mechOilBar" style="height: 89%; background: linear-gradient(to top, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);"></div>
            </div>
            <span class="text-xs text-slate-400">Oil</span>
          </div>
          <div class="mech-bar-item flex flex-col items-center gap-1">
            <span class="text-sm font-semibold text-slate-300" id="mechSuspensionPercent">92%</span>
            <div class="mech-bar-container w-full h-24 rounded-lg overflow-hidden bg-slate-800/50 relative">
              <div class="mech-bar-fill absolute bottom-0 w-full transition-all duration-500" id="mechSuspensionBar" style="height: 92%; background: linear-gradient(to top, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%);"></div>
            </div>
            <span class="text-xs text-slate-400">Suspension</span>
          </div>
        </div>
        
        <!-- Legacy mechanical list (hidden, kept for compatibility) -->
        <div id="mechanicalList" class="hidden"></div>
      </div>
      
      <!-- Camera Section -->
      <div class="glass rounded-2xl p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-lg font-semibold flex items-center gap-2">
            <i class="fa-solid fa-video text-red-400"></i>
            Camera
          </h3>
          <span class="text-xs text-slate-500" id="cameraVehicleId">TR-001</span>
        </div>
        
        <!-- Camera Feed -->
        <div class="camera-feed relative rounded-xl overflow-hidden border border-slate-700/50" style="aspect-ratio: 16/10; background: #0f1419;">
          <img id="cameraImage" src="./assets/images/cargo-photo.png" alt="Camera feed" class="w-full h-full object-cover" onerror="this.src='./assets/images/truck-data.png'" />
          
          <!-- Live badge -->
          <div class="absolute top-3 left-3 flex items-center gap-2 px-2 py-1 rounded-full bg-red-500/90 text-white text-xs font-semibold">
            <span class="w-2 h-2 rounded-full bg-white animate-pulse"></span>
            Live
          </div>
          
          <!-- Camera timestamp -->
          <div class="absolute bottom-3 right-3 px-2 py-1 rounded bg-black/60 text-white text-xs font-mono" id="cameraTimestamp">04:39:16</div>
          
          <!-- Camera overlay info -->
          <div class="absolute top-3 right-3 px-2 py-1 rounded bg-black/60 text-white text-xs">
            <span id="cameraLabel">CargoCam · 2K IR</span>
          </div>
          
          <!-- Zoom indicator -->
          <div class="absolute bottom-3 left-3 px-2 py-1 rounded bg-black/60 text-white text-xs flex items-center gap-1">
            <i class="fa-solid fa-search-plus"></i>
            <span id="cameraZoom">x1.8</span>
          </div>
        </div>
        
        <!-- Camera tabs -->
        <div class="flex gap-2 mt-3 flex-wrap">
          <button class="camera-tab camera-tab-active" data-view="cargo"><i class="fa-solid fa-box mr-1"></i>Кузов</button>
          <button class="camera-tab" data-view="inside"><i class="fa-solid fa-car mr-1"></i>Кабина</button>
          <button class="camera-tab" data-view="panorama"><i class="fa-solid fa-road mr-1"></i>Дорога</button>
          <button id="cameraRefresh" class="camera-tab ml-auto"><i class="fa-solid fa-arrows-rotate"></i></button>
        </div>
        
        <!-- Camera info -->
        <div class="mt-3 p-3 rounded-xl bg-slate-900/50 border border-slate-700/30">
          <div class="flex items-center justify-between text-sm">
            <div>
              <div class="font-semibold" id="cameraTitle">Фото из кузова</div>
              <div class="text-xs text-slate-400" id="cameraSubtitle">Контроль груза и креплений</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-slate-400">Курс</div>
              <div class="font-semibold" id="cameraCourse">СВ · 45°</div>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 right-4 z-30 hidden">
    <div class="glass rounded-xl px-4 py-3 border border-emerald-500/40 text-sm flex items-center gap-3 shadow-lg">
      <i class="fa-solid fa-circle-check text-emerald-300"></i>
      <span id="toastMsg">Тревога отправлена</span>
    </div>
  </div>

  <!-- Modal: Map -->
  <div id="mapModal" class="modal fixed inset-0 hidden items-center justify-center z-40">
    <div class="glass rounded-2xl p-6 w-[90%] max-w-3xl border border-slate-700 relative fade-in">
      <button class="absolute top-3 right-3 text-slate-400 hover:text-white" onclick="toggleModal('mapModal', false)"><i class="fa-solid fa-xmark"></i></button>
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><i class="fa-solid fa-map-location-dot text-emerald-300"></i> Онлайн-карта</h3>
      <div class="h-72 bg-slate-900/70 border border-slate-800 rounded-xl overflow-hidden relative">
        <iframe id="mapFrame" title="Карта маршрута" class="w-full h-full border-0" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        <div id="mapFallback" class="absolute inset-0 flex items-center justify-center text-slate-400 text-sm bg-slate-900/60 hidden">
          Не удалось загрузить карту
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Add vehicle -->
  <div id="addModal" class="modal fixed inset-0 hidden items-center justify-center z-40">
    <div class="glass rounded-2xl p-6 w-[90%] max-w-md border border-slate-700 relative fade-in">
      <button class="absolute top-3 right-3 text-slate-400 hover:text-white" onclick="toggleModal('addModal', false)"><i class="fa-solid fa-xmark"></i></button>
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2"><i class="fa-solid fa-plus text-emerald-300"></i> Добавить транспорт</h3>
      <form id="addForm" class="space-y-3">
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-sm text-slate-300">Название*</label>
            <input required name="name" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2" placeholder="например, VOLVO FH" />
          </div>
          <div>
            <label class="text-sm text-slate-300">Гос номер*</label>
            <input required name="plate" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2" placeholder="А123ВС 16 RUS" />
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-sm text-slate-300">VIN*</label>
            <input required name="vin" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2" placeholder="17 символов" />
          </div>
          <div>
            <label class="text-sm text-slate-300">Серия</label>
            <input name="series" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2" placeholder="например, R450" />
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="text-sm text-slate-300">Маршрут</label>
            <input name="route" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2" placeholder="М7 · Р239" />
          </div>
          <div>
            <label class="text-sm text-slate-300">Груз</label>
            <input name="cargo" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2" placeholder="Что везем" />
          </div>
        </div>
        <div class="grid grid-cols-2 gap-3 items-end">
          <div>
            <label class="text-sm text-slate-300">Статус</label>
            <select name="status" id="addStatus" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2">
              <option>В пути</option>
              <option>Простаивает</option>
              <option>Обслуживание</option>
            </select>
          </div>
          <div id="loadField">
            <label class="text-sm text-slate-300">Загрузка (%)</label>
            <input type="number" min="0" max="100" name="load" class="mt-1 w-full rounded-lg bg-slate-800 border border-slate-700 px-3 py-2" value="60" />
          </div>
        </div>
        <div>
          <label class="text-sm text-slate-300">Фото (png/jpg/webp)</label>
          <input type="file" accept="image/*" name="photo" class="mt-1 w-full text-sm text-slate-300" />
        </div>
        <div class="text-xs text-slate-400">Поля с * обязательны</div>
        <button class="w-full mt-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg py-2 font-semibold">Добавить</button>
      </form>
    </div>
  </div>

  <!-- Modal: Sensor detail -->
  <div id="sensorModal" class="modal fixed inset-0 hidden items-center justify-center z-40">
    <div class="glass rounded-2xl p-6 w-[90%] max-w-md border border-slate-700 relative fade-in">
      <button class="absolute top-3 right-3 text-slate-400 hover:text-white" onclick="toggleModal('sensorModal', false)"><i class="fa-solid fa-xmark"></i></button>
      <h3 class="text-lg font-semibold mb-3 flex items-center gap-2"><i class="fa-solid fa-microchip text-sky-300"></i> Деталь датчика</h3>
      <div class="space-y-2 text-sm">
        <div class="flex items-center justify-between"><span class="text-slate-400">Датчик</span><span id="sensorName">—</span></div>
        <div class="flex items-center justify-between"><span class="text-slate-400">Статус</span><span id="sensorStatus">—</span></div>
        <div class="text-xs text-slate-400" id="sensorHint">—</div>
      </div>
      <button class="mt-4 w-full bg-slate-800 hover:bg-slate-700 rounded-lg py-2 text-sm" onclick="toggleModal('sensorModal', false)">Закрыть</button>
    </div>
  </div>

  <!-- Modal: Cargo Detail -->
  <div id="cargoDetailModal" class="modal fixed inset-0 hidden items-center justify-center z-40">
    <div class="glass rounded-2xl p-6 w-[90%] max-w-lg border border-slate-700 relative fade-in">
      <button class="absolute top-3 right-3 text-slate-400 hover:text-white" onclick="toggleModal('cargoDetailModal', false)"><i class="fa-solid fa-xmark"></i></button>
      
      <div class="flex items-center gap-3 mb-4">
        <div id="cargoDetailIcon" class="w-12 h-12 rounded-xl flex items-center justify-center text-xl bg-sky-500/20 text-sky-400">
          <i class="fa-solid fa-box"></i>
        </div>
        <div>
          <h3 class="text-lg font-semibold" id="cargoDetailTitle">Содержимое ячейки</h3>
          <p class="text-xs text-slate-400" id="cargoDetailPosition">Позиция: Ряд 1, Ячейка 3</p>
        </div>
      </div>
      
      <div class="space-y-3">
        <div class="glass rounded-xl p-3 border border-slate-700/50">
          <div class="text-xs text-slate-400 mb-1">Тип груза</div>
          <div class="font-semibold text-base" id="cargoDetailType">Холодильный</div>
        </div>
        
        <div class="grid grid-cols-2 gap-3">
          <div class="glass rounded-xl p-3 border border-slate-700/50">
            <div class="text-xs text-slate-400 mb-1">Содержимое</div>
            <div class="font-semibold" id="cargoDetailContent">Мясо говядина</div>
          </div>
          <div class="glass rounded-xl p-3 border border-slate-700/50">
            <div class="text-xs text-slate-400 mb-1">Вес</div>
            <div class="font-semibold" id="cargoDetailWeight">850 кг</div>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-3">
          <div class="glass rounded-xl p-3 border border-slate-700/50">
            <div class="text-xs text-slate-400 mb-1">Температура</div>
            <div class="font-semibold" id="cargoDetailTemp">2-4°C</div>
          </div>
          <div class="glass rounded-xl p-3 border border-slate-700/50">
            <div class="text-xs text-slate-400 mb-1">Срок годности</div>
            <div class="font-semibold" id="cargoDetailExpiry">до 15.01.2026</div>
          </div>
        </div>
        
        <div class="glass rounded-xl p-3 border border-slate-700/50">
          <div class="text-xs text-slate-400 mb-1">Отправитель → Получатель</div>
          <div class="font-semibold text-sm" id="cargoDetailSender">ООО «МясТорг» → ООО «Продмаркет»</div>
        </div>
        
        <div class="glass rounded-xl p-3 border border-slate-700/50">
          <div class="text-xs text-slate-400 mb-1">Особые условия</div>
          <div class="text-sm text-slate-300" id="cargoDetailConditions">Не кантовать, хрупкое, температурный режим</div>
        </div>
      </div>
      
      <div class="flex gap-2 mt-4">
        <button class="flex-1 bg-slate-800 hover:bg-slate-700 rounded-lg py-2 text-sm" onclick="toggleModal('cargoDetailModal', false)">Закрыть</button>
        <button class="flex-1 bg-red-600/80 hover:bg-red-500 rounded-lg py-2 text-sm flex items-center justify-center gap-2" onclick="removeCargoFromModal()">
          <i class="fa-solid fa-trash"></i> Выгрузить
        </button>
      </div>
    </div>
  </div>

  <!-- Modal: Status confirm -->
  <div id="statusModal" class="modal fixed inset-0 hidden items-center justify-center z-40">
    <div class="glass rounded-2xl p-6 w-[90%] max-w-sm border border-slate-700 relative fade-in">
      <button class="absolute top-3 right-3 text-slate-400 hover:text-white" onclick="toggleModal('statusModal', false)"><i class="fa-solid fa-xmark"></i></button>
      <h3 class="text-lg font-semibold mb-3 flex items-center gap-2"><i class="fa-solid fa-circle-exclamation text-amber-300"></i> Подтвердите смену</h3>
      <p class="text-sm text-slate-300" id="statusMessage">Сменить статус?</p>
      <div class="mt-4 grid grid-cols-2 gap-2 text-sm">
        <button id="statusNo" class="w-full bg-slate-800 hover:bg-slate-700 rounded-lg py-2">Нет</button>
        <button id="statusYes" class="w-full bg-emerald-600 hover:bg-emerald-500 rounded-lg py-2 text-slate-900 font-semibold">Да</button>
      </div>
    </div>
  </div>

  <!-- Modal: Driver profile edit -->
  <div id="profileModal" class="modal fixed inset-0 hidden items-center justify-center z-40">
    <div class="glass rounded-2xl p-6 w-[90%] max-w-md border border-slate-700 relative fade-in">
      <button class="absolute top-3 right-3 text-slate-400 hover:text-white" onclick="toggleModal('profileModal', false)"><i class="fa-solid fa-xmark"></i></button>
      <h3 class="text-lg font-semibold mb-3 flex items-center gap-2"><i class="fa-solid fa-user-gear text-emerald-300"></i> Профиль водителя</h3>
      <form id="profileForm" class="space-y-4">
        <div class="form-grid">
          <label class="form-label">Имя</label>
          <input name="name" class="form-input" />
        </div>
        <div class="form-grid">
          <label class="form-label">Телефон</label>
          <input name="phone" class="form-input" />
        </div>
        <div class="form-grid">
          <label class="form-label">База</label>
          <input name="home" class="form-input" />
        </div>
        <div class="form-grid">
          <label class="form-label">Статус</label>
          <input name="status" class="form-input" />
        </div>
        <button class="w-full mt-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg py-2 font-semibold">Сохранить</button>
      </form>
    </div>
  </div>

  <!-- Modal: Trip Details -->
  <div id="tripDetailsModal" class="modal fixed inset-0 hidden items-center justify-center z-40">
    <div class="glass rounded-2xl p-6 w-[90%] max-w-4xl border border-slate-700 relative fade-in max-h-[90vh] overflow-y-auto">
      <button class="absolute top-3 right-3 text-slate-400 hover:text-white z-10" onclick="toggleModal('tripDetailsModal', false)"><i class="fa-solid fa-xmark"></i></button>
      <h3 class="text-xl font-semibold mb-6 flex items-center gap-2"><i class="fa-solid fa-route text-emerald-300"></i> Детальная информация о рейсе</h3>
      
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Левая колонка: Основная информация -->
        <div class="space-y-4">
          <div class="glass rounded-xl p-4 border border-slate-800">
            <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2"><i class="fa-solid fa-map-marked-alt"></i> Маршрут</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-400">Пункт отправления:</span>
                <span class="font-semibold" id="tripDetailOrigin">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Пункт назначения:</span>
                <span class="font-semibold" id="tripDetailDestination">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Код маршрута:</span>
                <span class="font-semibold" id="tripDetailRoute">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Дистанция:</span>
                <span class="font-semibold" id="tripDetailDistance">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Пройдено:</span>
                <span class="font-semibold" id="tripDetailProgress">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Осталось:</span>
                <span class="font-semibold" id="tripDetailRemaining">—</span>
              </div>
            </div>
          </div>

          <div class="glass rounded-xl p-4 border border-slate-800">
            <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2"><i class="fa-solid fa-clock"></i> Временные параметры</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-400">Время старта:</span>
                <span class="font-semibold" id="tripDetailDepart">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">ETA (прибытие):</span>
                <span class="font-semibold" id="tripDetailEta">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Время в пути:</span>
                <span class="font-semibold" id="tripDetailTimeElapsed">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Осталось времени:</span>
                <span class="font-semibold" id="tripDetailTimeRemaining">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Средняя скорость:</span>
                <span class="font-semibold" id="tripDetailAvgSpeed">—</span>
              </div>
            </div>
          </div>

          <div class="glass rounded-xl p-4 border border-slate-800">
            <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2"><i class="fa-solid fa-truck"></i> Транспорт</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-400">Название:</span>
                <span class="font-semibold" id="tripDetailVehicleName">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Гос. номер:</span>
                <span class="font-semibold" id="tripDetailPlate">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">VIN:</span>
                <span class="font-semibold text-xs" id="tripDetailVin">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Серия:</span>
                <span class="font-semibold" id="tripDetailSeries">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Статус:</span>
                <span class="font-semibold" id="tripDetailStatus">—</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Правая колонка: Груз и водитель -->
        <div class="space-y-4">
          <div class="glass rounded-xl p-4 border border-slate-800">
            <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2"><i class="fa-solid fa-box"></i> Груз</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-400">Описание:</span>
                <span class="font-semibold text-right" id="tripDetailCargo">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Загрузка:</span>
                <span class="font-semibold" id="tripDetailLoad">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Паллеты:</span>
                <span class="font-semibold" id="tripDetailPallets">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Топливо:</span>
                <span class="font-semibold" id="tripDetailFuel">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Состояние:</span>
                <span class="font-semibold" id="tripDetailHealth">—</span>
              </div>
            </div>
          </div>

          <div class="glass rounded-xl p-4 border border-slate-800">
            <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2"><i class="fa-solid fa-user"></i> Водитель</h4>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-slate-400">Имя:</span>
                <span class="font-semibold" id="tripDetailDriverName">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Телефон:</span>
                <a href="#" id="tripDetailDriverPhoneLink" class="font-semibold text-emerald-300 hover:text-emerald-200"><span id="tripDetailDriverPhone">—</span></a>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">База:</span>
                <span class="font-semibold" id="tripDetailDriverHome">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Стаж:</span>
                <span class="font-semibold" id="tripDetailDriverExperience">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Допуск:</span>
                <span class="font-semibold" id="tripDetailDriverLicense">—</span>
              </div>
              <div class="flex justify-between">
                <span class="text-slate-400">Смена:</span>
                <span class="font-semibold" id="tripDetailDriverShift">—</span>
              </div>
            </div>
          </div>

          <div class="glass rounded-xl p-4 border border-slate-800">
            <h4 class="text-sm font-semibold text-slate-300 mb-3 flex items-center gap-2"><i class="fa-solid fa-chart-line"></i> Прогресс</h4>
            <div class="space-y-3">
              <div>
                <div class="flex justify-between text-xs text-slate-400 mb-1">
                  <span>Выполнение маршрута</span>
                  <span id="tripDetailProgressPercent">0%</span>
                </div>
                <div class="progress h-2">
                  <span id="tripDetailProgressBar" style="width:0%"></span>
                </div>
              </div>
              <div class="text-xs text-slate-400 space-y-1">
                <div class="flex justify-between">
                  <span>Пройдено км:</span>
                  <span class="text-white font-semibold" id="tripDetailDoneKm">0</span>
                </div>
                <div class="flex justify-between">
                  <span>Всего км:</span>
                  <span class="text-white font-semibold" id="tripDetailTotalKm">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6 flex gap-3 justify-end">
        <button onclick="toggleModal('tripDetailsModal', false)" class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white text-sm font-semibold transition-colors">Закрыть</button>
        <button onclick="if(selected) { selectVehicle(selected); toggleModal('tripDetailsModal', false); }" class="px-4 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white text-sm font-semibold transition-colors">Открыть на карте</button>
      </div>
    </div>
  </div>

    <script src="./assets/js/app.js"></script>
    <script src="./assets/js/routox-unified.js"></script>
    <script>
      // Initialize navigation and role
      document.addEventListener('DOMContentLoaded', () => {
        initTheme();
        initNavigation();
        updateRoleBadge();
      });

      // Logout function
      function logout() {
        localStorage.removeItem('auth_token');
        localStorage.removeItem('user_role');
        localStorage.removeItem('demo_mode');
        window.location.href = './login.html';
      }

      // Initialize navigation based on role
      function initNavigation() {
        const role = localStorage.getItem('user_role') || 'admin';
        const nav = document.getElementById('mainNav');
        const currentPage = 'index.html';
        
        let navItems = [];
        
        if (role === 'owner') {
          navItems.push({ href: './owner.html', icon: 'fa-crown', text: 'Обзор', active: false });
        }
        
        navItems = navItems.concat([
          { href: './index.html', icon: 'fa-truck', text: 'Флот', active: true },
          { href: './trips.html', icon: 'fa-route', text: 'Рейсы', active: false },
          { href: './geozones.html', icon: 'fa-map-location-dot', text: 'Геозоны', active: false },
          { href: './analytics.html', icon: 'fa-chart-line', text: 'Аналитика', active: false },
          { href: './fuel.html', icon: 'fa-gas-pump', text: 'Топливо', active: false },
          { href: './maintenance.html', icon: 'fa-wrench', text: 'ТО', active: false },
          { href: './documents.html', icon: 'fa-file-lines', text: 'Документы', active: false }
        ]);
        
        nav.innerHTML = navItems.map(item => 
          `<a href="${item.href}" class="nav-pill ${item.active ? 'active' : ''}"><i class="fa-solid ${item.icon}"></i><span>${item.text}</span></a>`
        ).join('');
      }
    </script>
</body>
</html>