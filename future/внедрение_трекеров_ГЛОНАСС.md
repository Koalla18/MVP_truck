# Внедрение трекеров ГЛОНАСС

## Обзор
Система мониторинга транспорта в реальном времени с использованием ГЛОНАСС/GPS трекеров.

## Как это работает?

### Архитектура системы

```
┌─────────────────┐
│  ГЛОНАСС трекер │  ← Установлен в грузовике
│   (в кабине)    │  ← Подключен к CAN-шине
└────────┬────────┘
         │ GPRS/4G (передача данных)
         ▼
┌─────────────────────────────────────────┐
│      TCP Сервер (порт 5027)             │
│  Принимает пакеты от трекеров           │
│  (Teltonika протокол)                   │
└────────┬────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│      Message Queue (Redis)              │
│  Буферизация данных                     │
└────────┬────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│    Data Processor (Python)              │
│  • Геокодирование (координаты → адрес)  │
│  • Проверка геозон                      │
│  • Расчет пробега                       │
│  • Анализ стиля вождения                │
└────────┬────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│   Database (PostgreSQL + TimescaleDB)   │
│  Хранение истории телеметрии            │
└────────┬────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│      WebSocket Server                   │
│  Передача данных в веб-интерфейс        │
└────────┬────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│      Frontend (fleet.html)              │
│  Отображение на карте                   │
└─────────────────────────────────────────┘
```

## Какие данные передает трекер?

### Основные параметры (каждые 30 секунд)
- **Координаты**: широта, долгота (точность ±5 метров)
- **Скорость**: км/ч
- **Направление**: азимут (0-360°)
- **Высота**: метры над уровнем моря
- **Количество спутников**: качество сигнала
- **Время**: UTC timestamp

### Дополнительные параметры (с CAN-шины грузовика)
- **Уровень топлива**: литры
- **Пробег**: одометр
- **Обороты двигателя**: RPM
- **Температура двигателя**: °C
- **Напряжение аккумулятора**: вольт
- **Открытие дверей**: да/нет
- **Температура рефрижератора**: °C (если есть)

### События (когда происходят)
- **Резкое ускорение** (> 2 м/с²)
- **Резкое торможение** (> 2 м/с²)
- **Превышение скорости** (> установленного лимита)
- **Вход/выход из геозоны**
- **Удар/авария** (акселерометр)
- **Отключение питания** (попытка снять трекер)

## Выбор трекера

### Вариант 1: Покупка готового (Teltonika FMB920)
**Стоимость**: ₽6,500 за устройство

**Преимущества**:
- ✅ Готовое решение, быстрое внедрение
- ✅ Сертифицирован (ГЛОНАСС, ERA-GLONASS)
- ✅ Гарантия 2 года
- ✅ Документация и техподдержка
- ✅ Подключение к CAN-шине
- ✅ Встроенный аккумулятор (резервное питание)

**Недостатки**:
- ❌ Высокая цена
- ❌ Зависимость от поставщика
- ❌ SIM-карта оплачивается отдельно (₽300/мес)

**Рекомендация**: Для быстрого старта и первых клиентов

### Вариант 2: Разработка собственного
**Стоимость компонентов**: ₽4,200 за устройство
**Стоимость разработки**: ₽3,180,000 (NRE - Non-Recurring Engineering)

**Преимущества**:
- ✅ Низкая себестоимость при масштабе (400+ устройств)
- ✅ Полный контроль над функционалом
- ✅ Можно добавлять уникальные фичи
- ✅ Собственная прошивка

**Недостатки**:
- ❌ Долгая разработка (6-9 месяцев)
- ❌ Нужна сертификация (₽500,000)
- ❌ Риски в производстве
- ❌ Нужна команда для поддержки

**Рекомендация**: Для масштабирования после 400 клиентов

### Вариант 3: Гибридный подход ⭐ (РЕКОМЕНДУЕТСЯ)
1. **Сейчас**: Покупаем Teltonika FMB920 для первых 50-100 клиентов
2. **Параллельно**: Начинаем разработку собственного трекера
3. **Через 9 месяцев**: Переходим на свои устройства для новых клиентов
4. **Старые клиенты**: Остаются на Teltonika (или upgrade по желанию)

## План внедрения

### Этап 1: Backend разработка (4 недели)
- [ ] TCP сервер для приема данных (Python asyncio)
- [ ] Парсер Teltonika протокола
- [ ] Redis очередь сообщений
- [ ] Data Processor (геокодирование, геозоны)
- [ ] PostgreSQL + TimescaleDB схема
- [ ] WebSocket сервер для real-time обновлений

### Этап 2: Frontend интеграция (2 недели)
- [ ] Отображение ТС на карте (fleet.html)
- [ ] Исторический трек (воспроизведение)
- [ ] Аналитика по рейсам
- [ ] Алерты и уведомления
- [ ] Отчеты по пробегу и топливу

### Этап 3: Закупка и установка (ongoing)
- [ ] Заказ трекеров Teltonika (50 шт на старте)
- [ ] SIM-карты для трекеров (МТС/Мегафон)
- [ ] Договор с установочным центром
- [ ] Обучение установщиков
- [ ] Установка на первые 10 грузовиков

### Этап 4: Тестирование (2 недели)
- [ ] Полевые тесты (реальные рейсы)
- [ ] Проверка точности координат
- [ ] Стабильность соединения
- [ ] Нагрузочное тестирование (100 ТС одновременно)
- [ ] Оптимизация производительности

## Бюджет

### Разработка backend
- 1x Backend разработчик (senior Python): ₽250,000/мес × 1.5 мес = **₽375,000**
- 0.5x DevOps инженер: ₽200,000/мес × 0.5 мес = **₽100,000**
- 0.5x Frontend разработчик (карты): ₽220,000/мес × 0.5 мес = **₽110,000**

**Итого разработка: ₽585,000**

### Оборудование (пилот - 50 грузовиков)
- 50× Teltonika FMB920: ₽6,500 × 50 = **₽325,000**
- 50× SIM-карты (безлимит данных): ₽300/мес × 50 = **₽15,000/мес**
- Установка трекера: ₽3,000 × 50 = **₽150,000**

**Итого оборудование: ₽475,000 + ₽15,000/мес**

### Инфраструктура (первый год)
- VPS сервер (4 CPU, 8GB RAM): ₽8,000/мес × 12 = **₽96,000**
- TimescaleDB хостинг: ₽12,000/мес × 12 = **₽144,000**
- Redis cluster: ₽5,000/мес × 12 = **₽60,000**
- Геокодирование API (Yandex): ₽40,000/год
- Карты API (MapBox): ₽60,000/год

**Итого инфраструктура: ₽400,000/год**

### Общий бюджет на пилот (50 ТС)
- Разработка: **₽585,000** (один раз)
- Оборудование: **₽475,000** (один раз) + **₽180,000/год** (SIM-карты)
- Инфраструктура: **₽400,000/год**

**ИТОГО: ₽1,060,000 в первый год**
**Далее: ₽580,000/год** (поддержка)

## Сроки
**Общий срок: 8 недель от старта до первого установленного трекера**

## Монетизация
- Включаем стоимость трекера в тариф клиента
- Тариф "с ГЛОНАСС": **+₽500/ТС/мес** к базовой подписке
- ROI на трекер: 13 месяцев (₽6,500 / ₽500)
- После окупаемости: чистая прибыль ₽500/мес с каждого ТС

### Пример расчета
- 50 ТС с трекерами
- Доп.выручка: 50 × ₽500 = **₽25,000/мес**
- Расходы (SIM): 50 × ₽300 = **₽15,000/мес**
- **Чистая прибыль: ₽10,000/мес** после окупаемости

## KPI успеха
- Точность координат: ±5 метров
- Частота обновления: 30 секунд (в движении), 5 минут (стоянка)
- Uptime трекеров: 99%+
- Покрытие сети: 95%+ времени в пути
- Удовлетворенность клиентов: 4.5+/5
